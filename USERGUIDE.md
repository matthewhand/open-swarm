# Open Swarm User Guide: `swarm-cli`

This guide provides detailed instructions for using the `swarm-cli` command-line tool to manage blueprints and configuration for your Open Swarm environment.

---

## Overview

`swarm-cli` is your primary tool for interacting with Open Swarm from the command line. It allows you to:

*   Manage **Blueprints**: Add blueprints from your local filesystem, list available blueprints, run them directly, install them as standalone commands, and remove them.
*   Manage **Configuration**: View, add, update, and remove LLM profiles and MCP server definitions in your central `swarm_config.json` file.

---

## File Locations (XDG Compliance)

`swarm-cli` follows the XDG Base Directory Specification to store user-specific data and configuration, keeping your home directory clean.

*   **Configuration File (`swarm_config.json`):**
    *   **Location:** `~/.config/swarm/swarm_config.json` (or `$XDG_CONFIG_HOME/swarm/`)
    *   **Purpose:** Stores LLM profiles and MCP server definitions.
    *   **Creation:** Automatically created with default settings on first run if it doesn't exist.
*   **Managed Blueprint Sources:**
    *   **Location:** `~/.local/share/swarm/blueprints/` (or `$XDG_DATA_HOME/swarm/blueprints/`)
    *   **Purpose:** Stores the source code of blueprints added via `swarm-cli add`.
*   **Installed CLI Binaries (Executables):**
    *   **Location:** `~/.local/share/swarm/bin/` (or `$SWARM_USER_BIN_DIR`, defaults to a subdir within user data dir)
    *   **Purpose:** Stores standalone executables created by `swarm-cli install`.
    *   **Note:** Ensure this directory is in your system's `PATH` environment variable to run installed blueprints directly by name.
*   **Build Cache (PyInstaller):**
    *   **Location:** `~/.cache/swarm/build/` (or `$XDG_CACHE_HOME/swarm/build/`)
    *   **Purpose:** Temporary files generated by PyInstaller during the `swarm-cli install` process.

*(Note: Exact paths might vary slightly on macOS and Windows based on `platformdirs` behavior, but the principle of using standard user directories applies.)*

---

## Managing Blueprints

### Adding Blueprints (`swarm-cli add`)

Copies blueprint source code into the managed directory (`~/.local/share/swarm/blueprints/`).

*   **Add from a directory:**
    ```bash
    # Copies the contents of ./my_blueprints/cool_agent to ~/.local/share/swarm/blueprints/cool_agent
    swarm-cli add ./my_blueprints/cool_agent --name cool_agent
    ```
*   **Add from a single file:** (The name is inferred from the filename)
    ```bash
    # Copies ./my_blueprints/special_task.py to ~/.local/share/swarm/blueprints/special_task/special_task.py
    # (It creates a directory named after the blueprint)
    swarm-cli add ./my_blueprints/special_task.py
    ```

### Listing Blueprints (`swarm-cli list`)

Shows blueprints available in the managed directory and potentially bundled with the package.

```bash
swarm-cli list
# Example Output:
# --- User Blueprints (in /home/user/.local/share/swarm/blueprints) ---
# - echocraft (entry: blueprint_echocraft.py)
# - cool_agent (entry: main.py)
# - special_task (entry: special_task.py)
```

### Running Blueprints (`swarm-cli run`)

Executes a blueprint directly from the managed directory using the configuration found in `~/.config/swarm/swarm_config.json`.

*   **Basic run:**
    ```bash
    swarm-cli run echocraft --instruction "Repeat this message."
    ```
*   **Run with specific LLM profile:** (Assumes 'local_llm' is defined in `swarm_config.json`)
    ```bash
    swarm-cli run cool_agent --profile local_llm --instruction "Summarize /data/report.txt"
    ```
*   **Passing blueprint-specific arguments:** (Arguments after known CLI options are passed to the blueprint)
    ```bash
    swarm-cli run special_task --instruction "Process file" --input-file /path/to/data --output-dir /results
    ```
*   **Using a different config file:**
    ```bash
    swarm-cli run cool_agent --config-path /alt/swarm_config.json --instruction "Do something"
    ```

### Installing Blueprints as Commands (`swarm-cli install`)

Creates a standalone executable using PyInstaller and places it in the user binary directory (`~/.local/share/swarm/bin/`).

```bash
swarm-cli install echocraft
```
*   **After installation:** (Ensure `~/.local/share/swarm/bin/` is in your `PATH`)
    ```bash
    echocraft --instruction "Now I'm a command!"
    ```

### Deleting Blueprint Source (`swarm-cli delete`)

Removes the blueprint source code from the managed directory. **Warning:** This does *not* remove any installed executable created by `swarm-cli install`.

```bash
swarm-cli delete echocraft
```

### Uninstalling (`swarm-cli uninstall`)

Removes the installed executable and/or the blueprint source code.

*   **Remove executable AND source:**
    ```bash
    swarm-cli uninstall echocraft
    ```
*   **Remove only the source code:**
    ```bash
    swarm-cli uninstall echocraft --blueprint-only
    ```
*   **Remove only the installed executable:**
    ```bash
    swarm-cli uninstall echocraft --wrapper-only
    ```

---

## Managing Configuration (`swarm-cli config`)

Allows viewing and modifying the `swarm_config.json` file (default: `~/.config/swarm/swarm_config.json`).

### Default Configuration

If `~/.config/swarm/swarm_config.json` doesn't exist when `swarm-cli` needs it (e.g., during `swarm-cli run` or `swarm-cli config` commands), it will be created with a default structure:

```json
{
    "llm": {
        "default": {
            "provider": "openai",
            "model": "gpt-4o",
            "base_url": "https://api.openai.com/v1",
            "api_key": "${OPENAI_API_KEY}",
            "description": "Default OpenAI profile. Requires OPENAI_API_KEY env var."
        },
        "ollama_example": {
             "provider": "ollama",
             "model": "llama3",
             "api_key": "ollama",
             "base_url": "http://localhost:11434",
             "description": "Example for local Ollama Llama 3 model."
        }
    },
    "mcpServers": {},
    "agents": {},
    "settings": {
         "default_markdown_output": true
    }
}
```
**Important:** Placeholders like `${OPENAI_API_KEY}` are used. You **must** set the corresponding environment variables in your shell for the configuration to work.

### Listing Configuration Entries (`swarm-cli config list`)

*   **List LLM profiles:**
    ```bash
    swarm-cli config list --section llm
    ```
*   **List MCP Servers:**
    ```bash
    swarm-cli config list --section mcpServers
    ```

### Adding/Updating Configuration Entries (`swarm-cli config add`)

Adds a new entry or updates an existing one within a specified section.

*   **Add/Update an LLM profile:** (Use `--name` to specify the profile key)
    ```bash
    swarm-cli config add --section llm --name grok_haiku --json '{"provider": "openai", "model": "llama3-haiku-4096", "base_url": "https://api.groq.com/openai/v1", "api_key": "${GROQ_API_KEY}"}'
    ```
*   **Add/Update an MCP Server:** (Use `--name` to specify the server key)
    ```bash
    swarm-cli config add --section mcpServers --name filesystem --json '{"command": "npx", "args": ["-y", "@modelcontextprotocol/server-filesystem", "${ALLOWED_PATH}"], "env": {"ALLOWED_PATH": "${ALLOWED_PATH}"}}'
    ```
*   **Merge MCP Server Block:** (Use `--json` with a block containing `"mcpServers": {...}`, **do not** use `--name`)
    ```bash
    swarm-cli config add --section mcpServers --json '{
        "mcpServers": {
            "new_server_1": {"command": "...", "args": []},
            "new_server_2": {"command": "...", "args": []}
        }
    }'
    ```
*   **Specify config file path:** (Use `--config` if not using the default)
    ```bash
    swarm-cli config add --section llm --name test_profile --json '{...}' --config /path/to/other_config.json
    ```

### Removing Configuration Entries (`swarm-cli config remove`)

Deletes an entry from a specified section.

*   **Remove an LLM profile:**
    ```bash
    swarm-cli config remove --section llm --name grok_haiku
    ```
*   **Remove an MCP Server:**
    ```bash
    swarm-cli config remove --section mcpServers --name filesystem
    ```

---

## Swarm API (Alternative Usage)

While `swarm-cli` is used for management and direct execution, blueprints can also be exposed via an OpenAI-compatible REST API using the `swarm-api` launcher (or by running `uv run python manage.py runserver`).

*   **Endpoints:** `/v1/models`, `/v1/chat/completions`
*   **Blueprint Source:** The API server typically loads blueprints from the directory specified in `settings.py` (`BLUEPRINT_DIRECTORY`), which defaults to `src/swarm/blueprints/` within the project or Docker container structure. This is *different* from the user directory managed by `swarm-cli`. Use Docker volumes (see `README.md`) to make user or custom blueprints available to the API server.
*   **Use Case:** Integrating Open Swarm with other applications, web UIs (like Open WebUI), or tools that expect an OpenAI-compatible backend.

---

## Troubleshooting

*   **Command Not Found:** If running an installed blueprint (e.g., `echocraft`) fails, ensure the installation directory (`~/.local/share/swarm/bin/`) is in your system's `PATH`.
*   **Blueprint Not Found (`swarm-cli run`):** Make sure the blueprint was added using `swarm-cli add` and appears in `swarm-cli list`. Check the spelling.
*   **Configuration Errors:**
    *   Verify `~/.config/swarm/swarm_config.json` exists and is valid JSON.
    *   Ensure environment variables (like `OPENAI_API_KEY`) referenced in `swarm_config.json` are set correctly in your current shell session (`export OPENAI_API_KEY=sk-...`).
*   **Permissions:** Ensure you have read/write permissions for the XDG directories (`~/.config/swarm`, `~/.local/share/swarm`, `~/.cache/swarm`).

