/home/chatgpt/.local/lib/python3.10/site-packages/_testinfra_renamed.py:5: DeprecationWarning: testinfra package has been renamed to pytest-testinfra. Please `pip install pytest-testinfra` and `pip uninstall testinfra` and update your package requirements to avoid this message
  warnings.warn((

tests/api/test_models_negative.py::test_models_empty_registry_returns_200 PASSED                                                                                                                                                                                       [  0%]
tests/api/test_models_negative.py::test_models_non_mapping_iterable_gracefully_handles_type PASSED                                                                                                                                                                     [  0%]
tests/api/test_models_negative.py::test_models_exception_returns_500 XFAIL (View currently returns 200 on exception; adjust view to 500 to strengthen contract.)                                                                                                       [  0%]
tests/api/test_models_negative.py::test_models_unauthorized_when_permission_enforced XFAIL (Endpoint appears open (AllowAny); unauthorized path not applicable.)                                                                                                       [  1%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_code_comprehensive PASSED                                                                                                                                                    [  1%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_missing_yield PASSED                                                                                                                                               [  1%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_valid PASSED                                                                                                                                                       [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_problematic_code PASSED                                                                                                                                                    [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_safe_code PASSED                                                                                                                                                           [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_dangerous_code PASSED                                                                                                                                                         [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_hardcoded_secrets PASSED                                                                                                                                                      [  3%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_safe_code PASSED                                                                                                                                                              [  3%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_basic PASSED                                                                                                                                                                    [  3%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_with_complex_expertise PASSED                                                                                                                                                   [  4%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_sanitize_class_name PASSED                                                                                                                                                                          [  4%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_analytical PASSED                                                                                                                                                                [  4%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_conversational PASSED                                                                                                                                                            [  5%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_creative PASSED                                                                                                                                                                  [  5%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_context PASSED                                                                                                                                                            [  5%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_get PASSED                                                                                                                                                                [  5%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProIntegration::test_full_agent_creation_workflow PASSED                                                                                                                                                        [  6%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_empty_expertise PASSED                                                                                                                                                 [  6%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_missing_fields PASSED                                                                                                                                                  [  6%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_empty_code PASSED                                                                                                                                                      [  7%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_invalid_syntax PASSED                                                                                                                                                  [  7%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_all_settings PASSED                                                                                                                                                                          [  7%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_auth_settings PASSED                                                                                                                                                                         [  7%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_database_settings PASSED                                                                                                                                                                     [  8%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_django_settings PASSED                                                                                                                                                                       [  8%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_error PASSED                                                                                                                                                                    [  8%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_success PASSED                                                                                                                                                                  [  9%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_logging_settings PASSED                                                                                                                                                                      [  9%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_performance_settings PASSED                                                                                                                                                                  [  9%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_swarm_core_settings PASSED                                                                                                                                                                   [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_ui_settings PASSED                                                                                                                                                                           [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_settings_manager_initialization PASSED                                                                                                                                                               [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_filtering PASSED                                                                                                                                                        [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_get PASSED                                                                                                                                                              [ 11%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_get PASSED                                                                                                                                                                       [ 11%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_sensitive_data_filtering PASSED                                                                                                                                                  [ 11%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_context PASSED                                                                                                                                                             [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_error_handling PASSED                                                                                                                                                      [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_get PASSED                                                                                                                                                                 [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_empty_config_file PASSED                                                                                                                                                                    [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_missing_django_settings PASSED                                                                                                                                                              [ 13%]
tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_no_environment_variables PASSED                                                                                                                                                             [ 13%]
tests/views/test_settings_dashboard.py::TestSettingsIntegration::test_full_settings_collection_workflow PASSED                                                                                                                                                         [ 13%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_no_auth_returns_403 PASSED                                                                                                                                                           [ 14%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_invalid_token_returns_403 PASSED                                                                                                                                                     [ 14%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_token_allows_access PASSED                                                                                                                                                     [ 14%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_session_allows_access PASSED                                                                                                                                                   [ 15%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_echocraft_non_streaming_success_auth_disabled PASSED                                                                                                                                 [ 15%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_chatbot_non_streaming_success_auth_disabled PASSED                                                                                                                                   [ 15%]
tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_echocraft_streaming_success PASSED                                                                                                                                          [ 15%]
tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_chatbot_streaming_success PASSED                                                                                                                                            [ 16%]
tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_blueprint_run_exception_streaming_returns_error_sse PASSED                                                                                                                  [ 16%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[model] PASSED                                                                                                                         [ 16%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[messages] PASSED                                                                                                                      [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data0-Ensure this field has at least 1 elements] PASSED                                                                [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data1-Expected a list of items] PASSED                                                                                 [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data2-This field is required.] PASSED                                                                                  [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data3-This field is required.] PASSED                                                                                  [ 18%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data4-invalid" is not a valid choice] PASSED                                                                           [ 18%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data5-Content must be a string or null.] PASSED                                                                        [ 18%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_malformed_json_returns_400 PASSED                                                                                                                                        [ 19%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_permission_denied PASSED                                                                                                                               [ 19%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_not_found PASSED                                                                                                                                       [ 19%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_init_error_returns_500 PASSED                                                                                                                                  [ 20%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_run_exception_non_streaming_returns_500 PASSED                                                                                                                 [ 20%]
tests/api/test_endpoints_list_blueprints_models.py::test_models_and_blueprints_endpoints_include_dynamic_team PASSED                                                                                                                                                   [ 20%]
tests/api/test_teams_export_import.py::test_export_json_and_csv_and_import_roundtrip PASSED                                                                                                                                                                            [ 20%]
tests/integration/test_dynamic_teams_reset.py::test_reset_clears_dynamic_registry_and_discovery PASSED                                                                                                                                                                 [ 21%]
tests/integration/test_dynamic_teams_smoke.py::test_dynamic_team_registry_and_discovery_roundtrip PASSED                                                                                                                                                               [ 21%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_db_initialization SKIPPED (SQLite interaction testing needs refinement.)                                                                                                                                         [ 21%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_get_agent_config_from_db SKIPPED (SQLite interaction testing needs refinement.)                                                                                                                                  [ 22%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_delegation_flow_sqlite SKIPPED (Blueprint interaction tests not yet implemented.)                                                                                                                                [ 22%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_build_action_sqlite SKIPPED (Blueprint action tests not yet implemented)                                                                                                                                         [ 22%]
tests/blueprints/test_divine_code.py::test_zeus_agent_creation PASSED                                                                                                                                                                                                  [ 22%]
tests/blueprints/test_divine_code.py::test_zeus_run_method PASSED                                                                                                                                                                                                      [ 23%]
tests/blueprints/test_divine_code.py::test_zeus_delegation_to_odin PASSED                                                                                                                                                                                              [ 23%]
tests/blueprints/test_divine_code.py::test_zeus_basic PASSED                                                                                                                                                                                                           [ 23%]
tests/blueprints/test_divine_code.py::test_zeus_full_flow_example PASSED                                                                                                                                                                                               [ 24%]
tests/blueprints/test_divine_code.py::test_zeus_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                        [ 24%]
tests/blueprints/test_echocraft.py::test_echocraft_blueprint_run PASSED                                                                                                                                                                                                [ 24%]
tests/blueprints/test_echocraft.py::test_echocraft_blueprint_no_user_message PASSED                                                                                                                                                                                    [ 25%]
tests/blueprints/test_echocraft.py::test_echocraft_blueprint_multiple_messages PASSED                                                                                                                                                                                  [ 25%]
tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_success PASSED                                                                                                                                                                                          [ 25%]
tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_unexpected_response_format PASSED                                                                                                                                                                       [ 25%]
tests/blueprints/test_family_ties.py::test_stewie_agent_creation PASSED                                                                                                                                                                                                [ 26%]
tests/blueprints/test_family_ties.py::test_stewie_delegation_to_brian SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                        [ 26%]
tests/blueprints/test_family_ties.py::test_stewie_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                      [ 26%]
tests/blueprints/test_geese.py::test_geese_agent_handoff_and_astool SKIPPED (Test needs review for SDK Agent tool handling)                                                                                                                                            [ 27%]
tests/blueprints/test_geese.py::test_agent_tool_creation SKIPPED (Test needs review for SDK Agent tool handling)                                                                                                                                                       [ 27%]
tests/blueprints/test_geese.py::test_spinner_state_updates SKIPPED (Spinner tests need refactoring for GeeseSpinner class methods)                                                                                                                                     [ 27%]
tests/blueprints/test_geese.py::test_spinner_state_transitions SKIPPED (Spinner tests need refactoring for GeeseSpinner class methods)                                                                                                                                 [ 27%]
tests/blueprints/test_geese.py::test_geese_story_delegation_flow SKIPPED (Tool structure needs review with SDK Agent)                                                                                                                                                  [ 28%]
tests/blueprints/test_geese.py::test_operation_box_styles PASSED                                                                                                                                                                                                       [ 28%]
tests/blueprints/test_geese.py::test_display_splash_screen_variants PASSED                                                                                                                                                                                             [ 28%]
tests/blueprints/test_geese.py::test_main_entry SKIPPED (Main entry test needs review for async structure and Geese CLI specifics)                                                                                                                                     [ 29%]
tests/blueprints/test_geese.py::test_create_story_outline SKIPPED (Relies on removed module-level functions; needs agent-based testing.)                                                                                                                               [ 29%]
tests/blueprints/test_geese.py::test_write_story_part SKIPPED (Relies on removed module-level functions; needs agent-based testing.)                                                                                                                                   [ 29%]
tests/blueprints/test_geese.py::test_edit_story SKIPPED (Relies on removed module-level functions; needs agent-based testing.)                                                                                                                                         [ 30%]
tests/blueprints/test_geese.py::test_spinner_messages PASSED                                                                                                                                                                                                           [ 30%]
tests/blueprints/test_geese.py::test_story_generation_flow PASSED                                                                                                                                                                                                      [ 30%]
tests/blueprints/test_geese_agent_mcp_assignment.py::test_agent_mcp_assignment SKIPPED (Test needs update for refactored GeeseBlueprint agent creation.)                                                                                                               [ 30%]
tests/blueprints/test_geese_agent_mcp_assignment.py::test_agent_mcp_assignment_cli_override SKIPPED (Test needs update for refactored GeeseBlueprint agent creation.)                                                                                                  [ 31%]
tests/blueprints/test_geese_spinner_and_box.py::test_geese_spinner_methods SKIPPED (GeeseSpinner internal API changed; test needs update or removal.)                                                                                                                  [ 31%]
tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_basic PASSED                                                                                                                                                                                [ 31%]
tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_default_emoji PASSED                                                                                                                                                                        [ 32%]
tests/blueprints/test_geese_spinner_and_box.py::test_progressive_demo_operation_box SKIPPED (Test needs update for refactored GeeseBlueprint agent creation.)                                                                                                          [ 32%]
tests/blueprints/test_gotchaman.py::test_gotchaman_agent_creation SKIPPED (Implementation for GotchamanBlueprint not found in codebase; skipping test.)                                                                                                                [ 32%]
tests/blueprints/test_gotchaman.py::test_gotchaman_execute_command_tool SKIPPED (Tool function tests not yet implemented)                                                                                                                                              [ 32%]
tests/blueprints/test_gotchaman.py::test_gotchaman_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                           [ 33%]
tests/blueprints/test_gotchaman.py::test_gotchaman_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                     [ 33%]
tests/blueprints/test_jeeves.py::test_jeeves_agent_creation PASSED                                                                                                                                                                                                     [ 33%]
tests/blueprints/test_jeeves.py::test_jeeves_delegation_to_mycroft PASSED                                                                                                                                                                                              [ 34%]
tests/blueprints/test_jeeves.py::test_jeeves_delegation_to_gutenberg SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                         [ 34%]
tests/blueprints/test_jeeves.py::test_jeeves_cli_execution PASSED                                                                                                                                                                                                      [ 34%]
tests/blueprints/test_jeeves_progressive_tool.py::test_display_operation_box_progress PASSED                                                                                                                                                                           [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[0-Polishing the silver] PASSED                                                                                                                                                             [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[1-Generating.] PASSED                                                                                                                                                                      [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[2-Generating..] PASSED                                                                                                                                                                     [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[3-Generating...] PASSED                                                                                                                                                                    [ 36%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[4-Running...] PASSED                                                                                                                                                                       [ 36%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[5-Polishing the silver] PASSED                                                                                                                                                             [ 36%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_long_wait PASSED                                                                                                                                                                                  [ 37%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_basic PASSED                                                                                                                                                                               [ 37%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_long_wait PASSED                                                                                                                                                                           [ 37%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_agent_creation PASSED                                                                                                                                                                                                  [ 37%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_bad_config PASSED                                                                                                                                                                                                      [ 38%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_filesystem_interaction PASSED                                                                                                                                                                                          [ 38%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_memory_interaction PASSED                                                                                                                                                                                              [ 38%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_cli_execution PASSED                                                                                                                                                                                                   [ 39%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_help SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                                [ 39%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_simple_task SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                         [ 39%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_time SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                                [ 40%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_list_files SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                          [ 40%]
tests/blueprints/test_mission_improbable.py::test_mission_db_initialization PASSED                                                                                                                                                                                     [ 40%]
tests/blueprints/test_mission_improbable.py::test_mission_agent_creation PASSED                                                                                                                                                                                        [ 40%]
tests/blueprints/test_mission_improbable.py::test_mission_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                    [ 41%]
tests/blueprints/test_mission_improbable.py::test_mission_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                              [ 41%]
tests/blueprints/test_monkai_magic.py::test_monkai_agent_creation SKIPPED (Blueprint tests not yet implemented)                                                                                                                                                        [ 41%]
tests/blueprints/test_monkai_magic.py::test_monkai_aws_cli_tool SKIPPED (Tool function tests not yet implemented)                                                                                                                                                      [ 42%]
tests/blueprints/test_monkai_magic.py::test_monkai_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                           [ 42%]
tests/blueprints/test_monkai_magic.py::test_monkai_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                     [ 42%]
tests/blueprints/test_nebula_shellz.py::test_nebula_shellz_cli_simple_task SKIPPED (CLI tests require more setup/mocking)                                                                                                                                              [ 42%]
tests/blueprints/test_nebula_shellz.py::test_nebula_shellz_cli_shell_command SKIPPED (CLI tests require more setup/mocking)                                                                                                                                            [ 43%]
tests/blueprints/test_nebula_shellz.py::test_nebula_shellz_cli_delegate_shell SKIPPED (CLI tests require more setup/mocking)                                                                                                                                           [ 43%]
tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_all_types PASSED                                                                                                                                                                                       [ 43%]
tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_only_npx PASSED                                                                                                                                                                                        [ 44%]
tests/blueprints/test_omniplex.py::test_omniplex_delegation_to_amazo PASSED                                                                                                                                                                                            [ 44%]
tests/blueprints/test_omniplex.py::test_omniplex_cli_execution PASSED                                                                                                                                                                                                  [ 44%]
tests/blueprints/test_poets.py::test_poets_db_initialization PASSED                                                                                                                                                                                                    [ 45%]
tests/blueprints/test_poets.py::test_poets_agent_creation PASSED                                                                                                                                                                                                       [ 45%]
tests/blueprints/test_poets.py::test_poets_collaboration_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                                [ 45%]
tests/blueprints/test_poets.py::test_poets_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                             [ 45%]
tests/blueprints/test_rue_code_cost.py::test_gpt4_cost PASSED                                                                                                                                                                                                          [ 46%]
tests/blueprints/test_rue_code_cost.py::test_invalid_model PASSED                                                                                                                                                                                                      [ 46%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_spinner_states PASSED                                                                                                                                                                                      [ 46%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_operation_box_output PASSED                                                                                                                                                                                [ 47%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_box PASSED                                                                                                                                                                                             [ 47%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_empty PASSED                                                                                                                                                                                           [ 47%]
tests/blueprints/test_suggestion.py::test_suggestion_agent_creation SKIPPED (Only run if DEFAULT_LLM is set to 'test')                                                                                                                                                 [ 47%]
tests/blueprints/test_suggestion.py::test_suggestion_run_produces_structured_output SKIPPED (Only run if DEFAULT_LLM is set to 'test')                                                                                                                                 [ 48%]
tests/blueprints/test_suggestion.py::test_suggestion_cli_execution SKIPPED (Only run if DEFAULT_LLM is set to 'test')                                                                                                                                                  [ 48%]
tests/blueprints/test_whinge_surf.py::test_run_and_check_status PASSED                                                                                                                                                                                                 [ 48%]
tests/blueprints/test_whinge_surf.py::test_kill_subprocess PASSED                                                                                                                                                                                                      [ 49%]
tests/blueprints/test_whinge_surf.py::test_tail_and_show_output PASSED                                                                                                                                                                                                 [ 49%]
tests/blueprints/test_whinge_surf.py::test_list_and_prune_jobs PASSED                                                                                                                                                                                                  [ 49%]
tests/blueprints/test_whinge_surf.py::test_resource_usage_and_analyze_self PASSED                                                                                                                                                                                      [ 50%]
tests/blueprints/test_whinge_surf.py::test_self_update PASSED                                                                                                                                                                                                          [ 50%]
tests/blueprints/test_whinge_surf_analysis.py::test_analyze_self_runs PASSED                                                                                                                                                                                           [ 50%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_agent_creation PASSED                                                                                                                                                                                           [ 50%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_db_initialization PASSED                                                                                                                                                                                        [ 51%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                       [ 51%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                 [ 51%]
tests/blueprints/test_zeus.py::test_metadata_lists_cli_as_divine_ass PASSED                                                                                                                                                                                            [ 52%]
tests/blueprints/test_zeus_cli.py::test_zeus_cli_banner PASSED                                                                                                                                                                                                         [ 52%]
tests/blueprints/test_zeus_cli.py::test_zeus_cli_multiple_inputs PASSED                                                                                                                                                                                                [ 52%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_spinner_states PASSED                                                                                                                                                                                         [ 52%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_operation_box_output PASSED                                                                                                                                                                                   [ 53%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_assist_box PASSED                                                                                                                                                                                             [ 53%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_run_empty PASSED                                                                                                                                                                                              [ 53%]
tests/cli/test_cli_config.py::test_create_llm_config PASSED                                                                                                                                                                                                            [ 54%]
tests/cli/test_cli_config.py::test_read_llm_config PASSED                                                                                                                                                                                                              [ 54%]
tests/cli/test_cli_config.py::test_update_llm_config PASSED                                                                                                                                                                                                            [ 54%]
tests/cli/test_cli_config.py::test_partial_update_llm_config PASSED                                                                                                                                                                                                    [ 55%]
tests/cli/test_cli_config.py::test_delete_llm_config PASSED                                                                                                                                                                                                            [ 55%]
tests/cli/test_cli_config.py::test_invalid_config_handling PASSED                                                                                                                                                                                                      [ 55%]
tests/cli/test_cli_config.py::test_config_list_all PASSED                                                                                                                                                                                                              [ 55%]
tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[OPENAI_API_KEY-sk-test-123] XFAIL (swarm-cli config add not implemented or unavailable. stderr:)                                                                  [ 56%]
tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[CUSTOM_SECRET-s3cr3t!] XFAIL (swarm-cli config add not implemented or unavailable. stderr:)                                                                       [ 56%]
tests/cli/test_config_secrets_and_env_expansion.py::test_env_var_expansion_in_config_loader PASSED                                                                                                                                                                     [ 56%]
tests/cli/test_launchers.py::test_swarm_cli_entrypoint PASSED                                                                                                                                                                                                          [ 57%]
tests/cli/test_launchers.py::test_swarm_cli_install_executable_creates_executable PASSED                                                                                                                                                                               [ 57%]
tests/cli/test_launchers.py::test_swarm_install_executable_failure PASSED                                                                                                                                                                                              [ 57%]
tests/cli/test_launchers.py::test_swarm_launch_runs_executable PASSED                                                                                                                                                                                                  [ 57%]
tests/cli/test_launchers.py::test_swarm_launch_failure_not_found PASSED                                                                                                                                                                                                [ 58%]
tests/cli/test_list_blueprints.py::test_execute_list_user_installed PASSED                                                                                                                                                                                             [ 58%]
tests/cli/test_list_blueprints.py::test_execute_list_available PASSED                                                                                                                                                                                                  [ 58%]
tests/cli/test_list_blueprints.py::test_execute_no_user_installed_blueprints PASSED                                                                                                                                                                                    [ 59%]
tests/cli/test_list_blueprints.py::test_execute_no_available_blueprints PASSED                                                                                                                                                                                         [ 59%]
tests/cli/test_list_blueprints.py::test_execute_discovery_exception_user_installed PASSED                                                                                                                                                                              [ 59%]
tests/cli/test_list_blueprints.py::test_execute_discovery_exception_available PASSED                                                                                                                                                                                   [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args0] PASSED                                                                                                                                                                           [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args1] PASSED                                                                                                                                                                           [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_key_with_config PASSED                                                                                                                                                                                [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_suppressed_when_env_flag_unset PASSED                                                                                                                                                                    [ 61%]
tests/core/test_blueprint_model_override.py::test_blueprint_default_model_override PASSED                                                                                                                                                                              [ 61%]
tests/core/test_blueprint_model_override.py::test_fallback_logs_warning PASSED                                                                                                                                                                                         [ 61%]
tests/core/test_config_default_generation.py::test_default_config_generation PASSED                                                                                                                                                                                    [ 62%]
tests/core/test_config_discovery.py::test_xdg_config_discovery PASSED                                                                                                                                                                                                  [ 62%]
tests/core/test_config_discovery.py::test_config_fallback_to_cwd PASSED                                                                                                                                                                                                [ 62%]
tests/core/test_config_loader.py::test_load_full_configuration_defaults PASSED                                                                                                                                                                                         [ 62%]
tests/core/test_config_loader.py::test_load_full_configuration_profile_merging PASSED                                                                                                                                                                                  [ 63%]
tests/core/test_config_loader.py::test_load_full_configuration_env_substitution PASSED                                                                                                                                                                                 [ 63%]
tests/core/test_config_loader.py::test_load_full_configuration_missing_file PASSED                                                                                                                                                                                     [ 63%]
tests/core/test_config_loader.py::test_load_full_configuration_bad_json PASSED                                                                                                                                                                                         [ 64%]
tests/core/test_config_loader.py::test_load_full_configuration_empty_config PASSED                                                                                                                                                                                     [ 64%]
tests/core/test_config_loader.py::test_load_environment PASSED                                                                                                                                                                                                         [ 64%]
tests/core/test_fallback_to_default_model.py::test_fallback_to_default_model PASSED                                                                                                                                                                                    [ 65%]
tests/core/test_mcp_server_config.py::test_mcp_server_config_parsing PASSED                                                                                                                                                                                            [ 65%]
tests/core/test_mcp_server_config.py::test_mcp_server_add_remove_and_edge_cases PASSED                                                                                                                                                                                 [ 65%]
tests/core/test_redact_sensitive_data.py::test_redacts_api_keys_and_tokens PASSED                                                                                                                                                                                      [ 65%]
tests/core/test_redact_sensitive_data.py::test_does_not_redact_non_sensitive_strings PASSED                                                                                                                                                                            [ 66%]
tests/core/test_redact_sensitive_data.py::test_partial_redaction_behavior PASSED                                                                                                                                                                                       [ 66%]
tests/core/test_redact_sensitive_data.py::test_handles_empty_and_non_dict_inputs PASSED                                                                                                                                                                                [ 66%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_basic_run PASSED                                                                                                                                                                                 [ 67%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_custom_port_and_config_creation PASSED                                                                                                                                                           [ 67%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_daemon_mode PASSED                                                                                                                                                                               [ 67%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_blueprint_not_found PASSED                                                                                                                                                                       [ 67%]
tests/integration/test_cli_codey.py::test_codey_cli_ux PASSED                                                                                                                                                                                                          [ 68%]
tests/integration/test_cli_codey_packaged.py::test_packaged_codey_cli_install_and_launch PASSED                                                                                                                                                                        [ 68%]
tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/codey---help] PASSED                                                                                                                                                        [ 68%]
tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/swarm-cli---help] PASSED                                                                                                                                                    [ 69%]
tests/integration/test_cli_commands.py::test_cli_minimal_prompt[/mnt/models/open-swarm-mcp/.venv/bin/codey-Say hello from codey!] PASSED                                                                                                                               [ 69%]
tests/integration/test_cli_commands.py::test_swarm_cli_interactive_shell PASSED                                                                                                                                                                                        [ 69%]
tests/integration/test_cli_geese.py::test_geese_cli_search_ux SKIPPED (GeeseBlueprint functionality changed; CLI test needs review for story output vs search UX.)                                                                                                     [ 70%]
tests/integration/test_cli_jeeves.py::test_jeeves_cli_ux PASSED                                                                                                                                                                                                        [ 70%]
tests/integration/test_cli_rue_code.py::test_rue_cli_token_cost PASSED                                                                                                                                                                                                 [ 70%]
tests/integration/test_cli_rue_code.py::test_rue_cli_ux PASSED                                                                                                                                                                                                         [ 70%]
tests/integration/test_cli_whinge.py::test_whinge_cli_background_job PASSED                                                                                                                                                                                            [ 71%]
tests/integration/test_cli_zeus.py::test_zeus_cli_integration PASSED                                                                                                                                                                                                   [ 71%]
tests/manual/test_blueprintbase_init.py::test_init PASSED                                                                                                                                                                                                              [ 71%]
tests/system/test_codey_binary.py::test_codey_binary SKIPPED (Binary ./dist/codey_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/codey/codey_cli.py --name codey_cli)                                                                           [ 72%]
tests/system/test_rue_code_binary.py::test_rue_code_binary SKIPPED (Binary ./dist/rue_code_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/rue_code/rue_code_cli.py --name rue_code_cli)                                                         [ 72%]
tests/system/test_whinge_binary.py::test_whinge_binary SKIPPED (Binary ./dist/whinge not found. Build with: pyinstaller --onefile src/swarm/blueprints/whinge_surf/whinge_surf_cli.py --name whinge)                                                                   [ 72%]
tests/system/test_zeus_binary.py::test_zeus_binary SKIPPED (Binary ./dist/zeus_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/zeus/zeus_cli.py --name zeus_cli)                                                                                 [ 72%]
tests/test_cli_mode_selection.py::test_valid_input PASSED                                                                                                                                                                                                              [ 73%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_duplicate_system_messages PASSED                                                                                                                                                                      [ 73%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_no_system_messages PASSED                                                                                                                                                                             [ 73%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_only_system_messages PASSED                                                                                                                                                                           [ 74%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_empty_list PASSED                                                                                                                                                                                     [ 74%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_mixed_valid_invalid PASSED                                                                                                                                                                            [ 74%]
tests/test_core_filter_messages.py::test_filter_messages_empty_and_none_content PASSED                                                                                                                                                                                 [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_all_valid PASSED                                                                                                                                                                                              [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_with_non_dict_items PASSED                                                                                                                                                                                    [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_empty_input PASSED                                                                                                                                                                                            [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_ignores_other_keys PASSED                                                                                                                                                                                     [ 76%]
tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[simple] PASSED                                                                                                                                                                             [ 76%]
tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[pairs] PASSED                                                                                                                                                                              [ 76%]
tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[simple] PASSED                                                                                                                                                                       [ 77%]
tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[pairs] PASSED                                                                                                                                                                        [ 77%]
tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[simple] PASSED                                                                                                                                                                         [ 77%]
tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[pairs] PASSED                                                                                                                                                                          [ 77%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space PASSED                                                                                                                                                                        [ 78%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space PASSED                                                                                                                                                                        [ 78%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space PASSED                                                                                                                                                                        [ 78%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user PASSED                                                                                                                                                                    [ 79%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair PASSED                                                                                                                                                                    [ 79%]
tests/test_core_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit PASSED                                                                                                                                                              [ 79%]
tests/test_core_truncate_message_history.py::test_pairs_handles_missing_tool_response PASSED                                                                                                                                                                           [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_interspersed_messages_truncation PASSED                                                                                                                                                                        [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit PASSED                                                                                                                                                               [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits PASSED                                                                                                                                                                             [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user PASSED                                                                                                                                                                        [ 81%]
tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair PASSED                                                                                                                                                                        [ 81%]
tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_fit PASSED                                                                                                                                                                                  [ 81%]
tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user PASSED                                                                                                                                                                             [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair PASSED                                                                                                                                                                       [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_empty_input_list PASSED                                                                                                                                                                                        [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_only_system_message PASSED                                                                                                                                                                                     [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_invalid_messages_mixed_in PASSED                                                                                                                                                                               [ 83%]
tests/test_core_truncate_message_history.py::test_pairs_non_serializable_content PASSED                                                                                                                                                                                [ 83%]
tests/test_core_truncate_message_history.py::test_simple_truncation_fallback_simulation PASSED                                                                                                                                                                         [ 83%]
tests/test_core_update_null_content.py::test_update_null_content_list PASSED                                                                                                                                                                                           [ 84%]
tests/test_core_update_null_content.py::test_update_null_content_single_dict PASSED                                                                                                                                                                                    [ 84%]
tests/test_core_update_null_content.py::test_update_null_content_no_change_needed PASSED                                                                                                                                                                               [ 84%]
tests/test_core_update_null_content.py::test_update_null_content_empty_list_or_invalid_input PASSED                                                                                                                                                                    [ 85%]
tests/test_dummy.py::test_dummy PASSED                                                                                                                                                                                                                                 [ 85%]
tests/test_truncate_message_history.py::test_truncate_no_action_needed[simple] PASSED                                                                                                                                                                                  [ 85%]
tests/test_truncate_message_history.py::test_truncate_no_action_needed[pairs] PASSED                                                                                                                                                                                   [ 85%]
tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[simple] PASSED                                                                                                                                                                            [ 86%]
tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[pairs] PASSED                                                                                                                                                                             [ 86%]
tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[simple] PASSED                                                                                                                                                                              [ 86%]
tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[pairs] PASSED                                                                                                                                                                               [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space PASSED                                                                                                                                                                             [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space PASSED                                                                                                                                                                             [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space PASSED                                                                                                                                                                             [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user PASSED                                                                                                                                                                         [ 88%]
tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair PASSED                                                                                                                                                                         [ 88%]
tests/test_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit PASSED                                                                                                                                                                   [ 88%]
tests/test_truncate_message_history.py::test_pairs_handles_missing_tool_response PASSED                                                                                                                                                                                [ 89%]
tests/test_truncate_message_history.py::test_pairs_interspersed_messages_truncation PASSED                                                                                                                                                                             [ 89%]
tests/test_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit PASSED                                                                                                                                                                    [ 89%]
tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits PASSED                                                                                                                                                                                  [ 90%]
tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user PASSED                                                                                                                                                                             [ 90%]
tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair PASSED                                                                                                                                                                             [ 90%]
tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_fit PASSED                                                                                                                                                                                       [ 90%]
tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user PASSED                                                                                                                                                                                  [ 91%]
tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair PASSED                                                                                                                                                                            [ 91%]
tests/test_truncate_message_history.py::test_pairs_empty_input_list PASSED                                                                                                                                                                                             [ 91%]
tests/test_truncate_message_history.py::test_pairs_only_system_message PASSED                                                                                                                                                                                          [ 92%]
tests/test_truncate_message_history.py::test_pairs_invalid_messages_mixed_in PASSED                                                                                                                                                                                    [ 92%]
tests/test_truncate_message_history.py::test_pairs_non_serializable_content SKIPPED (Need to verify how non-serializable data is handled)                                                                                                                              [ 92%]
tests/test_truncate_message_history.py::test_simple_truncation_fallback_simulation PASSED                                                                                                                                                                              [ 92%]
tests/unit/test_ansi_box.py::test_ansi_box_basic PASSED                                                                                                                                                                                                                [ 93%]
tests/unit/test_ansi_box.py::test_ansi_box_multiline PASSED                                                                                                                                                                                                            [ 93%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_init_does_not_raise PASSED                                                                                                                                                              [ 93%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_markdown_setting_priority PASSED                                                                                                                                                        [ 94%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_llm_profile_resolution_priority PASSED                                                                                                                                                  [ 94%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_missing_llm_profile_raises PASSED                                                                                                                                                       [ 94%]
tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_enabled PASSED                                                                                                                                                                                   [ 95%]
tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_disabled PASSED                                                                                                                                                                                  [ 95%]
tests/unit/test_operation_box_utils.py::test_basic_box_output PASSED                                                                                                                                                                                                   [ 95%]
tests/unit/test_operation_box_utils.py::test_code_vs_semantic_box PASSED                                                                                                                                                                                               [ 95%]
tests/unit/test_operation_box_utils.py::test_spinner_escalation_box PASSED                                                                                                                                                                                             [ 96%]
tests/unit/test_output_utils.py::test_pretty_print_response_plain_text PASSED                                                                                                                                                                                          [ 96%]
tests/unit/test_output_utils.py::test_pretty_print_response_with_code_fence PASSED                                                                                                                                                                                     [ 96%]
tests/unit/test_redact.py::test_redact_sensitive_data_basic PASSED                                                                                                                                                                                                     [ 97%]
tests/unit/test_redact.py::test_redact_sensitive_data_string PASSED                                                                                                                                                                                                    [ 97%]
tests/unit/test_redact.py::test_redact_sensitive_data_custom_keys PASSED                                                                                                                                                                                               [ 97%]
tests/unit/test_slash_commands.py::test_help_and_compact_registered PASSED                                                                                                                                                                                             [ 97%]
tests/unit/test_slash_commands.py::test_model_command_list_and_set PASSED                                                                                                                                                                                              [ 98%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/approval-approval] PASSED                                                                                                                                                                           [ 98%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/history-history] PASSED                                                                                                                                                                             [ 98%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/clear-cleared] PASSED                                                                                                                                                                               [ 99%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/clearhistory-cleared] PASSED                                                                                                                                                                        [ 99%]
tests/unit/test_spinner.py::test_spinner_runs_and_stops PASSED                                                                                                                                                                                                         [ 99%]
tests/unit/test_spinner.py::test_spinner_long_wait PASSED                                                                                                                                                                                                              [100%]

============================================================================================================================== warnings summary ==============================================================================================================================
../../../home/chatgpt/.local/lib/python3.10/site-packages/_pytest/config/__init__.py:1441
  /home/chatgpt/.local/lib/python3.10/site-packages/_pytest/config/__init__.py:1441: PytestConfigWarning: Unknown config option: env
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

../../../home/chatgpt/.local/lib/python3.10/site-packages/starlette/formparsers.py:12
  /home/chatgpt/.local/lib/python3.10/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

../../../home/chatgpt/.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323
  /home/chatgpt/.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=================================================================================================================================== PASSES ===================================================================================================================================
___________________________________________________________________________________________________________________ test_models_empty_registry_returns_200 ___________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
Creating test database for alias 'default'...
Destroying old test database for alias 'default'...
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:29,808 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 21:00:29,808 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 21:00:29,808 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 21:00:29,808 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 21:00:29,809 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 21:00:29,809 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:29,809 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:29,813 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 21:00:29,813 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:29,813 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 21:00:29,813 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 21:00:29,817 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 21:00:29,817 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 21:00:29,817 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 21:00:29,817 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 21:00:29,818 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 21:00:29,818 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 21:00:29,818 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 21:00:29,818 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 21:00:29,818 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 21:00:29,818 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 21:00:29,819 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 21:00:29,820 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 21:00:29,821 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 21:00:29,821 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 21:00:29,821 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 21:00:29,821 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 21:00:29,822 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 21:00:29,822 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 21:00:29,822 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 21:00:29,822 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 21:00:29,822 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 21:00:29,823 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 21:00:29,823 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 21:00:29,823 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 21:00:29,823 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 21:00:29,832 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 21:00:29,833 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
# Last swarm update: 2025-08-24T21:00:29Z (UTC)
[DEBUG] 2025-08-24 21:00:29,838 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 21:00:29,838 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 21:00:29,838 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 21:00:29,839 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 21:00:29,839 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 21:00:29,839 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 21:00:29,839 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 21:00:29,839 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 21:00:29,839 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 21:00:29,840 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 21:00:29,841 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 21:00:29,841 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 21:00:29,841 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 21:00:29,841 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:29,806 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:29,806 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:29,807 - asyncio:54 - Using selector: EpollSelector
[INFO] 2025-08-24 21:00:29,808 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[DEBUG] 2025-08-24 21:00:29,844 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 21:00:29,844 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 21:00:29,844 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 21:00:29,844 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 21:00:29,846 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 21:00:29,846 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 21:00:29,846 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 21:00:29,846 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 21:00:29,846 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 21:00:29,846 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 21:00:29,847 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 21:00:29,848 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 21:00:29,848 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 21:00:29,848 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 21:00:29,848 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 21:00:29,848 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 21:00:29,848 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 21:00:29,852 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 21:00:29,852 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 21:00:29,852 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 21:00:29,853 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 21:00:29,853 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T21:00:29Z (UTC)
[DEBUG] 2025-08-24 21:00:29,853 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 21:00:29,853 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 21:00:29,854 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 21:00:29,854 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
__________________________________________________________________________________________________________ test_models_non_mapping_iterable_gracefully_handles_type __________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:29,860 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:29,860 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
________________________________________________________________________________________________________ TestAgentCreatorProViews.test_agent_creator_pro_page_context ________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:30,270 - swarm.utils.comfyui_client:25 - ComfyUI is disabled. Avatar generation will not be available.
_______________________________________________________________________________________________________________ TestSettingsManager.test_collect_all_settings ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:30,527 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:30,528 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:30,529 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:30,529 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:30,529 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:30,529 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
______________________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_api_get ______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:31,217 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,218 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,219 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
___________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_api_sensitive_data_filtering ____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:31,442 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,442 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,443 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,444 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,444 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,444 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_________________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_dashboard_context _________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:31,666 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,666 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,666 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:31,667 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_____________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_dashboard_error_handling ______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 21:00:31,900 - django.request:241 - Internal Server Error: /settings/
___________________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_dashboard_get ___________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:32,122 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,122 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,123 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,124 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,124 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_______________________________________________________________________________________________________ TestSettingsIntegration.test_full_settings_collection_workflow _______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:32,144 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,144 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,145 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,146 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,152 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,152 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:32,153 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
___________________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_no_auth_returns_403 ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:32,412 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:32,414 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: AnonymousUser, Authenticated: False
[DEBUG] 2025-08-24 21:00:32,415 - print_debug:171 - User before perform_authentication: AnonymousUser, Auth: None
[DEBUG] 2025-08-24 21:00:32,416 - print_debug:174 - User after perform_authentication: AnonymousUser, Auth: None
[WARNING] 2025-08-24 21:00:32,419 - django.request:241 - Forbidden: /v1/chat/completions
________________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_invalid_token_returns_403 _________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:32,749 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:32,750 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: AnonymousUser, Authenticated: False
[DEBUG] 2025-08-24 21:00:32,752 - print_debug:171 - User before perform_authentication: AnonymousUser, Auth: None
[DEBUG] 2025-08-24 21:00:32,752 - print_debug:174 - User after perform_authentication: AnonymousUser, Auth: None
[WARNING] 2025-08-24 21:00:32,755 - django.request:241 - Forbidden: /v1/chat/completions
________________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_valid_token_allows_access _________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:33,198 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:33,199 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: AnonymousUser, Authenticated: False
[DEBUG] 2025-08-24 21:00:33,200 - print_debug:171 - User before perform_authentication: testuser, Auth: valid_api_key
[DEBUG] 2025-08-24 21:00:33,201 - print_debug:174 - User after perform_authentication: testuser, Auth: valid_api_key
[DEBUG] 2025-08-24 21:00:33,201 - swarm.auth:110 - [Perm][TokenOrSession] Access granted via static token (request.auth is set).
[DEBUG] 2025-08-24 21:00:33,201 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:33,201 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:33,201 - swarm.views.chat_views:219 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Processing POST request.
[DEBUG] 2025-08-24 21:00:33,201 - print_debug:220 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] User in post: testuser, Auth: valid_api_key
[DEBUG] 2025-08-24 21:00:33,201 - print_debug:230 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:33,202 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:33,202 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:33,202 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 21:00:33,203 - print_debug:233 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Request data validation successful.
[DEBUG] 2025-08-24 21:00:33,203 - print_debug:245 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 21:00:33,203 - print_debug:254 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Getting blueprint instance for 'echocraft' with params: None
[INFO] 2025-08-24 21:00:33,204 - swarm.views.chat_views:88 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Processing non-streaming request for model 'echocraft'.
[DEBUG] 2025-08-24 21:00:33,204 - swarm.views.chat_views:98 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Received final data chunk (messages list).
[INFO] 2025-08-24 21:00:33,204 - swarm.views.chat_views:118 - [ReqID: 52611708-00cb-4d7c-9569-05ee7c0e88cf] Non-streaming request completed in 0.00s.
_______________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_valid_session_allows_access ________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:33,550 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:33,553 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:33,554 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:33,554 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:33,554 - swarm.auth:118 - [Perm][TokenOrSession] Access granted via authenticated session user: testuser
[DEBUG] 2025-08-24 21:00:33,554 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:33,554 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:33,555 - swarm.views.chat_views:219 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Processing POST request.
[DEBUG] 2025-08-24 21:00:33,555 - print_debug:220 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:33,555 - print_debug:230 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'session test'}]}
[DEBUG] 2025-08-24 21:00:33,555 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'session test'}
[DEBUG] 2025-08-24 21:00:33,555 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'session test'}
[DEBUG] 2025-08-24 21:00:33,556 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 21:00:33,556 - print_debug:233 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Request data validation successful.
[DEBUG] 2025-08-24 21:00:33,556 - print_debug:245 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 21:00:33,557 - print_debug:254 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Getting blueprint instance for 'echocraft' with params: None
[INFO] 2025-08-24 21:00:33,557 - swarm.views.chat_views:88 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Processing non-streaming request for model 'echocraft'.
[DEBUG] 2025-08-24 21:00:33,557 - swarm.views.chat_views:98 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Received final data chunk (messages list).
[INFO] 2025-08-24 21:00:33,557 - swarm.views.chat_views:118 - [ReqID: bcb8ada2-6348-41a8-8d93-a8074fcccbdc] Non-streaming request completed in 0.00s.
______________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_echocraft_non_streaming_success_auth_disabled _______________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:33,905 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:33,908 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:33,909 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:33,909 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:33,910 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:33,910 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:33,910 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:33,910 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:33,910 - swarm.views.chat_views:219 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Processing POST request.
[DEBUG] 2025-08-24 21:00:33,910 - print_debug:220 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:33,910 - print_debug:230 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'Hello EchoCraft'}]}
[DEBUG] 2025-08-24 21:00:33,911 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Hello EchoCraft'}
[DEBUG] 2025-08-24 21:00:33,911 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Hello EchoCraft'}
[DEBUG] 2025-08-24 21:00:33,911 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 21:00:33,911 - print_debug:233 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Request data validation successful.
[DEBUG] 2025-08-24 21:00:33,911 - print_debug:245 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 21:00:33,912 - print_debug:254 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Getting blueprint instance for 'echocraft' with params: None
[INFO] 2025-08-24 21:00:33,913 - swarm.views.chat_views:88 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Processing non-streaming request for model 'echocraft'.
[DEBUG] 2025-08-24 21:00:33,913 - swarm.views.chat_views:98 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Received final data chunk (messages list).
[INFO] 2025-08-24 21:00:33,913 - swarm.views.chat_views:118 - [ReqID: 78ecbabd-82bf-41ca-b233-c7631067ac72] Non-streaming request completed in 0.00s.
_______________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_chatbot_non_streaming_success_auth_disabled ________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:34,262 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:34,265 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:34,267 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:34,267 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:34,267 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:34,268 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:34,268 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:34,268 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:34,268 - swarm.views.chat_views:219 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Processing POST request.
[DEBUG] 2025-08-24 21:00:34,268 - print_debug:220 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:34,269 - print_debug:230 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Validating request data: {'model': 'chatbot', 'messages': [{'role': 'user', 'content': 'Hi Chatbot'}]}
[DEBUG] 2025-08-24 21:00:34,269 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Hi Chatbot'}
[DEBUG] 2025-08-24 21:00:34,269 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Hi Chatbot'}
[DEBUG] 2025-08-24 21:00:34,269 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: chatbot
[DEBUG] 2025-08-24 21:00:34,270 - print_debug:233 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Request data validation successful.
[DEBUG] 2025-08-24 21:00:34,270 - print_debug:245 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Checking model access for user 'testuser' and model 'chatbot'
[DEBUG] 2025-08-24 21:00:34,271 - print_debug:254 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Getting blueprint instance for 'chatbot' with params: None
[INFO] 2025-08-24 21:00:34,271 - swarm.views.chat_views:88 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Processing non-streaming request for model 'chatbot'.
[DEBUG] 2025-08-24 21:00:34,271 - swarm.views.chat_views:98 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Received final data chunk (messages list).
[INFO] 2025-08-24 21:00:34,271 - swarm.views.chat_views:118 - [ReqID: 753b67ff-b32b-4aeb-9450-2bedbc709aec] Non-streaming request completed in 0.00s.
____________________________________________________________________________________________________ TestChatCompletionsAPIFailingAsync.test_echocraft_streaming_success _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:34,621 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:34,624 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:34,625 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:34,626 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:34,626 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:34,626 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:34,626 - swarm.views.chat_views:219 - [ReqID: 747df92a-208f-447d-a8af-958e830a1713] Processing POST request.
[DEBUG] 2025-08-24 21:00:34,626 - print_debug:220 - [ReqID: 747df92a-208f-447d-a8af-958e830a1713] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:34,626 - print_debug:230 - [ReqID: 747df92a-208f-447d-a8af-958e830a1713] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'Stream me'}], 'stream': True}
[DEBUG] 2025-08-24 21:00:34,627 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Stream me'}
[DEBUG] 2025-08-24 21:00:34,627 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Stream me'}
[DEBUG] 2025-08-24 21:00:34,627 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 21:00:34,627 - print_debug:233 - [ReqID: 747df92a-208f-447d-a8af-958e830a1713] Request data validation successful.
[DEBUG] 2025-08-24 21:00:34,627 - print_debug:245 - [ReqID: 747df92a-208f-447d-a8af-958e830a1713] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 21:00:34,628 - print_debug:254 - [ReqID: 747df92a-208f-447d-a8af-958e830a1713] Getting blueprint instance for 'echocraft' with params: None
_____________________________________________________________________________________________________ TestChatCompletionsAPIFailingAsync.test_chatbot_streaming_success ______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:35,000 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:35,003 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:35,004 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,005 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,005 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:35,005 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:35,005 - swarm.views.chat_views:219 - [ReqID: ae378f62-9ad8-407b-b589-0b65e20972e7] Processing POST request.
[DEBUG] 2025-08-24 21:00:35,005 - print_debug:220 - [ReqID: ae378f62-9ad8-407b-b589-0b65e20972e7] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,005 - print_debug:230 - [ReqID: ae378f62-9ad8-407b-b589-0b65e20972e7] Validating request data: {'model': 'chatbot', 'messages': [{'role': 'user', 'content': 'Hi'}], 'stream': True}
[DEBUG] 2025-08-24 21:00:35,006 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Hi'}
[DEBUG] 2025-08-24 21:00:35,006 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Hi'}
[DEBUG] 2025-08-24 21:00:35,006 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: chatbot
[DEBUG] 2025-08-24 21:00:35,006 - print_debug:233 - [ReqID: ae378f62-9ad8-407b-b589-0b65e20972e7] Request data validation successful.
[DEBUG] 2025-08-24 21:00:35,006 - print_debug:245 - [ReqID: ae378f62-9ad8-407b-b589-0b65e20972e7] Checking model access for user 'testuser' and model 'chatbot'
[DEBUG] 2025-08-24 21:00:35,007 - print_debug:254 - [ReqID: ae378f62-9ad8-407b-b589-0b65e20972e7] Getting blueprint instance for 'chatbot' with params: None
________________________________________________________________________________________ TestChatCompletionsAPIFailingAsync.test_blueprint_run_exception_streaming_returns_error_sse _________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:35,392 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:35,394 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:35,396 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,396 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,396 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:35,396 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:35,396 - swarm.views.chat_views:219 - [ReqID: 0b16ef7d-bc6a-4070-ad1d-15b45158adb0] Processing POST request.
[DEBUG] 2025-08-24 21:00:35,397 - print_debug:220 - [ReqID: 0b16ef7d-bc6a-4070-ad1d-15b45158adb0] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,397 - print_debug:230 - [ReqID: 0b16ef7d-bc6a-4070-ad1d-15b45158adb0] Validating request data: {'model': 'error_bp', 'messages': [{'role': 'user', 'content': 'Cause error'}], 'stream': True}
[DEBUG] 2025-08-24 21:00:35,398 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Cause error'}
[DEBUG] 2025-08-24 21:00:35,398 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Cause error'}
[DEBUG] 2025-08-24 21:00:35,398 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: error_bp
[DEBUG] 2025-08-24 21:00:35,398 - print_debug:233 - [ReqID: 0b16ef7d-bc6a-4070-ad1d-15b45158adb0] Request data validation successful.
[DEBUG] 2025-08-24 21:00:35,398 - print_debug:245 - [ReqID: 0b16ef7d-bc6a-4070-ad1d-15b45158adb0] Checking model access for user 'testuser' and model 'error_bp'
[DEBUG] 2025-08-24 21:00:35,399 - print_debug:254 - [ReqID: 0b16ef7d-bc6a-4070-ad1d-15b45158adb0] Getting blueprint instance for 'error_bp' with params: None
_____________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_missing_required_field_returns_400[model] ______________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:35,754 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:35,757 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:35,759 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:35,759 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:35,759 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,759 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,759 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:35,759 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:35,759 - swarm.views.chat_views:219 - [ReqID: 8eba96a8-94b6-4f42-966b-f2f41e9d31da] Processing POST request.
[DEBUG] 2025-08-24 21:00:35,759 - print_debug:220 - [ReqID: 8eba96a8-94b6-4f42-966b-f2f41e9d31da] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:35,760 - print_debug:230 - [ReqID: 8eba96a8-94b6-4f42-966b-f2f41e9d31da] Validating request data: {'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:35,760 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:35,760 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[ERROR] 2025-08-24 21:00:35,761 - print_debug:234 - [ReqID: 8eba96a8-94b6-4f42-966b-f2f41e9d31da] Request data validation FAILED: {'model': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 21:00:35,764 - django.request:241 - Bad Request: /v1/chat/completions
____________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_missing_required_field_returns_400[messages] ____________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:36,101 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:36,104 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:36,105 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:36,105 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:36,105 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,106 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,106 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:36,106 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:36,106 - swarm.views.chat_views:219 - [ReqID: 67bf2681-de27-4050-9b9a-fc65570fe69e] Processing POST request.
[DEBUG] 2025-08-24 21:00:36,106 - print_debug:220 - [ReqID: 67bf2681-de27-4050-9b9a-fc65570fe69e] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,106 - print_debug:230 - [ReqID: 67bf2681-de27-4050-9b9a-fc65570fe69e] Validating request data: {'model': 'test_model'}
[ERROR] 2025-08-24 21:00:36,107 - print_debug:234 - [ReqID: 67bf2681-de27-4050-9b9a-fc65570fe69e] Request data validation FAILED: {'messages': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 21:00:36,110 - django.request:241 - Bad Request: /v1/chat/completions
_________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data0-Ensure this field has at least 1 elements] _________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:36,448 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:36,451 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:36,452 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:36,452 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:36,452 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,453 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,453 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:36,453 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:36,453 - swarm.views.chat_views:219 - [ReqID: 7384f5fa-d54a-47c7-bc9d-8b4de86fd2ad] Processing POST request.
[DEBUG] 2025-08-24 21:00:36,453 - print_debug:220 - [ReqID: 7384f5fa-d54a-47c7-bc9d-8b4de86fd2ad] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,453 - print_debug:230 - [ReqID: 7384f5fa-d54a-47c7-bc9d-8b4de86fd2ad] Validating request data: {'model': 'test', 'messages': []}
[ERROR] 2025-08-24 21:00:36,454 - print_debug:234 - [ReqID: 7384f5fa-d54a-47c7-bc9d-8b4de86fd2ad] Request data validation FAILED: {'messages': {'non_field_errors': [ErrorDetail(string='Ensure this field has at least 1 elements.', code='min_length')]}}
[WARNING] 2025-08-24 21:00:36,457 - django.request:241 - Bad Request: /v1/chat/completions
_________________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data1-Expected a list of items] __________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:36,797 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:36,799 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:36,801 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:36,801 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:36,801 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,801 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,801 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:36,801 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:36,802 - swarm.views.chat_views:219 - [ReqID: 3b4e546c-8ae9-40ed-8f47-1f887472c641] Processing POST request.
[DEBUG] 2025-08-24 21:00:36,802 - print_debug:220 - [ReqID: 3b4e546c-8ae9-40ed-8f47-1f887472c641] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:36,802 - print_debug:230 - [ReqID: 3b4e546c-8ae9-40ed-8f47-1f887472c641] Validating request data: {'model': 'test', 'messages': 'not a list'}
[ERROR] 2025-08-24 21:00:36,803 - print_debug:234 - [ReqID: 3b4e546c-8ae9-40ed-8f47-1f887472c641] Request data validation FAILED: {'messages': {'non_field_errors': [ErrorDetail(string='Expected a list of items but got type "str".', code='not_a_list')]}}
[WARNING] 2025-08-24 21:00:36,806 - django.request:241 - Bad Request: /v1/chat/completions
__________________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data2-This field is required.] __________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:37,150 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:37,153 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:37,154 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:37,154 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:37,154 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,154 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,154 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:37,155 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:37,155 - swarm.views.chat_views:219 - [ReqID: b755bf42-9857-42b0-b8a1-4897553e567b] Processing POST request.
[DEBUG] 2025-08-24 21:00:37,155 - print_debug:220 - [ReqID: b755bf42-9857-42b0-b8a1-4897553e567b] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,155 - print_debug:230 - [ReqID: b755bf42-9857-42b0-b8a1-4897553e567b] Validating request data: {'model': 'test'}
[ERROR] 2025-08-24 21:00:37,156 - print_debug:234 - [ReqID: b755bf42-9857-42b0-b8a1-4897553e567b] Request data validation FAILED: {'messages': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 21:00:37,159 - django.request:241 - Bad Request: /v1/chat/completions
__________________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data3-This field is required.] __________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:37,501 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:37,504 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:37,505 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:37,505 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:37,506 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,506 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,506 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:37,506 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:37,506 - swarm.views.chat_views:219 - [ReqID: 8f064c37-47fb-4d24-8e73-e21d6d514d8f] Processing POST request.
[DEBUG] 2025-08-24 21:00:37,506 - print_debug:220 - [ReqID: 8f064c37-47fb-4d24-8e73-e21d6d514d8f] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,506 - print_debug:230 - [ReqID: 8f064c37-47fb-4d24-8e73-e21d6d514d8f] Validating request data: {'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:37,507 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:37,507 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[ERROR] 2025-08-24 21:00:37,508 - print_debug:234 - [ReqID: 8f064c37-47fb-4d24-8e73-e21d6d514d8f] Request data validation FAILED: {'model': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 21:00:37,511 - django.request:241 - Bad Request: /v1/chat/completions
______________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data4-invalid" is not a valid choice] _______________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:37,879 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:37,882 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:37,883 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:37,883 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:37,883 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,884 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,884 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:37,884 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:37,884 - swarm.views.chat_views:219 - [ReqID: cee4e076-ba88-4951-aba9-39ae3f4d58a6] Processing POST request.
[DEBUG] 2025-08-24 21:00:37,884 - print_debug:220 - [ReqID: cee4e076-ba88-4951-aba9-39ae3f4d58a6] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:37,885 - print_debug:230 - [ReqID: cee4e076-ba88-4951-aba9-39ae3f4d58a6] Validating request data: {'model': 'test', 'messages': [{'role': 'invalid', 'content': 'test'}]}
[ERROR] 2025-08-24 21:00:37,886 - print_debug:234 - [ReqID: cee4e076-ba88-4951-aba9-39ae3f4d58a6] Request data validation FAILED: {'messages': [{'role': [ErrorDetail(string='"invalid" is not a valid choice.', code='invalid_choice')]}]}
[WARNING] 2025-08-24 21:00:37,889 - django.request:241 - Bad Request: /v1/chat/completions
_____________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data5-Content must be a string or null.] _____________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:38,257 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:38,260 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:38,261 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:38,261 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:38,261 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,262 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,262 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:38,262 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:38,262 - swarm.views.chat_views:219 - [ReqID: 9ea07bd9-3f1c-4a73-a887-117c9a96d764] Processing POST request.
[DEBUG] 2025-08-24 21:00:38,262 - print_debug:220 - [ReqID: 9ea07bd9-3f1c-4a73-a887-117c9a96d764] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,262 - print_debug:230 - [ReqID: 9ea07bd9-3f1c-4a73-a887-117c9a96d764] Validating request data: {'model': 'test', 'messages': [{'role': 'user', 'content': 123}]}
[DEBUG] 2025-08-24 21:00:38,263 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': '123'}
[DEBUG] 2025-08-24 21:00:38,263 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': '123'}
[ERROR] 2025-08-24 21:00:38,263 - print_debug:234 - [ReqID: 9ea07bd9-3f1c-4a73-a887-117c9a96d764] Request data validation FAILED: {'messages': [{'content': [ErrorDetail(string='Content must be a string or null.', code='invalid')]}]}
[WARNING] 2025-08-24 21:00:38,267 - django.request:241 - Bad Request: /v1/chat/completions
_____________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_malformed_json_returns_400 _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:38,609 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:38,612 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:38,613 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:38,613 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:38,613 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,614 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,614 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:38,614 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:38,614 - swarm.views.chat_views:219 - [ReqID: 42270ee7-9ac2-413c-bcdb-eb63c6da8cbf] Processing POST request.
[DEBUG] 2025-08-24 21:00:38,614 - print_debug:220 - [ReqID: 42270ee7-9ac2-413c-bcdb-eb63c6da8cbf] User in post: testuser, Auth: None
[ERROR] 2025-08-24 21:00:38,614 - swarm.views.chat_views:224 - [ReqID: 42270ee7-9ac2-413c-bcdb-eb63c6da8cbf] Invalid request body format: JSON parse error - Expecting ',' delimiter: line 1 column 66 (char 65)
[WARNING] 2025-08-24 21:00:38,618 - django.request:241 - Bad Request: /v1/chat/completions
________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_nonexistent_model_permission_denied _________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:38,964 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:38,967 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:38,968 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:38,968 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:38,969 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,969 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,969 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:38,969 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:38,969 - swarm.views.chat_views:219 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] Processing POST request.
[DEBUG] 2025-08-24 21:00:38,969 - print_debug:220 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:38,969 - print_debug:230 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] Validating request data: {'model': 'nonexistent_model', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:38,970 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:38,970 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:38,970 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: nonexistent_model
[DEBUG] 2025-08-24 21:00:38,971 - print_debug:233 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] Request data validation successful.
[DEBUG] 2025-08-24 21:00:38,971 - print_debug:245 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] Checking model access for user 'testuser' and model 'nonexistent_model'
[DEBUG] 2025-08-24 21:00:38,972 - print_debug:254 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] Getting blueprint instance for 'nonexistent_model' with params: None
[WARNING] 2025-08-24 21:00:38,972 - swarm.views.chat_views:267 - [ReqID: fbec9da1-70aa-415d-9b40-2b2dff4fca1d] User 'testuser' denied access to model 'nonexistent_model'.
[WARNING] 2025-08-24 21:00:38,975 - django.request:241 - Forbidden: /v1/chat/completions
____________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_nonexistent_model_not_found _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:39,317 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:39,320 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:39,321 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:39,321 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:39,321 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:39,322 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:39,322 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:39,322 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:39,322 - swarm.views.chat_views:219 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] Processing POST request.
[DEBUG] 2025-08-24 21:00:39,322 - print_debug:220 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:39,322 - print_debug:230 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] Validating request data: {'model': 'not_found_model', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:39,323 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:39,323 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:39,323 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: not_found_model
[DEBUG] 2025-08-24 21:00:39,324 - print_debug:233 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] Request data validation successful.
[DEBUG] 2025-08-24 21:00:39,324 - print_debug:245 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] Checking model access for user 'testuser' and model 'not_found_model'
[DEBUG] 2025-08-24 21:00:39,325 - print_debug:254 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] Getting blueprint instance for 'not_found_model' with params: None
[ERROR] 2025-08-24 21:00:39,325 - swarm.views.chat_views:262 - [ReqID: 4c4ca281-d214-4817-b0b7-f05420c6a615] Blueprint 'not_found_model' not found or failed to initialize (get_blueprint_instance returned None).
[WARNING] 2025-08-24 21:00:39,328 - django.request:241 - Not Found: /v1/chat/completions
__________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_blueprint_init_error_returns_500 __________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:39,665 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:39,668 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:39,670 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:39,670 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:39,670 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:39,670 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:39,670 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:39,670 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:39,670 - swarm.views.chat_views:219 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] Processing POST request.
[DEBUG] 2025-08-24 21:00:39,671 - print_debug:220 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:39,671 - print_debug:230 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] Validating request data: {'model': 'config_error_bp', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:39,671 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:39,671 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:39,671 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: config_error_bp
[DEBUG] 2025-08-24 21:00:39,672 - print_debug:233 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] Request data validation successful.
[DEBUG] 2025-08-24 21:00:39,672 - print_debug:245 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] Checking model access for user 'testuser' and model 'config_error_bp'
[DEBUG] 2025-08-24 21:00:39,673 - print_debug:254 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] Getting blueprint instance for 'config_error_bp' with params: None
[ERROR] 2025-08-24 21:00:39,673 - swarm.views.chat_views:258 - [ReqID: 899552a2-f7a8-43be-bc57-ba80f17aca10] Error getting blueprint instance for 'config_error_bp': Failed to initialize blueprint
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/views/chat_views.py", line 256, in post
    blueprint_instance = await get_blueprint_instance(model_name, params=blueprint_params)
  File "/usr/lib/python3.10/unittest/mock.py", line 2234, in _execute_mock_call
    raise effect
ValueError: Failed to initialize blueprint
[ERROR] 2025-08-24 21:00:39,677 - django.request:241 - Internal Server Error: /v1/chat/completions
_________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_blueprint_run_exception_non_streaming_returns_500 __________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:40,025 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 21:00:40,028 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 21:00:40,029 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:40,029 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 21:00:40,029 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:40,030 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:40,030 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 21:00:40,030 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 21:00:40,030 - swarm.views.chat_views:219 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Processing POST request.
[DEBUG] 2025-08-24 21:00:40,030 - print_debug:220 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 21:00:40,030 - print_debug:230 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Validating request data: {'model': 'runtime_error_bp', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 21:00:40,031 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:40,031 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 21:00:40,031 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: runtime_error_bp
[DEBUG] 2025-08-24 21:00:40,032 - print_debug:233 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Request data validation successful.
[DEBUG] 2025-08-24 21:00:40,032 - print_debug:245 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Checking model access for user 'testuser' and model 'runtime_error_bp'
[DEBUG] 2025-08-24 21:00:40,033 - print_debug:254 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Getting blueprint instance for 'runtime_error_bp' with params: None
[INFO] 2025-08-24 21:00:40,033 - swarm.views.chat_views:88 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Processing non-streaming request for model 'runtime_error_bp'.
[ERROR] 2025-08-24 21:00:40,033 - swarm.views.chat_views:121 - [ReqID: 8cb68443-8853-4f98-a7fa-c6af3d2cd477] Unexpected error during non-streaming blueprint execution: Blueprint execution failed
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/views/chat_views.py", line 93, in _handle_non_streaming
    async for chunk in async_generator:
  File "/mnt/models/open-swarm-mcp/tests/api/test_chat_completions_validation_async.py", line 152, in failing_run
    raise RuntimeError("Blueprint execution failed")
RuntimeError: Blueprint execution failed
[ERROR] 2025-08-24 21:00:40,037 - django.request:241 - Internal Server Error: /v1/chat/completions
_________________________________________________________________________________________________________ test_models_and_blueprints_endpoints_include_dynamic_team __________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
# Last swarm update: 2025-08-24T21:00:40Z (UTC)
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:40,118 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:40,118 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[INFO] 2025-08-24 21:00:40,119 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[INFO] 2025-08-24 21:00:40,119 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 21:00:40,119 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 21:00:40,119 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 21:00:40,120 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 21:00:40,120 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 21:00:40,120 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,120 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,124 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 21:00:40,124 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,124 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 21:00:40,124 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 21:00:40,129 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 21:00:40,129 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 21:00:40,129 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 21:00:40,129 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 21:00:40,130 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 21:00:40,131 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 21:00:40,132 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 21:00:40,133 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 21:00:40,134 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 21:00:40,134 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 21:00:40,134 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 21:00:40,134 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 21:00:40,144 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 21:00:40,144 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 21:00:40,144 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 21:00:40,144 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 21:00:40,145 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 21:00:40,145 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 21:00:40,145 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 21:00:40,145 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 21:00:40,145 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 21:00:40,145 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 21:00:40,146 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 21:00:40,146 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 21:00:40,146 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 21:00:40,146 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 21:00:40,146 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
[DEBUG] 2025-08-24 21:00:40,151 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 21:00:40,151 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 21:00:40,151 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 21:00:40,152 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 21:00:40,152 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 21:00:40,152 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 21:00:40,152 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 21:00:40,153 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 21:00:40,154 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 21:00:40,154 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 21:00:40,154 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 21:00:40,154 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 21:00:40,154 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
[DEBUG] 2025-08-24 21:00:40,160 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 21:00:40,160 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 21:00:40,160 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 21:00:40,160 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 21:00:40,160 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 21:00:40,161 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 21:00:40,161 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 21:00:40,161 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 21:00:40,161 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 21:00:40,161 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 21:00:40,161 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 21:00:40,162 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 21:00:40,163 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 21:00:40,163 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 21:00:40,163 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 21:00:40,163 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 21:00:40,163 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 21:00:40,163 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 21:00:40,168 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 21:00:40,168 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 21:00:40,168 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 21:00:40,168 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 21:00:40,168 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T21:00:40Z (UTC)
[DEBUG] 2025-08-24 21:00:40,169 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 21:00:40,169 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 21:00:40,169 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 21:00:40,169 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo', 'demo-api-team']
[DEBUG] 2025-08-24 21:00:40,171 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 21:00:40,171 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
______________________________________________________________________________________________________________ test_reset_clears_dynamic_registry_and_discovery ______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
# Last swarm update: 2025-08-24T21:00:40Z (UTC)
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:40,345 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[INFO] 2025-08-24 21:00:40,345 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 21:00:40,346 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 21:00:40,346 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 21:00:40,346 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 21:00:40,346 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 21:00:40,346 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,346 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,350 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 21:00:40,351 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,351 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 21:00:40,351 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 21:00:40,355 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 21:00:40,355 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 21:00:40,355 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 21:00:40,355 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 21:00:40,356 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 21:00:40,357 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 21:00:40,358 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 21:00:40,359 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 21:00:40,360 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 21:00:40,360 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 21:00:40,360 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 21:00:40,360 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 21:00:40,371 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 21:00:40,371 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 21:00:40,371 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 21:00:40,371 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 21:00:40,372 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 21:00:40,372 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 21:00:40,372 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 21:00:40,372 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 21:00:40,372 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 21:00:40,372 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 21:00:40,373 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 21:00:40,373 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 21:00:40,373 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 21:00:40,373 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 21:00:40,373 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
[DEBUG] 2025-08-24 21:00:40,380 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 21:00:40,380 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 21:00:40,381 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 21:00:40,381 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 21:00:40,381 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 21:00:40,381 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 21:00:40,382 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 21:00:40,382 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 21:00:40,382 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 21:00:40,382 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 21:00:40,383 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 21:00:40,383 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 21:00:40,383 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 21:00:40,383 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 21:00:40,383 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 21:00:40,383 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 21:00:40,386 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 21:00:40,386 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 21:00:40,386 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 21:00:40,386 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 21:00:40,386 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
[DEBUG] 2025-08-24 21:00:40,391 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 21:00:40,391 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 21:00:40,391 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 21:00:40,391 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 21:00:40,391 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 21:00:40,391 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 21:00:40,392 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 21:00:40,392 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 21:00:40,392 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 21:00:40,392 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 21:00:40,393 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 21:00:40,394 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 21:00:40,394 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 21:00:40,395 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 21:00:40,395 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 21:00:40,395 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 21:00:40,395 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 21:00:40,400 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 21:00:40,400 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 21:00:40,400 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 21:00:40,400 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 21:00:40,401 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T21:00:40Z (UTC)
[DEBUG] 2025-08-24 21:00:40,401 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 21:00:40,401 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 21:00:40,402 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 21:00:40,402 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
_____________________________________________________________________________________________________________ test_dynamic_team_registry_and_discovery_roundtrip _____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
# Last swarm update: 2025-08-24T21:00:40Z (UTC)
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:40,500 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[INFO] 2025-08-24 21:00:40,500 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 21:00:40,500 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 21:00:40,500 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 21:00:40,501 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 21:00:40,501 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 21:00:40,501 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,501 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,505 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 21:00:40,506 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 21:00:40,506 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 21:00:40,506 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 21:00:40,510 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 21:00:40,511 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 21:00:40,512 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 21:00:40,512 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 21:00:40,512 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 21:00:40,512 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 21:00:40,512 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 21:00:40,512 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 21:00:40,513 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 21:00:40,513 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 21:00:40,513 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 21:00:40,513 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 21:00:40,513 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 21:00:40,513 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 21:00:40,514 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 21:00:40,515 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 21:00:40,516 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 21:00:40,516 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 21:00:40,525 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 21:00:40,525 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 21:00:40,526 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 21:00:40,526 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 21:00:40,526 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 21:00:40,526 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 21:00:40,526 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 21:00:40,526 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 21:00:40,527 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
[DEBUG] 2025-08-24 21:00:40,533 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 21:00:40,533 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 21:00:40,533 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 21:00:40,533 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 21:00:40,533 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 21:00:40,533 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 21:00:40,534 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 21:00:40,534 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 21:00:40,534 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 21:00:40,535 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 21:00:40,536 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 21:00:40,536 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 21:00:40,536 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 21:00:40,536 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 21:00:40,536 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
[DEBUG] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 21:00:40,540 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 21:00:40,541 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 21:00:40,541 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 21:00:40,541 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 21:00:40,541 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 21:00:40,541 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 21:00:40,541 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 21:00:40,543 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 21:00:40,543 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 21:00:40,543 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 21:00:40,543 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 21:00:40,543 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 21:00:40,543 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 21:00:40,544 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 21:00:40,544 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 21:00:40,544 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 21:00:40,545 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 21:00:40,545 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 21:00:40,545 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 21:00:40,549 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 21:00:40,549 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 21:00:40,549 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 21:00:40,549 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 21:00:40,550 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T21:00:40Z (UTC)
[DEBUG] 2025-08-24 21:00:40,550 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 21:00:40,550 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 21:00:40,550 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 21:00:40,550 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo', 'demo-team']
____________________________________________________________________________________________________________________________ test_zeus_run_method ____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:40,703 - swarm.blueprints.zeus.blueprint_zeus:79 - ZeusCoordinatorBlueprint run method called.
________________________________________________________________________________________________________________________ test_echocraft_blueprint_run ________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:40,718 - swarm.blueprints.echocraft.blueprint_echocraft:247 - EchoCraftBlueprint run called with 1 messages.
[DEBUG] 2025-08-24 21:00:40,718 - swarm.blueprints.echocraft.blueprint_echocraft:257 - Found last user message: Hello
[INFO] 2025-08-24 21:00:40,718 - swarm.blueprints.echocraft.blueprint_echocraft:261 - EchoCraftBlueprint yielding: Echo: Hello
[DEBUG] 2025-08-24 21:00:40,718 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_echo_run
[DEBUG] 2025-08-24 21:00:40,718 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {}
[DEBUG] 2025-08-24 21:00:40,718 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: default
[DEBUG] 2025-08-24 21:00:40,718 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[INFO] 2025-08-24 21:00:40,718 - swarm.blueprints.echocraft.blueprint_echocraft:286 - EchoCraftBlueprint run finished.
__________________________________________________________________________________________________________________ test_echocraft_blueprint_no_user_message __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:40,729 - swarm.blueprints.echocraft.blueprint_echocraft:247 - EchoCraftBlueprint run called with 1 messages.
[INFO] 2025-08-24 21:00:40,729 - swarm.blueprints.echocraft.blueprint_echocraft:261 - EchoCraftBlueprint yielding: Echo: No user message found.
[DEBUG] 2025-08-24 21:00:40,729 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_echo_nouser
[DEBUG] 2025-08-24 21:00:40,729 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {}
[DEBUG] 2025-08-24 21:00:40,729 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: default
[DEBUG] 2025-08-24 21:00:40,729 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[INFO] 2025-08-24 21:00:40,729 - swarm.blueprints.echocraft.blueprint_echocraft:286 - EchoCraftBlueprint run finished.
_________________________________________________________________________________________________________________ test_echocraft_blueprint_multiple_messages _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:40,737 - swarm.blueprints.echocraft.blueprint_echocraft:247 - EchoCraftBlueprint run called with 3 messages.
[DEBUG] 2025-08-24 21:00:40,737 - swarm.blueprints.echocraft.blueprint_echocraft:257 - Found last user message: Second
[INFO] 2025-08-24 21:00:40,737 - swarm.blueprints.echocraft.blueprint_echocraft:261 - EchoCraftBlueprint yielding: Echo: Second
[DEBUG] 2025-08-24 21:00:40,737 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_echo_multi
[DEBUG] 2025-08-24 21:00:40,737 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {}
[DEBUG] 2025-08-24 21:00:40,737 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: default
[DEBUG] 2025-08-24 21:00:40,737 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[INFO] 2025-08-24 21:00:40,737 - swarm.blueprints.echocraft.blueprint_echocraft:286 - EchoCraftBlueprint run finished.
_________________________________________________________________________________________________________________________ test_stewie_agent_creation _________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------------------------------------------------------------------
[STEWIE DEBUG] Loaded config from: /mnt/models/open-swarm-mcp/swarm_config.json
{'blueprints': {'defaults': {'default_markdown_cli': True,
                             'max_llm_calls': 10}},
 'llm': {},
 'mcpServers': {},
 'profiles': {'default': {'llm': 'gpt-4', 'temperature': 0.7}}}
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:41,000 - swarm.blueprints.stewie.blueprint_family_ties:156 - Creating Stewie agent team...
[DEBUG] 2025-08-24 21:00:41,000 - swarm.blueprints.stewie.blueprint_family_ties:161 - Using LLM profile 'default' for Stewie agent.
[DEBUG] 2025-08-24 21:00:41,000 - swarm.blueprints.stewie.blueprint_family_ties:121 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:41,000 - swarm.blueprints.stewie.blueprint_family_ties:125 - [STEWIE DEBUG] llm config keys: ['default']
[DEBUG] 2025-08-24 21:00:41,047 - swarm.blueprints.stewie.blueprint_family_ties:147 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for 'default'.
[WARNING] 2025-08-24 21:00:41,047 - swarm.blueprints.stewie.blueprint_family_ties:173 - Required MCP server 'server-wp-mcp' not found or failed to start.
[DEBUG] 2025-08-24 21:00:41,050 - swarm.blueprints.stewie.blueprint_family_ties:211 - Agents created: Stewie (main), PeterGrifton, BrianGrifton (helpers as tools).
_________________________________________________________________________________________________________________________ test_story_generation_flow _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:41,080 - swarm:54 - GeeseBlueprint run called with prompt: Tell a story
-------------------------------------------------------------------------------------------------------------------------- Captured stderr teardown --------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 21:00:41,081 - asyncio:1758 - Task was destroyed but it is pending!
task: <Task pending name='Task-79' coro=<<async_generator_athrow without __name__>()>>
--------------------------------------------------------------------------------------------------------------------------- Captured log teardown ----------------------------------------------------------------------------------------------------------------------------
ERROR    asyncio:base_events.py:1758 Task was destroyed but it is pending!
task: <Task pending name='Task-79' coro=<<async_generator_athrow without __name__>()>>
_________________________________________________________________________________________________________________________ test_jeeves_agent_creation _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:41,103 - swarm.blueprints.jeeves.blueprint_jeeves:274 - Creating Jeeves agent team...
[DEBUG] 2025-08-24 21:00:41,103 - swarm.blueprints.jeeves.blueprint_jeeves:278 - Using LLM profile 'default' for Jeeves agents.
[DEBUG] 2025-08-24 21:00:41,103 - swarm.blueprints.jeeves.blueprint_jeeves:188 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:41,103 - swarm.blueprints.jeeves.blueprint_jeeves:206 - Creating new AsyncOpenAI client for profile 'default' with config: {}
[DEBUG] 2025-08-24 21:00:41,149 - swarm.blueprints.jeeves.blueprint_jeeves:213 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for profile 'default'.
[DEBUG] 2025-08-24 21:00:41,152 - swarm.blueprints.jeeves.blueprint_jeeves:320 - Jeeves team created: Jeeves (Coordinator), Mycroft (Search), Gutenberg (Home).
_________________________________________________________________________________________________________________________ test_jeeves_cli_execution __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
CLI Output for Jeeves test:
[Jeeves CLI] SWARM_TEST_MODE active.
[SPINNER] Polishing the silver
  Jeeves Spinner | Jeeves Spinner 
 Searching for: 'Turn on the lights'          
 Jeeves Search                                
 Searching for: 'Turn on the lights'          
 Generating.                                  
 Generating..                                 
 Generating...                                
 Running...                                   
 Results: 2                                   
 Processed                                    
                                            
  [Generating... Taking longer than expected] 

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Generating.          
 Progress: Spinner 1/5 [Generating.]        

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Generating..         
 Progress: Spinner 2/5 [Generating..]       

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Generating...        
 Progress: Spinner 3/5 [Generating...]      

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Running...           
 Progress: Spinner 4/5 [Running...]         

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights'                        
 Jeeves Spinner State: Generating... Taking longer than expected   
 Progress: Spinner 5/5 [Generating... Taking longer than expected] 

  Jeeves Results | Jeeves Results 
 Jeeves agent response for: 'Turn on the lights' 
 Jeeves agent response for: 'Turn on the lights' 
 Found 2 results.                                
 Processed                                       
 Progress: Processed [Done]                      

Jeeves: Test mode response for: Turn on the lights


________________________________________________________________________________________________________________________ test_mcpdemo_agent_creation _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:42,817 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
[WARNING] 2025-08-24 21:00:42,865 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
[WARNING] 2025-08-24 21:00:42,913 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
[WARNING] 2025-08-24 21:00:42,961 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
__________________________________________________________________________________________________________________________ test_mcpdemo_bad_config ___________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,016 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
____________________________________________________________________________________________________________________ test_mcpdemo_filesystem_interaction _____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,097 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
______________________________________________________________________________________________________________________ test_mcpdemo_memory_interaction _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,149 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): memory, filesystem. Functionality will be limited.
________________________________________________________________________________________________________________________ test_mission_agent_creation _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,168 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:253 - Creating Mission Improbable agent team...
[DEBUG] 2025-08-24 21:00:43,168 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:170 - Loaded config for agent 'JimFlimsy' from SQLite.
[DEBUG] 2025-08-24 21:00:43,168 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:198 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,168 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:231 - Creating new AsyncOpenAI client for 'default': {}
[DEBUG] 2025-08-24 21:00:43,215 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:238 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for 'default'.
[WARNING] 2025-08-24 21:00:43,215 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:173 - No config found for agent 'CinnamonToast' in SQLite. Using defaults.
[WARNING] 2025-08-24 21:00:43,215 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:180 - Using hardcoded default config for agent 'CinnamonToast'.
[DEBUG] 2025-08-24 21:00:43,215 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:196 - Using cached Model instance for profile 'default'.
[WARNING] 2025-08-24 21:00:43,215 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:173 - No config found for agent 'RollinFumble' in SQLite. Using defaults.
[WARNING] 2025-08-24 21:00:43,216 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:180 - Using hardcoded default config for agent 'RollinFumble'.
[DEBUG] 2025-08-24 21:00:43,216 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:196 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,218 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:285 - Mission Improbable agents created. Starting with JimFlimsy.
___________________________________________________________________________________________________________________ test_omniplex_agent_creation_all_types ___________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,233 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,234 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 21:00:43,234 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 21:00:43,234 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 21:00:43,234 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 21:00:43,234 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 21:00:43,234 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 21:00:43,234 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 21:00:43,235 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: ['uvx_server'], Other: ['other_server']
[INFO] 2025-08-24 21:00:43,235 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 21:00:43,236 - swarm.blueprints.omniplex.blueprint_omniplex:120 - Creating Rogue for uvx servers: ['uvx_server']
[INFO] 2025-08-24 21:00:43,237 - swarm.blueprints.omniplex.blueprint_omniplex:126 - Creating Sylar for other servers: ['other_server']
[INFO] 2025-08-24 21:00:43,238 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo', 'Rogue', 'Sylar']
___________________________________________________________________________________________________________________ test_omniplex_agent_creation_only_npx ____________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,242 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,243 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 21:00:43,243 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 21:00:43,244 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 21:00:43,244 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 21:00:43,244 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 21:00:43,244 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 21:00:43,244 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 21:00:43,244 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: [], Other: []
[INFO] 2025-08-24 21:00:43,244 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 21:00:43,245 - swarm.blueprints.omniplex.blueprint_omniplex:123 - No started uvx servers for Rogue.
[INFO] 2025-08-24 21:00:43,245 - swarm.blueprints.omniplex.blueprint_omniplex:129 - No other started servers for Sylar.
[INFO] 2025-08-24 21:00:43,245 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo']
_____________________________________________________________________________________________________________________ test_omniplex_delegation_to_amazo ______________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,249 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,250 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 21:00:43,250 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 21:00:43,250 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 21:00:43,250 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 21:00:43,250 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 21:00:43,250 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 21:00:43,250 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 21:00:43,251 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: ['uvx_server'], Other: ['other_server']
[INFO] 2025-08-24 21:00:43,251 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 21:00:43,252 - swarm.blueprints.omniplex.blueprint_omniplex:120 - Creating Rogue for uvx servers: ['uvx_server']
[INFO] 2025-08-24 21:00:43,253 - swarm.blueprints.omniplex.blueprint_omniplex:126 - Creating Sylar for other servers: ['other_server']
[INFO] 2025-08-24 21:00:43,254 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo', 'Rogue', 'Sylar']
________________________________________________________________________________________________________________________ test_omniplex_cli_execution _________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:00:43,260 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,261 - swarm.blueprints.omniplex.blueprint_omniplex:136 - OmniplexBlueprint run method called.
[DEBUG] 2025-08-24 21:00:43,261 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 21:00:43,261 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 21:00:43,261 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 21:00:43,261 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 21:00:43,261 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 21:00:43,261 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 21:00:43,261 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 21:00:43,262 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: ['uvx_server'], Other: ['other_server']
[INFO] 2025-08-24 21:00:43,262 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 21:00:43,263 - swarm.blueprints.omniplex.blueprint_omniplex:120 - Creating Rogue for uvx servers: ['uvx_server']
[INFO] 2025-08-24 21:00:43,264 - swarm.blueprints.omniplex.blueprint_omniplex:126 - Creating Sylar for other servers: ['other_server']
[INFO] 2025-08-24 21:00:43,265 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo', 'Rogue', 'Sylar']
________________________________________________________________________________________________________________________ test_poets_db_initialization ________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,268 - swarm:82 - Initializing SQLite database at: /tmp/pytest-of-chatgpt/pytest-13/test_poets_db_initialization0/test_swarm_instructions.db for PoetsBlueprint 'poets-society'
[DEBUG] 2025-08-24 21:00:43,276 - swarm:117 - Table 'agent_instructions' ensured in /tmp/pytest-of-chatgpt/pytest-13/test_poets_db_initialization0/test_swarm_instructions.db
[INFO] 2025-08-24 21:00:43,280 - swarm:158 - Default poet instructions inserted/verified in /tmp/pytest-of-chatgpt/pytest-13/test_poets_db_initialization0/test_swarm_instructions.db.
[INFO] 2025-08-24 21:00:43,280 - swarm:94 - PoetsBlueprint 'poets-society' configured. Starting poet: Gritty Buk
_________________________________________________________________________________________________________________________ test_poets_agent_creation __________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,284 - swarm:82 - Initializing SQLite database at: /tmp/pytest-of-chatgpt/pytest-13/test_poets_agent_creation0/test_swarm_instructions.db for PoetsBlueprint 'poets-society'
[DEBUG] 2025-08-24 21:00:43,289 - swarm:117 - Table 'agent_instructions' ensured in /tmp/pytest-of-chatgpt/pytest-13/test_poets_agent_creation0/test_swarm_instructions.db
[INFO] 2025-08-24 21:00:43,293 - swarm:158 - Default poet instructions inserted/verified in /tmp/pytest-of-chatgpt/pytest-13/test_poets_agent_creation0/test_swarm_instructions.db.
[INFO] 2025-08-24 21:00:43,293 - swarm:94 - PoetsBlueprint 'poets-society' configured. Starting poet: Gritty Buk
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,296 - swarm:242 - Creating Poets agent team. Received mcp_servers: [<MagicMock id='280674205330128'>, <MagicMock id='280674192589680'>, <MagicMock id='280674192597408'>]
[DEBUG] 2025-08-24 21:00:43,297 - swarm:173 - Loaded config for agent 'Harlem Lang' from SQLite.
[DEBUG] 2025-08-24 21:00:43,297 - swarm:197 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,297 - swarm:218 - Creating new AsyncOpenAI client for 'default': {base_url: http://localhost:1234}
[DEBUG] 2025-08-24 21:00:43,343 - swarm:224 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for 'default'.
[DEBUG] 2025-08-24 21:00:43,344 - swarm:173 - Loaded config for agent 'Verse Neru' from SQLite.
[DEBUG] 2025-08-24 21:00:43,344 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,344 - swarm:173 - Loaded config for agent 'Raven Poe' from SQLite.
[DEBUG] 2025-08-24 21:00:43,344 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,344 - swarm:173 - Loaded config for agent 'Bard Whit' from SQLite.
[DEBUG] 2025-08-24 21:00:43,344 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,345 - swarm:173 - Loaded config for agent 'Mystic Blake' from SQLite.
[DEBUG] 2025-08-24 21:00:43,345 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,345 - swarm:173 - Loaded config for agent 'Haiku Bash' from SQLite.
[DEBUG] 2025-08-24 21:00:43,345 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,345 - swarm:173 - Loaded config for agent 'Frosted Woods' from SQLite.
[DEBUG] 2025-08-24 21:00:43,345 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,346 - swarm:173 - Loaded config for agent 'Echo Plath' from SQLite.
[DEBUG] 2025-08-24 21:00:43,346 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 21:00:43,346 - swarm:173 - Loaded config for agent 'Gritty Buk' from SQLite.
[DEBUG] 2025-08-24 21:00:43,346 - swarm:194 - Using cached Model instance for profile 'default'.
______________________________________________________________________________________________________________________________ test_rue_run_box ______________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,370 - swarm.config:80 - Using XDG default configuration path: /home/chatgpt/.config/swarm/config.yaml
[WARNING] 2025-08-24 21:00:43,370 - swarm.config:98 - Default configuration file not found at /home/chatgpt/.config/swarm/config.yaml. Proceeding without base configuration.
[DEBUG] 2025-08-24 21:00:43,370 - swarm.config:102 - Applied base defaults. Keys: []
[DEBUG] 2025-08-24 21:00:43,370 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 21:00:43,370 - swarm.config:142 - Applied final env var substitution.
[INFO] 2025-08-24 21:00:43,370 - swarm.blueprints.rue_code.blueprint_rue_code:217 - RueCodeBlueprint run method called.
[INFO] 2025-08-24 21:00:43,785 - swarm.blueprints.rue_code.blueprint_rue_code:271 - RueCodeBlueprint run finished.
_____________________________________________________________________________________________________________________________ test_rue_run_empty _____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:43,789 - swarm.config:80 - Using XDG default configuration path: /home/chatgpt/.config/swarm/config.yaml
[WARNING] 2025-08-24 21:00:43,789 - swarm.config:98 - Default configuration file not found at /home/chatgpt/.config/swarm/config.yaml. Proceeding without base configuration.
[DEBUG] 2025-08-24 21:00:43,789 - swarm.config:102 - Applied base defaults. Keys: []
[DEBUG] 2025-08-24 21:00:43,789 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 21:00:43,789 - swarm.config:142 - Applied final env var substitution.
[INFO] 2025-08-24 21:00:43,789 - swarm.blueprints.rue_code.blueprint_rue_code:217 - RueCodeBlueprint run method called.
_________________________________________________________________________________________________________________________ test_run_and_check_status __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,798 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
____________________________________________________________________________________________________________________________ test_kill_subprocess ____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,803 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
_________________________________________________________________________________________________________________________ test_tail_and_show_output __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,806 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
__________________________________________________________________________________________________________________________ test_list_and_prune_jobs __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,814 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
____________________________________________________________________________________________________________________ test_resource_usage_and_analyze_self ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,818 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
______________________________________________________________________________________________________________________________ test_self_update ______________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,822 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
___________________________________________________________________________________________________________________________ test_analyze_self_runs ___________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,825 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
__________________________________________________________________________________________________________________________ test_wtf_agent_creation ___________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 21:00:43,828 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:77 - WTFBlueprint __init__: Instance lacks _load_configuration method even after super call. MRO or BlueprintUXImproved.__init__ is likely problematic. Initializing _config manually.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,831 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:92 - Ensuring database schema exists at: /tmp/pytest-of-chatgpt/pytest-13/test_wtf_agent_creation0/test_wtf_services.db
[INFO] 2025-08-24 21:00:43,831 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:99 - Initializing 'services' table in SQLite database.
[INFO] 2025-08-24 21:00:43,842 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:114 - 'services' table created.
[DEBUG] 2025-08-24 21:00:43,842 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:229 - Creating WhiskeyTangoFoxtrot agent team...
[DEBUG] 2025-08-24 21:00:43,842 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:239 - Using LLM profile 'default' for WTF agents. (From BP config: None, from settings: None)
[WARNING] 2025-08-24 21:00:43,846 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['filesystem'] is missing started MCP(s): filesystem
[WARNING] 2025-08-24 21:00:43,846 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['sqlite'] is missing started MCP(s): sqlite
[WARNING] 2025-08-24 21:00:43,848 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['brave-search', 'mcp-npx-fetch'] is missing started MCP(s): brave-search, mcp-npx-fetch
[WARNING] 2025-08-24 21:00:43,848 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['mcp-doc-forge'] is missing started MCP(s): mcp-doc-forge
[WARNING] 2025-08-24 21:00:43,851 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['sqlite'] is missing started MCP(s): sqlite
[DEBUG] 2025-08-24 21:00:43,854 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:294 - WhiskeyTangoFoxtrot agents created. Starting with Valory.
_________________________________________________________________________________________________________________________ test_wtf_db_initialization _________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 21:00:43,858 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:77 - WTFBlueprint __init__: Instance lacks _load_configuration method even after super call. MRO or BlueprintUXImproved.__init__ is likely problematic. Initializing _config manually.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:43,859 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:92 - Ensuring database schema exists at: /tmp/pytest-of-chatgpt/pytest-13/test_wtf_db_initialization0/test_wtf_services.db
[INFO] 2025-08-24 21:00:43,859 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:99 - Initializing 'services' table in SQLite database.
[INFO] 2025-08-24 21:00:43,869 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:114 - 'services' table created.
____________________________________________________________________________________________________________________________ test_zeus_run_empty _____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:46,927 - swarm.blueprints.zeus.blueprint_zeus:79 - ZeusCoordinatorBlueprint run method called.
____________________________________________________________________________________________________________ test_swarm_cli_install_executable_creates_executable ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
CLI Output (Test Mode):
Installing blueprint 'test_blueprint' as executable...
  Source: /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_data_for_swarm/blueprints/test_blueprint
  Entry Point: main.py
  Output Executable: /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_bin_test/test_blueprint
Test-mode shim installed at: /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_bin_test/test_blueprint

CLI Output (Prod Mode):
Installing blueprint 'test_blueprint' as executable...
  Source: /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_data_for_swarm/blueprints/test_blueprint
  Entry Point: main.py
  Output Executable: /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_bin_test/test_blueprint
Running PyInstaller: pyinstaller --onefile --name test_blueprint --distpath /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_bin_test --workpath /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_cache_for_swarm/build/test_blueprint --specpath /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_cache_for_swarm/specs /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_data_for_swarm/blueprints/test_blueprint/main.py
PyInstaller output:
PyInstaller finished successfully. Executable at /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_bin_test/test_blueprint
Successfully installed 'test_blueprint' to /tmp/pytest-of-chatgpt/pytest-13/test_swarm_cli_install_executa0/user_bin_test/test_blueprint

______________________________________________________________________________________________________________________ test_execute_list_user_installed ______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:47,243 - swarm.extensions.cli.commands.list_blueprints:83 - Discovering user-installed blueprints from: PosixPath('/tmp/pytest-of-chatgpt/pytest-13/test_execute_list_user_install0/mock_user_blueprints')
________________________________________________________________________________________________________________________ test_execute_list_available _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_TEST: Output for test_execute_list_available:
Listing available blueprints (from package/development source)...
DEBUG_MOCK: mock_is_dir called for /mnt/models/open-swarm-mcp/src/swarm/blueprints
DEBUG_MOCK: mock_is_dir returning False for dev path candidate: /mnt/models/open-swarm-mcp/src/swarm/blueprints
INFO: No available (package/development) blueprint source directory could be determined.
No available blueprints found in package or development source.

---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:47,249 - swarm.extensions.cli.commands.list_blueprints:44 - 'swarm' package spec not found. Cannot determine installed package location.
[DEBUG] 2025-08-24 21:00:47,249 - swarm.extensions.cli.commands.list_blueprints:50 - Falling back to development source tree for blueprints.
[DEBUG] 2025-08-24 21:00:47,250 - swarm.extensions.cli.commands.list_blueprints:61 - Checking development blueprints path: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints')
[DEBUG] 2025-08-24 21:00:47,250 - swarm.extensions.cli.commands.list_blueprints:66 - Development blueprints path /mnt/models/open-swarm-mcp/src/swarm/blueprints not found or not a directory.
[INFO] 2025-08-24 21:00:47,250 - swarm.extensions.cli.commands.list_blueprints:72 - No available (package/development) blueprint source directory could be determined.
_________________________________________________________________________________________________________________ test_execute_no_user_installed_blueprints __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_TEST: Output for test_execute_no_user_installed_blueprints:
Listing user-installed blueprints (source in /tmp/pytest-of-chatgpt/pytest-13/test_execute_no_user_installed0/mock_user_blueprints)...
No user-installed blueprints found in /tmp/pytest-of-chatgpt/pytest-13/test_execute_no_user_installed0/mock_user_blueprints.
Use 'swarm-cli list --available' to see blueprints you can install, then 'swarm-cli install <name_or_path>'.

---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:47,254 - swarm.extensions.cli.commands.list_blueprints:83 - Discovering user-installed blueprints from: PosixPath('/tmp/pytest-of-chatgpt/pytest-13/test_execute_no_user_installed0/mock_user_blueprints')
____________________________________________________________________________________________________________________ test_execute_no_available_blueprints ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_TEST: Output for test_execute_no_available_blueprints:
Listing available blueprints (from package/development source)...
No available blueprints found in package or development source.

---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:47,260 - swarm.extensions.cli.commands.list_blueprints:44 - 'swarm' package spec not found. Cannot determine installed package location.
[DEBUG] 2025-08-24 21:00:47,260 - swarm.extensions.cli.commands.list_blueprints:50 - Falling back to development source tree for blueprints.
[DEBUG] 2025-08-24 21:00:47,260 - swarm.extensions.cli.commands.list_blueprints:61 - Checking development blueprints path: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints')
[INFO] 2025-08-24 21:00:47,260 - swarm.extensions.cli.commands.list_blueprints:75 - Discovering available blueprints from: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints') (from development source tree (/mnt/models/open-swarm-mcp/src/swarm/blueprints))
______________________________________________________________________________________________________________ test_execute_discovery_exception_user_installed _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:00:47,265 - swarm.extensions.cli.commands.list_blueprints:83 - Discovering user-installed blueprints from: PosixPath('/tmp/pytest-of-chatgpt/pytest-13/test_execute_discovery_excepti0/mock_user_blueprints')
[ERROR] 2025-08-24 21:00:47,265 - swarm.extensions.cli.commands.list_blueprints:153 - Error listing user-installed blueprints.
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 135, in execute
    user_blueprints = list_user_installed_blueprints()
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 88, in list_user_installed_blueprints
    return discover_blueprints(str(user_bp_dir))
  File "/usr/lib/python3.10/unittest/mock.py", line 1114, in __call__
    return self._mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1118, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1173, in _execute_mock_call
    raise effect
Exception: User Discovery Failed!
_________________________________________________________________________________________________________________ test_execute_discovery_exception_available _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:47,272 - swarm.extensions.cli.commands.list_blueprints:44 - 'swarm' package spec not found. Cannot determine installed package location.
[DEBUG] 2025-08-24 21:00:47,272 - swarm.extensions.cli.commands.list_blueprints:50 - Falling back to development source tree for blueprints.
[DEBUG] 2025-08-24 21:00:47,272 - swarm.extensions.cli.commands.list_blueprints:61 - Checking development blueprints path: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints')
[INFO] 2025-08-24 21:00:47,272 - swarm.extensions.cli.commands.list_blueprints:75 - Discovering available blueprints from: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints') (from development source tree (/mnt/models/open-swarm-mcp/src/swarm/blueprints))
[ERROR] 2025-08-24 21:00:47,272 - swarm.extensions.cli.commands.list_blueprints:131 - Error listing available blueprints.
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 121, in execute
    available_blueprints = list_available_blueprints()
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 76, in list_available_blueprints
    return discover_blueprints(str(blueprints_source_dir))
  File "/usr/lib/python3.10/unittest/mock.py", line 1114, in __call__
    return self._mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1118, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1173, in _execute_mock_call
    raise effect
Exception: Available Discovery Failed!
___________________________________________________________________________________________________________________ test_blueprint_default_model_override ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,221 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmp0aar3ib9.json
[INFO] 2025-08-24 21:00:48,221 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmp0aar3ib9.json
[DEBUG] 2025-08-24 21:00:48,221 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:48,221 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_________________________________________________________________________________________________________________________ test_fallback_logs_warning _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,225 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmp6en12fs0.json
[INFO] 2025-08-24 21:00:48,225 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmp6en12fs0.json
[DEBUG] 2025-08-24 21:00:48,225 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:48,225 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_______________________________________________________________________________________________________________________ test_default_config_generation _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,228 - swarm.extensions.config.config_loader:79 - Config 'swarm_config.json' not found.
[INFO] 2025-08-24 21:00:48,228 - swarm.extensions.config.config_loader:181 - Creating default configuration file at /tmp/tmpr0g7psax/swarm/swarm_config.json
[INFO] 2025-08-24 21:00:48,228 - swarm.extensions.config.config_loader:109 - Saving config to /tmp/tmpr0g7psax/swarm/swarm_config.json
[DEBUG] 2025-08-24 21:00:48,228 - swarm.extensions.config.config_loader:114 - Save OK.
[DEBUG] 2025-08-24 21:00:48,228 - swarm.extensions.config.config_loader:184 - Default configuration file created successfully.
[WARNING] 2025-08-24 21:00:48,228 - swarm.extensions.config.config_loader:186 - [hint] Set your API key: export OPENAI_API_KEY=sk-... or save to secrets file: echo 'OPENAI_API_KEY=sk-...' >> ~/.config/swarm/.env
_________________________________________________________________________________________________________________________ test_xdg_config_discovery __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,231 - swarm.extensions.config.config_loader:35 - Found config XDG: /tmp/tmp1nd0oiqu/swarm/swarm_config.json
________________________________________________________________________________________________________________________ test_config_fallback_to_cwd _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,233 - swarm.extensions.config.config_loader:76 - Found config cwd: /tmp/tmpat3ndx_r/swarm_config.json
___________________________________________________________________________________________________________________ test_load_full_configuration_defaults ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,235 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmpo8cuy2hp.json
[DEBUG] 2025-08-24 21:00:48,236 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmpo8cuy2hp.json
[DEBUG] 2025-08-24 21:00:48,236 - swarm.config:102 - Applied base defaults. Keys: ['foo']
[DEBUG] 2025-08-24 21:00:48,236 - swarm.config:107 - Merged base 'llm'.
[DEBUG] 2025-08-24 21:00:48,236 - swarm.config:110 - Merged base 'mcpServers'.
[DEBUG] 2025-08-24 21:00:48,236 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 21:00:48,236 - swarm.config:142 - Applied final env var substitution.
________________________________________________________________________________________________________________ test_load_full_configuration_profile_merging ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmp4vf1tbg3.json
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmp4vf1tbg3.json
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:102 - Applied base defaults. Keys: ['foo', 'default_profile']
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:107 - Merged base 'llm'.
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:110 - Merged base 'mcpServers'.
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:116 - Merged BP 'FakeBlueprint' settings. Keys: ['baz']
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:123 - Using profile: 'special'
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:127 - Merged profile 'special'. Keys: ['profile_key']
[DEBUG] 2025-08-24 21:00:48,238 - swarm.config:142 - Applied final env var substitution.
_______________________________________________________________________________________________________________ test_load_full_configuration_env_substitution ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmp5vmvj7fz.json
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmp5vmvj7fz.json
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:102 - Applied base defaults. Keys: ['foo']
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:107 - Merged base 'llm'.
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:110 - Merged base 'mcpServers'.
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 21:00:48,240 - swarm.config:142 - Applied final env var substitution.
_________________________________________________________________________________________________________________ test_load_full_configuration_missing_file __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,242 - swarm.config:74 - Using CLI overridden configuration path: /tmp/does_not_exist.json
___________________________________________________________________________________________________________________ test_load_full_configuration_bad_json ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,244 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmpenb0q04n.json
_________________________________________________________________________________________________________________ test_load_full_configuration_empty_config __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,246 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmpghqen4l4.json
[DEBUG] 2025-08-24 21:00:48,246 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmpghqen4l4.json
[DEBUG] 2025-08-24 21:00:48,246 - swarm.config:102 - Applied base defaults. Keys: []
[DEBUG] 2025-08-24 21:00:48,246 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 21:00:48,246 - swarm.config:142 - Applied final env var substitution.
___________________________________________________________________________________________________________________________ test_load_environment ____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,248 - swarm.config:30 - Checking for .env file at: /tmp/pytest-of-chatgpt/pytest-13/test_load_environment0/.env
[DEBUG] 2025-08-24 21:00:48,249 - swarm.config:35 - .env file Loaded/Overridden at: /tmp/pytest-of-chatgpt/pytest-13/test_load_environment0/.env
_______________________________________________________________________________________________________________________ test_fallback_to_default_model _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,251 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmp2n9cwslo.json
[INFO] 2025-08-24 21:00:48,251 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmp2n9cwslo.json
[DEBUG] 2025-08-24 21:00:48,251 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:48,251 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_______________________________________________________________________________________________________________________ test_mcp_server_config_parsing _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,254 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmpvqdfdeli.json
[INFO] 2025-08-24 21:00:48,254 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmpvqdfdeli.json
[DEBUG] 2025-08-24 21:00:48,254 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:48,254 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_________________________________________________________________________________________________________________ test_mcp_server_add_remove_and_edge_cases __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:00:48,256 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmp4h98t6i6.json
[INFO] 2025-08-24 21:00:48,257 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmp4h98t6i6.json
[DEBUG] 2025-08-24 21:00:48,257 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 21:00:48,257 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
__________________________________________________________________________________________________________________________ test_swarm_api_basic_run __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Using managed blueprint: /fake/home/.swarm/blueprints/echocraft/blueprint_echocraft.py
Blueprints to be configured:
 - /fake/home/.swarm/blueprints/echocraft/blueprint_echocraft.py
Launching Django server on port 0.0.0.0:8000
_______________________________________________________________________________________________________________ test_swarm_api_custom_port_and_config_creation _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Using blueprint file: /path/to/my_bp.py
Blueprints to be configured:
 - /path/to/my_bp.py
Default config file created at: /tmp/my_swarm.json
Launching Django server on port 0.0.0.0:9999
_________________________________________________________________________________________________________________________ test_swarm_api_daemon_mode _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Using blueprint file: /bp/direct.py
Blueprints to be configured:
 - /bp/direct.py
Launching Django server on port 0.0.0.0:8000
Running in daemon mode. Process ID: 12345
_____________________________________________________________________________________________________________________ test_swarm_api_blueprint_not_found _____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Warning: Blueprint not found: nonexistent_bp - skipping.
Error: No valid blueprints found.
_________________________________________________________________________________________________________________________________ test_init __________________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
BlueprintBase init test passed
______________________________________________________________________________________________________________________________ test_valid_input ______________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 21:01:04,752 - swarm.extensions.cli.selection:37 - User selected blueprint: 'blueprint1'
______________________________________________________________________________________________________________________ test_filter_mixed_valid_invalid _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:01:04,760 - src.swarm.utils.message_utils:29 - Skipping non-dictionary item in messages list: <class 'str'>
[WARNING] 2025-08-24 21:01:04,760 - src.swarm.utils.message_utils:29 - Skipping non-dictionary item in messages list: <class 'NoneType'>
[WARNING] 2025-08-24 21:01:04,760 - src.swarm.utils.message_utils:26 - Message dictionary missing 'role' key: {'not_a_role': 'value'}
[WARNING] 2025-08-24 21:01:04,760 - src.swarm.utils.message_utils:29 - Skipping non-dictionary item in messages list: <class 'int'>
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:29 Skipping non-dictionary item in messages list: <class 'str'>
WARNING  src.swarm.utils.message_utils:message_utils.py:29 Skipping non-dictionary item in messages list: <class 'NoneType'>
WARNING  src.swarm.utils.message_utils:message_utils.py:26 Message dictionary missing 'role' key: {'not_a_role': 'value'}
WARNING  src.swarm.utils.message_utils:message_utils.py:29 Skipping non-dictionary item in messages list: <class 'int'>
__________________________________________________________________________________________________________________ test_filter_messages_with_non_dict_items __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:01:04,765 - src.swarm.utils.message_utils:43 - Skipping non-dictionary item in messages list: <class 'str'>
[WARNING] 2025-08-24 21:01:04,765 - src.swarm.utils.message_utils:43 - Skipping non-dictionary item in messages list: <class 'NoneType'>
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:43 Skipping non-dictionary item in messages list: <class 'str'>
WARNING  src.swarm.utils.message_utils:message_utils.py:43 Skipping non-dictionary item in messages list: <class 'NoneType'>
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[simple] ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,770 - 
--- Running Truncation Test [NoAction] (Mode: simple, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,770 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 21:01:04,771 - src.swarm.utils.context_utils:233 - Simple truncation result: 2 messages (1 sys), ~11 tokens.
[INFO] 2025-08-24 21:01:04,771 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,771 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 2 messages (1 sys), ~11 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[pairs] ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,773 - 
--- Running Truncation Test [NoAction] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,773 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 21:01:04,773 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,773 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,773 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[simple] ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,775 - 
--- Running Truncation Test [MsgCountBasic] (Mode: simple, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 21:01:04,775 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,775 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~17 tokens.
[INFO] 2025-08-24 21:01:04,775 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,775 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[pairs] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,777 - 
--- Running Truncation Test [MsgCountBasic] (Mode: pairs, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 21:01:04,777 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,777 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 2 msgs, 995 tokens.
[DEBUG] 2025-08-24 21:01:04,777 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,777 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
[DEBUG] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:81 -   [Loop Stop] Msg limit reached.
[INFO] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
[INFO] 2025-08-24 21:01:04,778 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,778 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 2 msgs, 995 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:81   [Loop Stop] Msg limit reached.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[simple] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,780 - 
--- Running Truncation Test [TokenCountBasic] (Mode: simple, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,780 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 21:01:04,780 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~31 tokens.
[INFO] 2025-08-24 21:01:04,780 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,780 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~31 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[pairs] __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,782 - 
--- Running Truncation Test [TokenCountBasic] (Mode: pairs, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,782 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 21:01:04,782 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,782 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,782 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,784 - 
--- Running Truncation Test [PairsBasicAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,784 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,785 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,785 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,785 - --- Test Passed [PairsBasicAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_tight_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,787 - 
--- Running Truncation Test [PairsBasicTight] (Mode: pairs, MaxTk: 75, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 53 tokens.
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 21:01:04,787 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
[DEBUG] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
[INFO] 2025-08-24 21:01:04,788 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,788 - --- Test Passed [PairsBasicTight] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 53 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_pairs_preserves_multi_step_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,790 - 
--- Running Truncation Test [PairsMultiAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 20) ---
[INFO] 2025-08-24 21:01:04,790 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 21:01:04,790 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,790 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 9
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,790 - --- Test Passed [PairsMultiAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 9
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_early_user _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,792 - 
--- Running Truncation Test [PairsMultiCutUser] (Mode: pairs, MaxTk: 170, MaxMsg: 20) ---
[INFO] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 148 tokens.
[DEBUG] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 21:01:04,792 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
[INFO] 2025-08-24 21:01:04,793 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,794 - --- Test Passed [PairsMultiCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 148 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_first_pair _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,796 - 
--- Running Truncation Test [PairsMultiCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 20) ---
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
[INFO] 2025-08-24 21:01:04,796 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,796 - --- Test Passed [PairsMultiCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
___________________________________________________________________________________________________________ test_pairs_drops_lone_tool_due_to_separation_or_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,798 - 
--- Running Truncation Test [PairsDropLoneToolLimit] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,798 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 3)+A(idx 1)
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 21:01:04,799 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - --- Test Passed [PairsDropLoneToolLimit] ---
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190703232. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190647232. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190648576. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190642880. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190653120. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190654016. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190646976. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190690304. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190644416. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190653888. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190655040. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190648128. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190696128. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190648448. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - Stable mock cost NF id=280674190652800. Recalc.
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,799 - 
--- Running Truncation Test [PairsDropLoneToolSep] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 18
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 18
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 17)+A(idx 15)
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 16
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 21:01:04,800 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,800 - --- Test Passed [PairsDropLoneToolSep] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 3)+A(idx 1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 18
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 18
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 17)+A(idx 15)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 16
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
__________________________________________________________________________________________________________________ test_pairs_handles_missing_tool_response __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,802 - 
--- Running Truncation Test [PairsMissingToolResp] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,802 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,802 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 58 tokens.
[DEBUG] 2025-08-24 21:01:04,802 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,802 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,802 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,802 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
[INFO] 2025-08-24 21:01:04,803 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,803 - --- Test Passed [PairsMissingToolResp] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 58 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_interspersed_messages_truncation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,805 - 
--- Running Truncation Test [PairsInterspersed] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
[INFO] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 6
[INFO] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 6
[DEBUG] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
[DEBUG] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,805 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
[INFO] 2025-08-24 21:01:04,806 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,806 - --- Test Passed [PairsInterspersed] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 6
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 6
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
____________________________________________________________________________________________________________ test_pairs_system_message_priority_and_exceeds_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,808 - 
--- Running Truncation Test [PairsSysExceeds] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 0 tokens.
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,808 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,809 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
[INFO] 2025-08-24 21:01:04,809 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,809 - --- Test Passed [PairsSysExceeds] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,809 - 
--- Running Truncation Test [PairsSysFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,809 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 21:01:04,809 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,809 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,809 - --- Test Passed [PairsSysFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 0 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
___________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_fits ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,811 - 
--- Running Truncation Test [PairsMultiCallFits] (Mode: pairs, MaxTk: 400, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,811 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,811 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,811 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,811 - --- Test Passed [PairsMultiCallFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_user _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,813 - 
--- Running Truncation Test [PairsMultiCallCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,813 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:164 -     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
[DEBUG] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
[INFO] 2025-08-24 21:01:04,814 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,814 - --- Test Passed [PairsMultiCallCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:164     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_pair _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,816 - 
--- Running Truncation Test [PairsMultiCallCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
[INFO] 2025-08-24 21:01:04,817 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,818 - --- Test Passed [PairsMultiCallCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
_____________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_fit ______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,820 - 
--- Running Truncation Test [PairsB2BFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,820 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 21:01:04,820 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,820 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,820 - --- Test Passed [PairsB2BFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
___________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_user ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,822 - 
--- Running Truncation Test [PairsB2BCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 4)+A(idx 3)
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 3 already kept.
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 21:01:04,822 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
[DEBUG] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
[INFO] 2025-08-24 21:01:04,823 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,823 - --- Test Passed [PairsB2BCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 4)+A(idx 3)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 3 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_first_pair ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,825 - 
--- Running Truncation Test [PairsB2BCutFirstPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,825 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 21:01:04,825 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,825 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,825 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 21:01:04,825 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 4.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 3
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 21:01:04,826 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,827 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,827 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
[INFO] 2025-08-24 21:01:04,827 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,827 - --- Test Passed [PairsB2BCutFirstPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 4.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________________ test_pairs_empty_input_list _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,829 - 
--- Running Truncation Test [RobustEmpty] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[DEBUG] 2025-08-24 21:01:04,829 - src.swarm.utils.context_utils:239 - Truncate called with empty/invalid list.
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,829 - --- Test Passed [RobustEmpty] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
DEBUG    src.swarm.utils.context_utils:context_utils.py:239 Truncate called with empty/invalid list.
_______________________________________________________________________________________________________________________ test_pairs_only_system_message _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,831 - 
--- Running Truncation Test [RobustSysOnly] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,831 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
[INFO] 2025-08-24 21:01:04,831 - src.swarm.utils.context_utils:71 - No valid non-system msgs.
[INFO] 2025-08-24 21:01:04,831 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,831 - --- Test Passed [RobustSysOnly] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,831 - 
--- Running Truncation Test [RobustSysOnlyExceeds] (Mode: pairs, MaxTk: 10, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,831 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
[WARNING] 2025-08-24 21:01:04,831 - src.swarm.utils.context_utils:70 - System msgs exceed limits.
[WARNING] 2025-08-24 21:01:04,831 - src.swarm.utils.context_utils:270 - Truncation empty list, likely due to system message exceeding limits.
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,831 - --- Test Passed [RobustSysOnlyExceeds] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:71 No valid non-system msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
WARNING  src.swarm.utils.context_utils:context_utils.py:70 System msgs exceed limits.
WARNING  src.swarm.utils.context_utils:context_utils.py:270 Truncation empty list, likely due to system message exceeding limits.
____________________________________________________________________________________________________________________ test_pairs_invalid_messages_mixed_in ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,834 - 
--- Running Truncation Test [RobustInvalidSimple] (Mode: simple, MaxTk: 1000, MaxMsg: 4) ---
[INFO] 2025-08-24 21:01:04,834 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
[WARNING] 2025-08-24 21:01:04,834 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,834 - src.swarm.utils.context_utils:214 - Simple Mode: Filtered 2 invalid msgs.
[INFO] 2025-08-24 21:01:04,834 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~99 tokens.
[WARNING] 2025-08-24 21:01:04,834 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,834 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,834 - --- Test Passed [RobustInvalidSimple] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,834 - 
--- Running Truncation Test [RobustInvalidPairs] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,835 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
[WARNING] 2025-08-24 21:01:04,835 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,835 - src.swarm.utils.context_utils:63 - Filtered 2 invalid msgs.
[INFO] 2025-08-24 21:01:04,835 - src.swarm.utils.context_utils:75 - History fits.
[WARNING] 2025-08-24 21:01:04,835 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,835 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,835 - --- Test Passed [RobustInvalidPairs] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:214 Simple Mode: Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~99 tokens.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:63 Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
____________________________________________________________________________________________________________________ test_pairs_non_serializable_content _____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,837 - 
--- Running Truncation Test [RobustNonSerializable] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,837 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
[WARNING] 2025-08-24 21:01:04,837 - src.swarm.utils.context_utils:35 - Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 21, 0, 29, 302592)}
[INFO] 2025-08-24 21:01:04,837 - src.swarm.utils.context_utils:63 - Filtered 1 invalid msgs.
[INFO] 2025-08-24 21:01:04,837 - src.swarm.utils.context_utils:75 - History fits.
[WARNING] 2025-08-24 21:01:04,837 - src.swarm.utils.context_utils:35 - Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 21, 0, 29, 302592)}
[INFO] 2025-08-24 21:01:04,837 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,837 - --- Test Passed [RobustNonSerializable] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
WARNING  src.swarm.utils.context_utils:context_utils.py:35 Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 21, 0, 29, 302592)}
INFO     src.swarm.utils.context_utils:context_utils.py:63 Filtered 1 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
WARNING  src.swarm.utils.context_utils:context_utils.py:35 Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 21, 0, 29, 302592)}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
_________________________________________________________________________________________________________________ test_simple_truncation_fallback_simulation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,839 - 
--- Running Truncation Test [RobustFallback] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,839 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[ERROR] 2025-08-24 21:01:04,839 - src.swarm.utils.context_utils:250 - !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_core_truncate_message_history.py", line 185, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
[WARNING] 2025-08-24 21:01:04,840 - src.swarm.utils.context_utils:252 - Attempting fallback to simple truncation.
[INFO] 2025-08-24 21:01:04,840 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~66 tokens.
[INFO] 2025-08-24 21:01:04,840 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,840 - --- Test Passed [RobustFallback] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
ERROR    src.swarm.utils.context_utils:context_utils.py:250 !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_core_truncate_message_history.py", line 185, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
WARNING  src.swarm.utils.context_utils:context_utils.py:252 Attempting fallback to simple truncation.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~66 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
_______________________________________________________________________________________________________________________ test_update_null_content_list ________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:01:04,842 - src.swarm.utils.message_utils:86 - Skipping non-dictionary item during null content update: <class 'NoneType'>
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:86 Skipping non-dictionary item during null content update: <class 'NoneType'>
____________________________________________________________________________________________________________ test_update_null_content_empty_list_or_invalid_input ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 21:01:04,847 - src.swarm.utils.message_utils:91 - update_null_content received unexpected type: <class 'NoneType'>. Returning unchanged.
[WARNING] 2025-08-24 21:01:04,847 - src.swarm.utils.message_utils:91 - update_null_content received unexpected type: <class 'str'>. Returning unchanged.
[WARNING] 2025-08-24 21:01:04,847 - src.swarm.utils.message_utils:91 - update_null_content received unexpected type: <class 'int'>. Returning unchanged.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:91 update_null_content received unexpected type: <class 'NoneType'>. Returning unchanged.
WARNING  src.swarm.utils.message_utils:message_utils.py:91 update_null_content received unexpected type: <class 'str'>. Returning unchanged.
WARNING  src.swarm.utils.message_utils:message_utils.py:91 update_null_content received unexpected type: <class 'int'>. Returning unchanged.
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[simple] ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,850 - 
--- Running Truncation Test [NoAction] (Mode: simple, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,850 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 21:01:04,851 - src.swarm.utils.context_utils:233 - Simple truncation result: 2 messages (1 sys), ~11 tokens.
[INFO] 2025-08-24 21:01:04,851 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,851 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 2 messages (1 sys), ~11 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[pairs] ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,853 - 
--- Running Truncation Test [NoAction] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,853 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 21:01:04,853 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,853 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,853 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[simple] ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,855 - 
--- Running Truncation Test [MsgCountBasic] (Mode: simple, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 21:01:04,855 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,855 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~17 tokens.
[INFO] 2025-08-24 21:01:04,855 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,855 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[pairs] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,857 - 
--- Running Truncation Test [MsgCountBasic] (Mode: pairs, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 2 msgs, 995 tokens.
[DEBUG] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
[DEBUG] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:81 -   [Loop Stop] Msg limit reached.
[INFO] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
[INFO] 2025-08-24 21:01:04,858 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,858 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 2 msgs, 995 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:81   [Loop Stop] Msg limit reached.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[simple] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,860 - 
--- Running Truncation Test [TokenCountBasic] (Mode: simple, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,860 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 21:01:04,860 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~31 tokens.
[INFO] 2025-08-24 21:01:04,860 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,860 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~31 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[pairs] __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,862 - 
--- Running Truncation Test [TokenCountBasic] (Mode: pairs, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,862 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 21:01:04,863 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,863 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,863 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,865 - 
--- Running Truncation Test [PairsBasicAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,865 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,865 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,865 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,865 - --- Test Passed [PairsBasicAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_tight_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,867 - 
--- Running Truncation Test [PairsBasicTight] (Mode: pairs, MaxTk: 75, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 53 tokens.
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,867 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
[DEBUG] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
[INFO] 2025-08-24 21:01:04,868 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,868 - --- Test Passed [PairsBasicTight] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 53 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_pairs_preserves_multi_step_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,870 - 
--- Running Truncation Test [PairsMultiAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 20) ---
[INFO] 2025-08-24 21:01:04,870 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 21:01:04,870 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,870 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 9
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,870 - --- Test Passed [PairsMultiAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 9
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_early_user _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,872 - 
--- Running Truncation Test [PairsMultiCutUser] (Mode: pairs, MaxTk: 170, MaxMsg: 20) ---
[INFO] 2025-08-24 21:01:04,872 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 21:01:04,872 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 148 tokens.
[DEBUG] 2025-08-24 21:01:04,872 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 21:01:04,873 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,874 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,874 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
[INFO] 2025-08-24 21:01:04,874 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,874 - --- Test Passed [PairsMultiCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 148 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_first_pair _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,876 - 
--- Running Truncation Test [PairsMultiCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 20) ---
[INFO] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 21:01:04,876 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 21:01:04,877 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,877 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,877 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
[INFO] 2025-08-24 21:01:04,877 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,877 - --- Test Passed [PairsMultiCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
___________________________________________________________________________________________________________ test_pairs_drops_lone_tool_due_to_separation_or_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,879 - 
--- Running Truncation Test [PairsDropLoneToolLimit] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 3)+A(idx 1)
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 21:01:04,879 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,879 - --- Test Passed [PairsDropLoneToolLimit] ---
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,879 - Stable mock cost NF id=280674190102592. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,879 - Stable mock cost NF id=280674190099072. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190105792. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190104512. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190845184. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190844800. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190104000. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190104128. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190721408. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190724096. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190728128. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190732800. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190146048. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190845376. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - Stable mock cost NF id=280674190844928. Recalc.
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - 
--- Running Truncation Test [PairsDropLoneToolSep] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 18
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 18
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 17)+A(idx 15)
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 16
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 21:01:04,880 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,880 - --- Test Passed [PairsDropLoneToolSep] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 3)+A(idx 1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 18
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 18
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 17)+A(idx 15)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 16
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
__________________________________________________________________________________________________________________ test_pairs_handles_missing_tool_response __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,882 - 
--- Running Truncation Test [PairsMissingToolResp] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 58 tokens.
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
[INFO] 2025-08-24 21:01:04,883 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,883 - --- Test Passed [PairsMissingToolResp] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 58 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_interspersed_messages_truncation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,885 - 
--- Running Truncation Test [PairsInterspersed] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 6
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 6
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
[INFO] 2025-08-24 21:01:04,886 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,886 - --- Test Passed [PairsInterspersed] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 6
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 6
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
____________________________________________________________________________________________________________ test_pairs_system_message_priority_and_exceeds_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,888 - 
--- Running Truncation Test [PairsSysExceeds] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,888 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 0 tokens.
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,889 - --- Test Passed [PairsSysExceeds] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,889 - 
--- Running Truncation Test [PairsSysFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,889 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,889 - --- Test Passed [PairsSysFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 0 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
___________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_fits ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,891 - 
--- Running Truncation Test [PairsMultiCallFits] (Mode: pairs, MaxTk: 400, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,891 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,891 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,892 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,892 - --- Test Passed [PairsMultiCallFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_user _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,894 - 
--- Running Truncation Test [PairsMultiCallCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,894 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:164 -     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
[DEBUG] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
[DEBUG] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
[INFO] 2025-08-24 21:01:04,895 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,895 - --- Test Passed [PairsMultiCallCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:164     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_pair _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,897 - 
--- Running Truncation Test [PairsMultiCallCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,897 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
[INFO] 2025-08-24 21:01:04,898 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,898 - --- Test Passed [PairsMultiCallCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
_____________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_fit ______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,900 - 
--- Running Truncation Test [PairsB2BFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,900 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 21:01:04,900 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 21:01:04,900 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,900 - --- Test Passed [PairsB2BFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
___________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_user ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,902 - 
--- Running Truncation Test [PairsB2BCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,902 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 21:01:04,902 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 4)+A(idx 3)
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 3 already kept.
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
[DEBUG] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
[INFO] 2025-08-24 21:01:04,903 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,903 - --- Test Passed [PairsB2BCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 4)+A(idx 3)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 3 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_first_pair ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,905 - 
--- Running Truncation Test [PairsB2BCutFirstPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 4.
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 3
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,906 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
[INFO] 2025-08-24 21:01:04,907 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,907 - --- Test Passed [PairsB2BCutFirstPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 4.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________________ test_pairs_empty_input_list _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,909 - 
--- Running Truncation Test [RobustEmpty] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[DEBUG] 2025-08-24 21:01:04,909 - src.swarm.utils.context_utils:239 - Truncate called with empty/invalid list.
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,909 - --- Test Passed [RobustEmpty] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
DEBUG    src.swarm.utils.context_utils:context_utils.py:239 Truncate called with empty/invalid list.
_______________________________________________________________________________________________________________________ test_pairs_only_system_message _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,911 - 
--- Running Truncation Test [RobustSysOnly] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,911 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
[INFO] 2025-08-24 21:01:04,911 - src.swarm.utils.context_utils:71 - No valid non-system msgs.
[INFO] 2025-08-24 21:01:04,911 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,911 - --- Test Passed [RobustSysOnly] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,911 - 
--- Running Truncation Test [RobustSysOnlyExceeds] (Mode: pairs, MaxTk: 10, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,911 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
[WARNING] 2025-08-24 21:01:04,912 - src.swarm.utils.context_utils:70 - System msgs exceed limits.
[WARNING] 2025-08-24 21:01:04,912 - src.swarm.utils.context_utils:270 - Truncation empty list, likely due to system message exceeding limits.
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,912 - --- Test Passed [RobustSysOnlyExceeds] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:71 No valid non-system msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
WARNING  src.swarm.utils.context_utils:context_utils.py:70 System msgs exceed limits.
WARNING  src.swarm.utils.context_utils:context_utils.py:270 Truncation empty list, likely due to system message exceeding limits.
____________________________________________________________________________________________________________________ test_pairs_invalid_messages_mixed_in ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,914 - 
--- Running Truncation Test [RobustInvalidSimple] (Mode: simple, MaxTk: 1000, MaxMsg: 4) ---
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
[WARNING] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:214 - Simple Mode: Filtered 2 invalid msgs.
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~99 tokens.
[WARNING] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,914 - --- Test Passed [RobustInvalidSimple] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,914 - 
--- Running Truncation Test [RobustInvalidPairs] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
[WARNING] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:63 - Filtered 2 invalid msgs.
[INFO] 2025-08-24 21:01:04,914 - src.swarm.utils.context_utils:75 - History fits.
[WARNING] 2025-08-24 21:01:04,915 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 21:01:04,915 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,915 - --- Test Passed [RobustInvalidPairs] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:214 Simple Mode: Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~99 tokens.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:63 Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
_________________________________________________________________________________________________________________ test_simple_truncation_fallback_simulation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,918 - 
--- Running Truncation Test [RobustFallback] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 21:01:04,918 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[ERROR] 2025-08-24 21:01:04,918 - src.swarm.utils.context_utils:250 - !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_truncate_message_history.py", line 197, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
[WARNING] 2025-08-24 21:01:04,918 - src.swarm.utils.context_utils:252 - Attempting fallback to simple truncation.
[INFO] 2025-08-24 21:01:04,918 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~66 tokens.
[INFO] 2025-08-24 21:01:04,918 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 21:01:04,918 - --- Test Passed [RobustFallback] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
ERROR    src.swarm.utils.context_utils:context_utils.py:250 !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_truncate_message_history.py", line 197, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
WARNING  src.swarm.utils.context_utils:context_utils.py:252 Attempting fallback to simple truncation.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~66 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
__________________________________________________________________________________________________________ TestBlueprintBaseConfigLoading.test_init_does_not_raise ___________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:01:04,925 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_init
[DEBUG] 2025-08-24 21:01:04,925 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'mock'}}, 'settings': {'default_markdown_output': True, 'default_llm_profile': 'default'}, 'blueprints': {}}
[DEBUG] 2025-08-24 21:01:04,925 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
____________________________________________________________________________________________________ TestBlueprintBaseConfigLoading.test_llm_profile_resolution_priority _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'foo': {'provider': 'mock'}}, 'settings': {'default_llm': 'foo'}, 'blueprints': {'bp': {'llm_profile': 'foo'}}}
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: foo
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: foo
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp2
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'bar': {'provider': 'mock'}}, 'settings': {'default_llm': 'bar'}, 'blueprints': {'bp2': {'llm_profile': 'bar'}}}
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: bp2
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {'llm_profile': 'bar'}
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:455 - [DEBUG _resolve_llm_profile] Using per-blueprint llm_profile: bar
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: bar
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp3
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'baz': {'provider': 'mock'}}, 'settings': {'default_llm': 'baz'}, 'blueprints': {}}
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: baz
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp4
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'env_model': {'provider': 'mock'}}, 'settings': {}, 'blueprints': {}}
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: env_model
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp5
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'mock'}}, 'settings': {}, 'blueprints': {}}
[DEBUG] 2025-08-24 21:01:04,931 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
_______________________________________________________________________________________________________ TestBlueprintBaseConfigLoading.test_missing_llm_profile_raises _______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 21:01:04,934 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp
[DEBUG] 2025-08-24 21:01:04,934 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {}, 'settings': {}, 'blueprints': {}}
[DEBUG] 2025-08-24 21:01:04,934 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
___________________________________________________________________________________________________________________ test_pretty_print_response_plain_text ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_PPRINT: Entered pretty_print_response. RICH_AVAILABLE=True, use_markdown=False
DEBUG_PPRINT: _console type: <class 'test_output_utils.test_pretty_print_response_plain_text.<locals>.DummyConsole'>
DEBUG_PPRINT: Processing message 1/1: Assistant
DEBUG_PPRINT: Content for message 1: 'Hello world'
DEBUG_PPRINT: Regex match for message 1: None
DEBUG_PPRINT: Message 1 - Plain text printing.
_________________________________________________________________________________________________________________ test_pretty_print_response_with_code_fence _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_PPRINT: Entered pretty_print_response. RICH_AVAILABLE=True, use_markdown=False
DEBUG_PPRINT: _console type: <class 'test_output_utils.test_pretty_print_response_with_code_fence.<locals>.DummyConsole'>
DEBUG_PPRINT: Processing message 1/1: Assistant
DEBUG_PPRINT: Content for message 1: '```python\nprint("hello")\n```'
DEBUG_PPRINT: Regex match for message 1: <re.Match object; span=(0, 28), match='```python\nprint("hello")\n```'>
DEBUG_PPRINT: Message 1 - Code block matched!
DEBUG_PPRINT: Message 1 - Printing prefix only.
DEBUG_PPRINT: Message 1 - Printing Syntax object: lang='python', code=''print("hello")''
________________________________________________________________________________________________________________________ test_spinner_runs_and_stops _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Running.Running..Running...Running... Taking longer than expected                                                                                
___________________________________________________________________________________________________________________________ test_spinner_long_wait ___________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Generating.Generating..Generating... Taking longer than expected                                                                                
-------------------------------------------------------------------------------------------------------------------------- Captured stderr teardown --------------------------------------------------------------------------------------------------------------------------
Destroying test database for alias 'default'...
========================================================================================================================== short test summary info ===========================================================================================================================
PASSED tests/api/test_models_negative.py::test_models_empty_registry_returns_200
PASSED tests/api/test_models_negative.py::test_models_non_mapping_iterable_gracefully_handles_type
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_code_comprehensive
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_missing_yield
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_valid
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_problematic_code
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_safe_code
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_dangerous_code
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_hardcoded_secrets
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_safe_code
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_basic
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_with_complex_expertise
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_sanitize_class_name
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_analytical
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_conversational
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_creative
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_context
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_get
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProIntegration::test_full_agent_creation_workflow
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_empty_expertise
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_missing_fields
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_empty_code
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_invalid_syntax
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_all_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_auth_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_database_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_django_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_error
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_success
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_logging_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_performance_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_swarm_core_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_ui_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_settings_manager_initialization
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_filtering
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_get
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_get
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_sensitive_data_filtering
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_context
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_error_handling
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_get
PASSED tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_empty_config_file
PASSED tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_missing_django_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_no_environment_variables
PASSED tests/views/test_settings_dashboard.py::TestSettingsIntegration::test_full_settings_collection_workflow
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_no_auth_returns_403
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_invalid_token_returns_403
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_token_allows_access
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_session_allows_access
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_echocraft_non_streaming_success_auth_disabled
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_chatbot_non_streaming_success_auth_disabled
PASSED tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_echocraft_streaming_success
PASSED tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_chatbot_streaming_success
PASSED tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_blueprint_run_exception_streaming_returns_error_sse
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[model]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[messages]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data0-Ensure this field has at least 1 elements]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data1-Expected a list of items]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data2-This field is required.]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data3-This field is required.]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data4-invalid" is not a valid choice]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data5-Content must be a string or null.]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_malformed_json_returns_400
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_permission_denied
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_not_found
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_init_error_returns_500
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_run_exception_non_streaming_returns_500
PASSED tests/api/test_endpoints_list_blueprints_models.py::test_models_and_blueprints_endpoints_include_dynamic_team
PASSED tests/api/test_teams_export_import.py::test_export_json_and_csv_and_import_roundtrip
PASSED tests/integration/test_dynamic_teams_reset.py::test_reset_clears_dynamic_registry_and_discovery
PASSED tests/integration/test_dynamic_teams_smoke.py::test_dynamic_team_registry_and_discovery_roundtrip
PASSED tests/blueprints/test_divine_code.py::test_zeus_agent_creation
PASSED tests/blueprints/test_divine_code.py::test_zeus_run_method
PASSED tests/blueprints/test_divine_code.py::test_zeus_delegation_to_odin
PASSED tests/blueprints/test_divine_code.py::test_zeus_basic
PASSED tests/blueprints/test_divine_code.py::test_zeus_full_flow_example
PASSED tests/blueprints/test_echocraft.py::test_echocraft_blueprint_run
PASSED tests/blueprints/test_echocraft.py::test_echocraft_blueprint_no_user_message
PASSED tests/blueprints/test_echocraft.py::test_echocraft_blueprint_multiple_messages
PASSED tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_success
PASSED tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_unexpected_response_format
PASSED tests/blueprints/test_family_ties.py::test_stewie_agent_creation
PASSED tests/blueprints/test_geese.py::test_operation_box_styles
PASSED tests/blueprints/test_geese.py::test_display_splash_screen_variants
PASSED tests/blueprints/test_geese.py::test_spinner_messages
PASSED tests/blueprints/test_geese.py::test_story_generation_flow
PASSED tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_basic
PASSED tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_default_emoji
PASSED tests/blueprints/test_jeeves.py::test_jeeves_agent_creation
PASSED tests/blueprints/test_jeeves.py::test_jeeves_delegation_to_mycroft
PASSED tests/blueprints/test_jeeves.py::test_jeeves_cli_execution
PASSED tests/blueprints/test_jeeves_progressive_tool.py::test_display_operation_box_progress
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[0-Polishing the silver]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[1-Generating.]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[2-Generating..]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[3-Generating...]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[4-Running...]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[5-Polishing the silver]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_long_wait
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_basic
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_long_wait
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_agent_creation
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_bad_config
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_filesystem_interaction
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_memory_interaction
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_cli_execution
PASSED tests/blueprints/test_mission_improbable.py::test_mission_db_initialization
PASSED tests/blueprints/test_mission_improbable.py::test_mission_agent_creation
PASSED tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_all_types
PASSED tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_only_npx
PASSED tests/blueprints/test_omniplex.py::test_omniplex_delegation_to_amazo
PASSED tests/blueprints/test_omniplex.py::test_omniplex_cli_execution
PASSED tests/blueprints/test_poets.py::test_poets_db_initialization
PASSED tests/blueprints/test_poets.py::test_poets_agent_creation
PASSED tests/blueprints/test_rue_code_cost.py::test_gpt4_cost
PASSED tests/blueprints/test_rue_code_cost.py::test_invalid_model
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_spinner_states
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_operation_box_output
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_box
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_empty
PASSED tests/blueprints/test_whinge_surf.py::test_run_and_check_status
PASSED tests/blueprints/test_whinge_surf.py::test_kill_subprocess
PASSED tests/blueprints/test_whinge_surf.py::test_tail_and_show_output
PASSED tests/blueprints/test_whinge_surf.py::test_list_and_prune_jobs
PASSED tests/blueprints/test_whinge_surf.py::test_resource_usage_and_analyze_self
PASSED tests/blueprints/test_whinge_surf.py::test_self_update
PASSED tests/blueprints/test_whinge_surf_analysis.py::test_analyze_self_runs
PASSED tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_agent_creation
PASSED tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_db_initialization
PASSED tests/blueprints/test_zeus.py::test_metadata_lists_cli_as_divine_ass
PASSED tests/blueprints/test_zeus_cli.py::test_zeus_cli_banner
PASSED tests/blueprints/test_zeus_cli.py::test_zeus_cli_multiple_inputs
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_spinner_states
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_operation_box_output
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_assist_box
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_run_empty
PASSED tests/cli/test_cli_config.py::test_create_llm_config
PASSED tests/cli/test_cli_config.py::test_read_llm_config
PASSED tests/cli/test_cli_config.py::test_update_llm_config
PASSED tests/cli/test_cli_config.py::test_partial_update_llm_config
PASSED tests/cli/test_cli_config.py::test_delete_llm_config
PASSED tests/cli/test_cli_config.py::test_invalid_config_handling
PASSED tests/cli/test_cli_config.py::test_config_list_all
PASSED tests/cli/test_config_secrets_and_env_expansion.py::test_env_var_expansion_in_config_loader
PASSED tests/cli/test_launchers.py::test_swarm_cli_entrypoint
PASSED tests/cli/test_launchers.py::test_swarm_cli_install_executable_creates_executable
PASSED tests/cli/test_launchers.py::test_swarm_install_executable_failure
PASSED tests/cli/test_launchers.py::test_swarm_launch_runs_executable
PASSED tests/cli/test_launchers.py::test_swarm_launch_failure_not_found
PASSED tests/cli/test_list_blueprints.py::test_execute_list_user_installed
PASSED tests/cli/test_list_blueprints.py::test_execute_list_available
PASSED tests/cli/test_list_blueprints.py::test_execute_no_user_installed_blueprints
PASSED tests/cli/test_list_blueprints.py::test_execute_no_available_blueprints
PASSED tests/cli/test_list_blueprints.py::test_execute_discovery_exception_user_installed
PASSED tests/cli/test_list_blueprints.py::test_execute_discovery_exception_available
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args0]
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args1]
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_key_with_config
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_suppressed_when_env_flag_unset
PASSED tests/core/test_blueprint_model_override.py::test_blueprint_default_model_override
PASSED tests/core/test_blueprint_model_override.py::test_fallback_logs_warning
PASSED tests/core/test_config_default_generation.py::test_default_config_generation
PASSED tests/core/test_config_discovery.py::test_xdg_config_discovery
PASSED tests/core/test_config_discovery.py::test_config_fallback_to_cwd
PASSED tests/core/test_config_loader.py::test_load_full_configuration_defaults
PASSED tests/core/test_config_loader.py::test_load_full_configuration_profile_merging
PASSED tests/core/test_config_loader.py::test_load_full_configuration_env_substitution
PASSED tests/core/test_config_loader.py::test_load_full_configuration_missing_file
PASSED tests/core/test_config_loader.py::test_load_full_configuration_bad_json
PASSED tests/core/test_config_loader.py::test_load_full_configuration_empty_config
PASSED tests/core/test_config_loader.py::test_load_environment
PASSED tests/core/test_fallback_to_default_model.py::test_fallback_to_default_model
PASSED tests/core/test_mcp_server_config.py::test_mcp_server_config_parsing
PASSED tests/core/test_mcp_server_config.py::test_mcp_server_add_remove_and_edge_cases
PASSED tests/core/test_redact_sensitive_data.py::test_redacts_api_keys_and_tokens
PASSED tests/core/test_redact_sensitive_data.py::test_does_not_redact_non_sensitive_strings
PASSED tests/core/test_redact_sensitive_data.py::test_partial_redaction_behavior
PASSED tests/core/test_redact_sensitive_data.py::test_handles_empty_and_non_dict_inputs
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_basic_run
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_custom_port_and_config_creation
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_daemon_mode
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_blueprint_not_found
PASSED tests/integration/test_cli_codey.py::test_codey_cli_ux
PASSED tests/integration/test_cli_codey_packaged.py::test_packaged_codey_cli_install_and_launch
PASSED tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/codey---help]
PASSED tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/swarm-cli---help]
PASSED tests/integration/test_cli_commands.py::test_cli_minimal_prompt[/mnt/models/open-swarm-mcp/.venv/bin/codey-Say hello from codey!]
PASSED tests/integration/test_cli_commands.py::test_swarm_cli_interactive_shell
PASSED tests/integration/test_cli_jeeves.py::test_jeeves_cli_ux
PASSED tests/integration/test_cli_rue_code.py::test_rue_cli_token_cost
PASSED tests/integration/test_cli_rue_code.py::test_rue_cli_ux
PASSED tests/integration/test_cli_whinge.py::test_whinge_cli_background_job
PASSED tests/integration/test_cli_zeus.py::test_zeus_cli_integration
PASSED tests/manual/test_blueprintbase_init.py::test_init
PASSED tests/test_cli_mode_selection.py::test_valid_input
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_duplicate_system_messages
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_no_system_messages
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_only_system_messages
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_empty_list
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_mixed_valid_invalid
PASSED tests/test_core_filter_messages.py::test_filter_messages_empty_and_none_content
PASSED tests/test_core_filter_messages.py::test_filter_messages_all_valid
PASSED tests/test_core_filter_messages.py::test_filter_messages_with_non_dict_items
PASSED tests/test_core_filter_messages.py::test_filter_messages_empty_input
PASSED tests/test_core_filter_messages.py::test_filter_messages_ignores_other_keys
PASSED tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[simple]
PASSED tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[pairs]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[simple]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[pairs]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[simple]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[pairs]
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair
PASSED tests/test_core_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit
PASSED tests/test_core_truncate_message_history.py::test_pairs_handles_missing_tool_response
PASSED tests/test_core_truncate_message_history.py::test_pairs_interspersed_messages_truncation
PASSED tests/test_core_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit
PASSED tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits
PASSED tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user
PASSED tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair
PASSED tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_fit
PASSED tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user
PASSED tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair
PASSED tests/test_core_truncate_message_history.py::test_pairs_empty_input_list
PASSED tests/test_core_truncate_message_history.py::test_pairs_only_system_message
PASSED tests/test_core_truncate_message_history.py::test_pairs_invalid_messages_mixed_in
PASSED tests/test_core_truncate_message_history.py::test_pairs_non_serializable_content
PASSED tests/test_core_truncate_message_history.py::test_simple_truncation_fallback_simulation
PASSED tests/test_core_update_null_content.py::test_update_null_content_list
PASSED tests/test_core_update_null_content.py::test_update_null_content_single_dict
PASSED tests/test_core_update_null_content.py::test_update_null_content_no_change_needed
PASSED tests/test_core_update_null_content.py::test_update_null_content_empty_list_or_invalid_input
PASSED tests/test_dummy.py::test_dummy
PASSED tests/test_truncate_message_history.py::test_truncate_no_action_needed[simple]
PASSED tests/test_truncate_message_history.py::test_truncate_no_action_needed[pairs]
PASSED tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[simple]
PASSED tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[pairs]
PASSED tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[simple]
PASSED tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[pairs]
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair
PASSED tests/test_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit
PASSED tests/test_truncate_message_history.py::test_pairs_handles_missing_tool_response
PASSED tests/test_truncate_message_history.py::test_pairs_interspersed_messages_truncation
PASSED tests/test_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit
PASSED tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits
PASSED tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user
PASSED tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair
PASSED tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_fit
PASSED tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user
PASSED tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair
PASSED tests/test_truncate_message_history.py::test_pairs_empty_input_list
PASSED tests/test_truncate_message_history.py::test_pairs_only_system_message
PASSED tests/test_truncate_message_history.py::test_pairs_invalid_messages_mixed_in
PASSED tests/test_truncate_message_history.py::test_simple_truncation_fallback_simulation
PASSED tests/unit/test_ansi_box.py::test_ansi_box_basic
PASSED tests/unit/test_ansi_box.py::test_ansi_box_multiline
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_init_does_not_raise
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_markdown_setting_priority
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_llm_profile_resolution_priority
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_missing_llm_profile_raises
PASSED tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_enabled
PASSED tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_disabled
PASSED tests/unit/test_operation_box_utils.py::test_basic_box_output
PASSED tests/unit/test_operation_box_utils.py::test_code_vs_semantic_box
PASSED tests/unit/test_operation_box_utils.py::test_spinner_escalation_box
PASSED tests/unit/test_output_utils.py::test_pretty_print_response_plain_text
PASSED tests/unit/test_output_utils.py::test_pretty_print_response_with_code_fence
PASSED tests/unit/test_redact.py::test_redact_sensitive_data_basic
PASSED tests/unit/test_redact.py::test_redact_sensitive_data_string
PASSED tests/unit/test_redact.py::test_redact_sensitive_data_custom_keys
PASSED tests/unit/test_slash_commands.py::test_help_and_compact_registered
PASSED tests/unit/test_slash_commands.py::test_model_command_list_and_set
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/approval-approval]
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/history-history]
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/clear-cleared]
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/clearhistory-cleared]
PASSED tests/unit/test_spinner.py::test_spinner_runs_and_stops
PASSED tests/unit/test_spinner.py::test_spinner_long_wait
SKIPPED [1] tests/test_blueprint_loading.py:2: Skipping blueprint loading tests due to complexity of verifying dynamic INSTALLED_APPS modification during test setup
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:29: SQLite interaction testing needs refinement.
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:56: SQLite interaction testing needs refinement.
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:62: Blueprint interaction tests not yet implemented.
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:69: Blueprint action tests not yet implemented
SKIPPED [1] tests/blueprints/test_divine_code.py:89: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_family_ties.py:34: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_family_ties.py:42: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_geese.py:56: Test needs review for SDK Agent tool handling
SKIPPED [1] tests/blueprints/test_geese.py:68: Test needs review for SDK Agent tool handling
SKIPPED [1] tests/blueprints/test_geese.py:72: Spinner tests need refactoring for GeeseSpinner class methods
SKIPPED [1] tests/blueprints/test_geese.py:76: Spinner tests need refactoring for GeeseSpinner class methods
SKIPPED [1] tests/blueprints/test_geese.py:80: Tool structure needs review with SDK Agent
SKIPPED [1] tests/blueprints/test_geese.py:113: Main entry test needs review for async structure and Geese CLI specifics
SKIPPED [1] tests/blueprints/test_geese.py:117: Relies on removed module-level functions; needs agent-based testing.
SKIPPED [1] tests/blueprints/test_geese.py:121: Relies on removed module-level functions; needs agent-based testing.
SKIPPED [1] tests/blueprints/test_geese.py:125: Relies on removed module-level functions; needs agent-based testing.
SKIPPED [1] tests/blueprints/test_geese_agent_mcp_assignment.py:14: Test needs update for refactored GeeseBlueprint agent creation.
SKIPPED [1] tests/blueprints/test_geese_agent_mcp_assignment.py:39: Test needs update for refactored GeeseBlueprint agent creation.
SKIPPED [1] tests/blueprints/test_geese_spinner_and_box.py:41: GeeseSpinner internal API changed; test needs update or removal.
SKIPPED [1] tests/blueprints/test_geese_spinner_and_box.py:73: Test needs update for refactored GeeseBlueprint agent creation.
SKIPPED [1] tests/blueprints/test_gotchaman.py:22: Implementation for GotchamanBlueprint not found in codebase; skipping test.
SKIPPED [1] tests/blueprints/test_gotchaman.py:26: Tool function tests not yet implemented
SKIPPED [1] tests/blueprints/test_gotchaman.py:46: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_gotchaman.py:53: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_jeeves.py:38: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_mcp_demo.py:109: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mcp_demo.py:114: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mcp_demo.py:119: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mcp_demo.py:124: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mission_improbable.py:74: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_mission_improbable.py:81: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:21: Blueprint tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:36: Tool function tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:57: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:64: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_nebula_shellz.py:9: CLI tests require more setup/mocking
SKIPPED [1] tests/blueprints/test_nebula_shellz.py:15: CLI tests require more setup/mocking
SKIPPED [1] tests/blueprints/test_nebula_shellz.py:20: CLI tests require more setup/mocking
SKIPPED [1] tests/blueprints/test_poets.py:99: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_poets.py:103: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_suggestion.py:34: Only run if DEFAULT_LLM is set to 'test'
SKIPPED [1] tests/blueprints/test_suggestion.py:45: Only run if DEFAULT_LLM is set to 'test'
SKIPPED [1] tests/blueprints/test_suggestion.py:52: Only run if DEFAULT_LLM is set to 'test'
SKIPPED [1] tests/blueprints/test_whiskeytangofoxtrot.py:98: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_whiskeytangofoxtrot.py:101: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/integration/test_cli_geese.py:11: GeeseBlueprint functionality changed; CLI test needs review for story output vs search UX.
SKIPPED [1] tests/system/test_codey_binary.py:10: Binary ./dist/codey_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/codey/codey_cli.py --name codey_cli
SKIPPED [1] tests/system/test_rue_code_binary.py:10: Binary ./dist/rue_code_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/rue_code/rue_code_cli.py --name rue_code_cli
SKIPPED [1] tests/system/test_whinge_binary.py:10: Binary ./dist/whinge not found. Build with: pyinstaller --onefile src/swarm/blueprints/whinge_surf/whinge_surf_cli.py --name whinge
SKIPPED [1] tests/system/test_zeus_binary.py:10: Binary ./dist/zeus_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/zeus/zeus_cli.py --name zeus_cli
SKIPPED [1] tests/test_truncate_message_history.py:191: Need to verify how non-serializable data is handled
XFAIL tests/api/test_models_negative.py::test_models_exception_returns_500 - reason: View currently returns 200 on exception; adjust view to 500 to strengthen contract.
XFAIL tests/api/test_models_negative.py::test_models_unauthorized_when_permission_enforced - reason: Endpoint appears open (AllowAny); unauthorized path not applicable.
XFAIL tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[OPENAI_API_KEY-sk-test-123] - reason: swarm-cli config add not implemented or unavailable. stderr:
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/launchers/swarm_cli.py", line 12, in <module>
    from swarm.extensions.cli.main import main
ModuleNotFoundError: No module named 'swarm'

stdout:

XFAIL tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[CUSTOM_SECRET-s3cr3t!] - reason: swarm-cli config add not implemented or unavailable. stderr:
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/launchers/swarm_cli.py", line 12, in <module>
    from swarm.extensions.cli.main import main
ModuleNotFoundError: No module named 'swarm'

stdout:

========================================================================================================== 285 passed, 52 skipped, 4 xfailed, 3 warnings in 40.21s ===========================================================================================================
