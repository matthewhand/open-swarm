[pytest]
markers =
    integration: integration test
    timeout: test with timeout

DJANGO_SETTINGS_MODULE = swarm.settings
python_files = tests.py test_*.py *_tests.py
testpaths = tests
pythonpath = src
# --- Global test timeout for all tests (override with @pytest.mark.timeout or --timeout=X) ---
# Use pytest-timeout plugin (ensure installed)
# Add default options: show extra summary, enable coverage, and ignore legacy blueprint tests
# Coverage configuration is defined in [tool.coverage.*] in pyproject.toml
addopts = -ra --cov=src/swarm --cov-report=term-missing --cov-fail-under=0 --ignore-glob tests/blueprints/test_codey_*.py --ignore-glob tests/blueprints/test_codey.py --ignore-glob tests/blueprints/test_chatbot.py
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function
; DJANGO_ALLOW_ASYNC_UNSAFE is set by scripts/run_tests.py to avoid relying on pytest-env

# Filter out external deprecation warnings from dependencies
filterwarnings =
    # Ignore pkg_resources warnings from docutils and pkg_resources itself
    ignore:pkg_resources is deprecated as an API:DeprecationWarning:docutils.*:
    ignore:pkg_resources is deprecated as an API:DeprecationWarning:pkg_resources.*:
    ignore:Deprecated call to `pkg_resources.declare_namespace.*:DeprecationWarning:pkg_resources.*:
    # You might need to add more specific filters if other warnings appear

# Treat xfail as strict so unexpected passes are surfaced as failures (improves signal)
xfail_strict = true

# Optional: Add markers for better organization if needed later
# markers =
#     slow: marks tests as slow (deselect with '-m "not slow"')
#     integration: marks integration tests
#     serial

# Optional: Configure logging levels for tests
log_cli = true
log_cli_level = INFO
log_cli_format = "%(asctime)s [%(levelname)8s] %(name)s - %(message)s (%(filename)s:%(lineno)s)"
log_file = pytest.log
log_file_level = DEBUG
log_file_format = "%(asctime)s [%(levelname)8s] %(name)s - %(message)s (%(filename)s:%(lineno)s)"

# Note: Global timeout can be enabled if we observe hangs in CI
# timeout = 30
