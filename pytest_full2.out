/home/chatgpt/.local/lib/python3.10/site-packages/_testinfra_renamed.py:5: DeprecationWarning: testinfra package has been renamed to pytest-testinfra. Please `pip install pytest-testinfra` and `pip uninstall testinfra` and update your package requirements to avoid this message
  warnings.warn((

tests/api/test_models_negative.py::test_models_empty_registry_returns_200 PASSED                                                                                                                                                                                       [  0%]
tests/api/test_models_negative.py::test_models_non_mapping_iterable_gracefully_handles_type PASSED                                                                                                                                                                     [  0%]
tests/api/test_models_negative.py::test_models_exception_returns_500 XFAIL (View currently returns 200 on exception; adjust view to 500 to strengthen contract.)                                                                                                       [  0%]
tests/api/test_models_negative.py::test_models_unauthorized_when_permission_enforced XFAIL (Endpoint appears open (AllowAny); unauthorized path not applicable.)                                                                                                       [  1%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_code_comprehensive PASSED                                                                                                                                                    [  1%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_missing_yield PASSED                                                                                                                                               [  1%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_valid PASSED                                                                                                                                                       [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_problematic_code PASSED                                                                                                                                                    [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_safe_code PASSED                                                                                                                                                           [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_dangerous_code PASSED                                                                                                                                                         [  2%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_hardcoded_secrets PASSED                                                                                                                                                      [  3%]
tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_safe_code PASSED                                                                                                                                                              [  3%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_basic PASSED                                                                                                                                                                    [  3%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_with_complex_expertise PASSED                                                                                                                                                   [  4%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_sanitize_class_name PASSED                                                                                                                                                                          [  4%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_analytical PASSED                                                                                                                                                                [  4%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_conversational PASSED                                                                                                                                                            [  5%]
tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_creative PASSED                                                                                                                                                                  [  5%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_context PASSED                                                                                                                                                            [  5%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_get PASSED                                                                                                                                                                [  5%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProIntegration::test_full_agent_creation_workflow PASSED                                                                                                                                                        [  6%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_empty_expertise PASSED                                                                                                                                                 [  6%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_missing_fields PASSED                                                                                                                                                  [  6%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_empty_code PASSED                                                                                                                                                      [  7%]
tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_invalid_syntax PASSED                                                                                                                                                  [  7%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_all_settings PASSED                                                                                                                                                                          [  7%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_auth_settings PASSED                                                                                                                                                                         [  7%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_database_settings PASSED                                                                                                                                                                     [  8%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_django_settings PASSED                                                                                                                                                                       [  8%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_error PASSED                                                                                                                                                                    [  8%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_success PASSED                                                                                                                                                                  [  9%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_logging_settings PASSED                                                                                                                                                                      [  9%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_performance_settings PASSED                                                                                                                                                                  [  9%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_swarm_core_settings PASSED                                                                                                                                                                   [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_ui_settings PASSED                                                                                                                                                                           [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsManager::test_settings_manager_initialization PASSED                                                                                                                                                               [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_filtering PASSED                                                                                                                                                        [ 10%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_get PASSED                                                                                                                                                              [ 11%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_get PASSED                                                                                                                                                                       [ 11%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_sensitive_data_filtering PASSED                                                                                                                                                  [ 11%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_context PASSED                                                                                                                                                             [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_error_handling FAILED                                                                                                                                                      [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_get PASSED                                                                                                                                                                 [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_empty_config_file PASSED                                                                                                                                                                    [ 12%]
tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_missing_django_settings PASSED                                                                                                                                                              [ 13%]
tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_no_environment_variables PASSED                                                                                                                                                             [ 13%]
tests/views/test_settings_dashboard.py::TestSettingsIntegration::test_full_settings_collection_workflow PASSED                                                                                                                                                         [ 13%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_no_auth_returns_403 PASSED                                                                                                                                                           [ 14%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_invalid_token_returns_403 PASSED                                                                                                                                                     [ 14%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_token_allows_access PASSED                                                                                                                                                     [ 14%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_session_allows_access PASSED                                                                                                                                                   [ 15%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_echocraft_non_streaming_success_auth_disabled PASSED                                                                                                                                 [ 15%]
tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_chatbot_non_streaming_success_auth_disabled PASSED                                                                                                                                   [ 15%]
tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_echocraft_streaming_success PASSED                                                                                                                                          [ 15%]
tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_chatbot_streaming_success PASSED                                                                                                                                            [ 16%]
tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_blueprint_run_exception_streaming_returns_error_sse PASSED                                                                                                                  [ 16%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[model] PASSED                                                                                                                         [ 16%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[messages] PASSED                                                                                                                      [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data0-Ensure this field has at least 1 elements] PASSED                                                                [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data1-Expected a list of items] PASSED                                                                                 [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data2-This field is required.] PASSED                                                                                  [ 17%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data3-This field is required.] PASSED                                                                                  [ 18%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data4-invalid" is not a valid choice] PASSED                                                                           [ 18%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data5-Content must be a string or null.] PASSED                                                                        [ 18%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_malformed_json_returns_400 PASSED                                                                                                                                        [ 19%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_permission_denied PASSED                                                                                                                               [ 19%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_not_found PASSED                                                                                                                                       [ 19%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_init_error_returns_500 PASSED                                                                                                                                  [ 20%]
tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_run_exception_non_streaming_returns_500 PASSED                                                                                                                 [ 20%]
tests/api/test_endpoints_list_blueprints_models.py::test_models_and_blueprints_endpoints_include_dynamic_team PASSED                                                                                                                                                   [ 20%]
tests/api/test_teams_export_import.py::test_export_json_and_csv_and_import_roundtrip PASSED                                                                                                                                                                            [ 20%]
tests/integration/test_dynamic_teams_reset.py::test_reset_clears_dynamic_registry_and_discovery PASSED                                                                                                                                                                 [ 21%]
tests/integration/test_dynamic_teams_smoke.py::test_dynamic_team_registry_and_discovery_roundtrip PASSED                                                                                                                                                               [ 21%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_db_initialization SKIPPED (SQLite interaction testing needs refinement.)                                                                                                                                         [ 21%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_get_agent_config_from_db SKIPPED (SQLite interaction testing needs refinement.)                                                                                                                                  [ 22%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_delegation_flow_sqlite SKIPPED (Blueprint interaction tests not yet implemented.)                                                                                                                                [ 22%]
tests/blueprints/test_dilbot_universe.py::test_dilbot_build_action_sqlite SKIPPED (Blueprint action tests not yet implemented)                                                                                                                                         [ 22%]
tests/blueprints/test_divine_code.py::test_zeus_agent_creation PASSED                                                                                                                                                                                                  [ 22%]
tests/blueprints/test_divine_code.py::test_zeus_run_method PASSED                                                                                                                                                                                                      [ 23%]
tests/blueprints/test_divine_code.py::test_zeus_delegation_to_odin PASSED                                                                                                                                                                                              [ 23%]
tests/blueprints/test_divine_code.py::test_zeus_basic PASSED                                                                                                                                                                                                           [ 23%]
tests/blueprints/test_divine_code.py::test_zeus_full_flow_example PASSED                                                                                                                                                                                               [ 24%]
tests/blueprints/test_divine_code.py::test_zeus_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                        [ 24%]
tests/blueprints/test_echocraft.py::test_echocraft_blueprint_run PASSED                                                                                                                                                                                                [ 24%]
tests/blueprints/test_echocraft.py::test_echocraft_blueprint_no_user_message PASSED                                                                                                                                                                                    [ 25%]
tests/blueprints/test_echocraft.py::test_echocraft_blueprint_multiple_messages PASSED                                                                                                                                                                                  [ 25%]
tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_success PASSED                                                                                                                                                                                          [ 25%]
tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_unexpected_response_format PASSED                                                                                                                                                                       [ 25%]
tests/blueprints/test_family_ties.py::test_stewie_agent_creation PASSED                                                                                                                                                                                                [ 26%]
tests/blueprints/test_family_ties.py::test_stewie_delegation_to_brian SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                        [ 26%]
tests/blueprints/test_family_ties.py::test_stewie_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                      [ 26%]
tests/blueprints/test_geese.py::test_geese_agent_handoff_and_astool SKIPPED (Test needs review for SDK Agent tool handling)                                                                                                                                            [ 27%]
tests/blueprints/test_geese.py::test_agent_tool_creation SKIPPED (Test needs review for SDK Agent tool handling)                                                                                                                                                       [ 27%]
tests/blueprints/test_geese.py::test_spinner_state_updates SKIPPED (Spinner tests need refactoring for GeeseSpinner class methods)                                                                                                                                     [ 27%]
tests/blueprints/test_geese.py::test_spinner_state_transitions SKIPPED (Spinner tests need refactoring for GeeseSpinner class methods)                                                                                                                                 [ 27%]
tests/blueprints/test_geese.py::test_geese_story_delegation_flow SKIPPED (Tool structure needs review with SDK Agent)                                                                                                                                                  [ 28%]
tests/blueprints/test_geese.py::test_operation_box_styles PASSED                                                                                                                                                                                                       [ 28%]
tests/blueprints/test_geese.py::test_display_splash_screen_variants PASSED                                                                                                                                                                                             [ 28%]
tests/blueprints/test_geese.py::test_main_entry SKIPPED (Main entry test needs review for async structure and Geese CLI specifics)                                                                                                                                     [ 29%]
tests/blueprints/test_geese.py::test_create_story_outline SKIPPED (Relies on removed module-level functions; needs agent-based testing.)                                                                                                                               [ 29%]
tests/blueprints/test_geese.py::test_write_story_part SKIPPED (Relies on removed module-level functions; needs agent-based testing.)                                                                                                                                   [ 29%]
tests/blueprints/test_geese.py::test_edit_story SKIPPED (Relies on removed module-level functions; needs agent-based testing.)                                                                                                                                         [ 30%]
tests/blueprints/test_geese.py::test_spinner_messages PASSED                                                                                                                                                                                                           [ 30%]
tests/blueprints/test_geese.py::test_story_generation_flow PASSED                                                                                                                                                                                                      [ 30%]
tests/blueprints/test_geese_agent_mcp_assignment.py::test_agent_mcp_assignment SKIPPED (Test needs update for refactored GeeseBlueprint agent creation.)                                                                                                               [ 30%]
tests/blueprints/test_geese_agent_mcp_assignment.py::test_agent_mcp_assignment_cli_override SKIPPED (Test needs update for refactored GeeseBlueprint agent creation.)                                                                                                  [ 31%]
tests/blueprints/test_geese_spinner_and_box.py::test_geese_spinner_methods SKIPPED (GeeseSpinner internal API changed; test needs update or removal.)                                                                                                                  [ 31%]
tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_basic PASSED                                                                                                                                                                                [ 31%]
tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_default_emoji PASSED                                                                                                                                                                        [ 32%]
tests/blueprints/test_geese_spinner_and_box.py::test_progressive_demo_operation_box SKIPPED (Test needs update for refactored GeeseBlueprint agent creation.)                                                                                                          [ 32%]
tests/blueprints/test_gotchaman.py::test_gotchaman_agent_creation SKIPPED (Implementation for GotchamanBlueprint not found in codebase; skipping test.)                                                                                                                [ 32%]
tests/blueprints/test_gotchaman.py::test_gotchaman_execute_command_tool SKIPPED (Tool function tests not yet implemented)                                                                                                                                              [ 32%]
tests/blueprints/test_gotchaman.py::test_gotchaman_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                           [ 33%]
tests/blueprints/test_gotchaman.py::test_gotchaman_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                     [ 33%]
tests/blueprints/test_jeeves.py::test_jeeves_agent_creation PASSED                                                                                                                                                                                                     [ 33%]
tests/blueprints/test_jeeves.py::test_jeeves_delegation_to_mycroft PASSED                                                                                                                                                                                              [ 34%]
tests/blueprints/test_jeeves.py::test_jeeves_delegation_to_gutenberg SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                         [ 34%]
tests/blueprints/test_jeeves.py::test_jeeves_cli_execution PASSED                                                                                                                                                                                                      [ 34%]
tests/blueprints/test_jeeves_progressive_tool.py::test_display_operation_box_progress PASSED                                                                                                                                                                           [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[0-Polishing the silver] PASSED                                                                                                                                                             [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[1-Generating.] PASSED                                                                                                                                                                      [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[2-Generating..] PASSED                                                                                                                                                                     [ 35%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[3-Generating...] PASSED                                                                                                                                                                    [ 36%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[4-Running...] PASSED                                                                                                                                                                       [ 36%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[5-Polishing the silver] PASSED                                                                                                                                                             [ 36%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_long_wait PASSED                                                                                                                                                                                  [ 37%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_basic PASSED                                                                                                                                                                               [ 37%]
tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_long_wait PASSED                                                                                                                                                                           [ 37%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_agent_creation PASSED                                                                                                                                                                                                  [ 37%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_bad_config PASSED                                                                                                                                                                                                      [ 38%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_filesystem_interaction PASSED                                                                                                                                                                                          [ 38%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_memory_interaction PASSED                                                                                                                                                                                              [ 38%]
tests/blueprints/test_mcp_demo.py::test_mcpdemo_cli_execution PASSED                                                                                                                                                                                                   [ 39%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_help SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                                [ 39%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_simple_task SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                         [ 39%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_time SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                                [ 40%]
tests/blueprints/test_mcp_demo.py::test_mcp_demo_cli_list_files SKIPPED (Legacy CLI tests require specific old setup/mocking)                                                                                                                                          [ 40%]
tests/blueprints/test_mission_improbable.py::test_mission_db_initialization PASSED                                                                                                                                                                                     [ 40%]
tests/blueprints/test_mission_improbable.py::test_mission_agent_creation PASSED                                                                                                                                                                                        [ 40%]
tests/blueprints/test_mission_improbable.py::test_mission_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                    [ 41%]
tests/blueprints/test_mission_improbable.py::test_mission_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                              [ 41%]
tests/blueprints/test_monkai_magic.py::test_monkai_agent_creation SKIPPED (Blueprint tests not yet implemented)                                                                                                                                                        [ 41%]
tests/blueprints/test_monkai_magic.py::test_monkai_aws_cli_tool SKIPPED (Tool function tests not yet implemented)                                                                                                                                                      [ 42%]
tests/blueprints/test_monkai_magic.py::test_monkai_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                           [ 42%]
tests/blueprints/test_monkai_magic.py::test_monkai_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                     [ 42%]
tests/blueprints/test_nebula_shellz.py::test_nebula_shellz_cli_simple_task SKIPPED (CLI tests require more setup/mocking)                                                                                                                                              [ 42%]
tests/blueprints/test_nebula_shellz.py::test_nebula_shellz_cli_shell_command SKIPPED (CLI tests require more setup/mocking)                                                                                                                                            [ 43%]
tests/blueprints/test_nebula_shellz.py::test_nebula_shellz_cli_delegate_shell SKIPPED (CLI tests require more setup/mocking)                                                                                                                                           [ 43%]
tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_all_types PASSED                                                                                                                                                                                       [ 43%]
tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_only_npx PASSED                                                                                                                                                                                        [ 44%]
tests/blueprints/test_omniplex.py::test_omniplex_delegation_to_amazo PASSED                                                                                                                                                                                            [ 44%]
tests/blueprints/test_omniplex.py::test_omniplex_cli_execution PASSED                                                                                                                                                                                                  [ 44%]
tests/blueprints/test_poets.py::test_poets_db_initialization PASSED                                                                                                                                                                                                    [ 45%]
tests/blueprints/test_poets.py::test_poets_agent_creation PASSED                                                                                                                                                                                                       [ 45%]
tests/blueprints/test_poets.py::test_poets_collaboration_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                                [ 45%]
tests/blueprints/test_poets.py::test_poets_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                             [ 45%]
tests/blueprints/test_rue_code_cost.py::test_gpt4_cost PASSED                                                                                                                                                                                                          [ 46%]
tests/blueprints/test_rue_code_cost.py::test_invalid_model PASSED                                                                                                                                                                                                      [ 46%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_spinner_states PASSED                                                                                                                                                                                      [ 46%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_operation_box_output PASSED                                                                                                                                                                                [ 47%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_box PASSED                                                                                                                                                                                             [ 47%]
tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_empty PASSED                                                                                                                                                                                           [ 47%]
tests/blueprints/test_suggestion.py::test_suggestion_agent_creation SKIPPED (Only run if DEFAULT_LLM is set to 'test')                                                                                                                                                 [ 47%]
tests/blueprints/test_suggestion.py::test_suggestion_run_produces_structured_output SKIPPED (Only run if DEFAULT_LLM is set to 'test')                                                                                                                                 [ 48%]
tests/blueprints/test_suggestion.py::test_suggestion_cli_execution SKIPPED (Only run if DEFAULT_LLM is set to 'test')                                                                                                                                                  [ 48%]
tests/blueprints/test_whinge_surf.py::test_run_and_check_status PASSED                                                                                                                                                                                                 [ 48%]
tests/blueprints/test_whinge_surf.py::test_kill_subprocess PASSED                                                                                                                                                                                                      [ 49%]
tests/blueprints/test_whinge_surf.py::test_tail_and_show_output PASSED                                                                                                                                                                                                 [ 49%]
tests/blueprints/test_whinge_surf.py::test_list_and_prune_jobs PASSED                                                                                                                                                                                                  [ 49%]
tests/blueprints/test_whinge_surf.py::test_resource_usage_and_analyze_self PASSED                                                                                                                                                                                      [ 50%]
tests/blueprints/test_whinge_surf.py::test_self_update PASSED                                                                                                                                                                                                          [ 50%]
tests/blueprints/test_whinge_surf_analysis.py::test_analyze_self_runs PASSED                                                                                                                                                                                           [ 50%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_agent_creation PASSED                                                                                                                                                                                           [ 50%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_db_initialization PASSED                                                                                                                                                                                        [ 51%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_delegation_flow SKIPPED (Blueprint interaction tests not yet implemented)                                                                                                                                       [ 51%]
tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_cli_execution SKIPPED (Blueprint CLI tests not yet implemented)                                                                                                                                                 [ 51%]
tests/blueprints/test_zeus.py::test_metadata_lists_cli_as_divine_ass PASSED                                                                                                                                                                                            [ 52%]
tests/blueprints/test_zeus_cli.py::test_zeus_cli_banner PASSED                                                                                                                                                                                                         [ 52%]
tests/blueprints/test_zeus_cli.py::test_zeus_cli_multiple_inputs PASSED                                                                                                                                                                                                [ 52%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_spinner_states PASSED                                                                                                                                                                                         [ 52%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_operation_box_output PASSED                                                                                                                                                                                   [ 53%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_assist_box PASSED                                                                                                                                                                                             [ 53%]
tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_run_empty PASSED                                                                                                                                                                                              [ 53%]
tests/cli/test_cli_config.py::test_create_llm_config PASSED                                                                                                                                                                                                            [ 54%]
tests/cli/test_cli_config.py::test_read_llm_config PASSED                                                                                                                                                                                                              [ 54%]
tests/cli/test_cli_config.py::test_update_llm_config PASSED                                                                                                                                                                                                            [ 54%]
tests/cli/test_cli_config.py::test_partial_update_llm_config PASSED                                                                                                                                                                                                    [ 55%]
tests/cli/test_cli_config.py::test_delete_llm_config PASSED                                                                                                                                                                                                            [ 55%]
tests/cli/test_cli_config.py::test_invalid_config_handling PASSED                                                                                                                                                                                                      [ 55%]
tests/cli/test_cli_config.py::test_config_list_all PASSED                                                                                                                                                                                                              [ 55%]
tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[OPENAI_API_KEY-sk-test-123] XFAIL (swarm-cli config add not implemented or unavailable. stderr:)                                                                  [ 56%]
tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[CUSTOM_SECRET-s3cr3t!] XFAIL (swarm-cli config add not implemented or unavailable. stderr:)                                                                       [ 56%]
tests/cli/test_config_secrets_and_env_expansion.py::test_env_var_expansion_in_config_loader PASSED                                                                                                                                                                     [ 56%]
tests/cli/test_launchers.py::test_swarm_cli_entrypoint PASSED                                                                                                                                                                                                          [ 57%]
tests/cli/test_launchers.py::test_swarm_cli_install_executable_creates_executable PASSED                                                                                                                                                                               [ 57%]
tests/cli/test_launchers.py::test_swarm_install_executable_failure PASSED                                                                                                                                                                                              [ 57%]
tests/cli/test_launchers.py::test_swarm_launch_runs_executable PASSED                                                                                                                                                                                                  [ 57%]
tests/cli/test_launchers.py::test_swarm_launch_failure_not_found PASSED                                                                                                                                                                                                [ 58%]
tests/cli/test_list_blueprints.py::test_execute_list_user_installed PASSED                                                                                                                                                                                             [ 58%]
tests/cli/test_list_blueprints.py::test_execute_list_available PASSED                                                                                                                                                                                                  [ 58%]
tests/cli/test_list_blueprints.py::test_execute_no_user_installed_blueprints PASSED                                                                                                                                                                                    [ 59%]
tests/cli/test_list_blueprints.py::test_execute_no_available_blueprints PASSED                                                                                                                                                                                         [ 59%]
tests/cli/test_list_blueprints.py::test_execute_discovery_exception_user_installed PASSED                                                                                                                                                                              [ 59%]
tests/cli/test_list_blueprints.py::test_execute_discovery_exception_available PASSED                                                                                                                                                                                   [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args0] PASSED                                                                                                                                                                           [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args1] PASSED                                                                                                                                                                           [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_key_with_config PASSED                                                                                                                                                                                [ 60%]
tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_suppressed_when_env_flag_unset PASSED                                                                                                                                                                    [ 61%]
tests/core/test_blueprint_model_override.py::test_blueprint_default_model_override PASSED                                                                                                                                                                              [ 61%]
tests/core/test_blueprint_model_override.py::test_fallback_logs_warning PASSED                                                                                                                                                                                         [ 61%]
tests/core/test_config_default_generation.py::test_default_config_generation PASSED                                                                                                                                                                                    [ 62%]
tests/core/test_config_discovery.py::test_xdg_config_discovery PASSED                                                                                                                                                                                                  [ 62%]
tests/core/test_config_discovery.py::test_config_fallback_to_cwd PASSED                                                                                                                                                                                                [ 62%]
tests/core/test_config_loader.py::test_load_full_configuration_defaults PASSED                                                                                                                                                                                         [ 62%]
tests/core/test_config_loader.py::test_load_full_configuration_profile_merging PASSED                                                                                                                                                                                  [ 63%]
tests/core/test_config_loader.py::test_load_full_configuration_env_substitution PASSED                                                                                                                                                                                 [ 63%]
tests/core/test_config_loader.py::test_load_full_configuration_missing_file PASSED                                                                                                                                                                                     [ 63%]
tests/core/test_config_loader.py::test_load_full_configuration_bad_json PASSED                                                                                                                                                                                         [ 64%]
tests/core/test_config_loader.py::test_load_full_configuration_empty_config PASSED                                                                                                                                                                                     [ 64%]
tests/core/test_config_loader.py::test_load_environment PASSED                                                                                                                                                                                                         [ 64%]
tests/core/test_fallback_to_default_model.py::test_fallback_to_default_model PASSED                                                                                                                                                                                    [ 65%]
tests/core/test_mcp_server_config.py::test_mcp_server_config_parsing PASSED                                                                                                                                                                                            [ 65%]
tests/core/test_mcp_server_config.py::test_mcp_server_add_remove_and_edge_cases PASSED                                                                                                                                                                                 [ 65%]
tests/core/test_redact_sensitive_data.py::test_redacts_api_keys_and_tokens PASSED                                                                                                                                                                                      [ 65%]
tests/core/test_redact_sensitive_data.py::test_does_not_redact_non_sensitive_strings PASSED                                                                                                                                                                            [ 66%]
tests/core/test_redact_sensitive_data.py::test_partial_redaction_behavior PASSED                                                                                                                                                                                       [ 66%]
tests/core/test_redact_sensitive_data.py::test_handles_empty_and_non_dict_inputs PASSED                                                                                                                                                                                [ 66%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_basic_run PASSED                                                                                                                                                                                 [ 67%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_custom_port_and_config_creation PASSED                                                                                                                                                           [ 67%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_daemon_mode PASSED                                                                                                                                                                               [ 67%]
tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_blueprint_not_found PASSED                                                                                                                                                                       [ 67%]
tests/integration/test_cli_codey.py::test_codey_cli_ux PASSED                                                                                                                                                                                                          [ 68%]
tests/integration/test_cli_codey_packaged.py::test_packaged_codey_cli_install_and_launch PASSED                                                                                                                                                                        [ 68%]
tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/codey---help] PASSED                                                                                                                                                        [ 68%]
tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/swarm-cli---help] PASSED                                                                                                                                                    [ 69%]
tests/integration/test_cli_commands.py::test_cli_minimal_prompt[/mnt/models/open-swarm-mcp/.venv/bin/codey-Say hello from codey!] PASSED                                                                                                                               [ 69%]
tests/integration/test_cli_commands.py::test_swarm_cli_interactive_shell PASSED                                                                                                                                                                                        [ 69%]
tests/integration/test_cli_geese.py::test_geese_cli_search_ux SKIPPED (GeeseBlueprint functionality changed; CLI test needs review for story output vs search UX.)                                                                                                     [ 70%]
tests/integration/test_cli_jeeves.py::test_jeeves_cli_ux PASSED                                                                                                                                                                                                        [ 70%]
tests/integration/test_cli_rue_code.py::test_rue_cli_token_cost PASSED                                                                                                                                                                                                 [ 70%]
tests/integration/test_cli_rue_code.py::test_rue_cli_ux PASSED                                                                                                                                                                                                         [ 70%]
tests/integration/test_cli_whinge.py::test_whinge_cli_background_job PASSED                                                                                                                                                                                            [ 71%]
tests/integration/test_cli_zeus.py::test_zeus_cli_integration PASSED                                                                                                                                                                                                   [ 71%]
tests/manual/test_blueprintbase_init.py::test_init PASSED                                                                                                                                                                                                              [ 71%]
tests/system/test_codey_binary.py::test_codey_binary SKIPPED (Binary ./dist/codey_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/codey/codey_cli.py --name codey_cli)                                                                           [ 72%]
tests/system/test_rue_code_binary.py::test_rue_code_binary SKIPPED (Binary ./dist/rue_code_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/rue_code/rue_code_cli.py --name rue_code_cli)                                                         [ 72%]
tests/system/test_whinge_binary.py::test_whinge_binary SKIPPED (Binary ./dist/whinge not found. Build with: pyinstaller --onefile src/swarm/blueprints/whinge_surf/whinge_surf_cli.py --name whinge)                                                                   [ 72%]
tests/system/test_zeus_binary.py::test_zeus_binary SKIPPED (Binary ./dist/zeus_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/zeus/zeus_cli.py --name zeus_cli)                                                                                 [ 72%]
tests/test_cli_mode_selection.py::test_valid_input PASSED                                                                                                                                                                                                              [ 73%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_duplicate_system_messages PASSED                                                                                                                                                                      [ 73%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_no_system_messages PASSED                                                                                                                                                                             [ 73%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_only_system_messages PASSED                                                                                                                                                                           [ 74%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_empty_list PASSED                                                                                                                                                                                     [ 74%]
tests/test_core_filter_duplicate_system_messages.py::test_filter_mixed_valid_invalid PASSED                                                                                                                                                                            [ 74%]
tests/test_core_filter_messages.py::test_filter_messages_empty_and_none_content PASSED                                                                                                                                                                                 [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_all_valid PASSED                                                                                                                                                                                              [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_with_non_dict_items PASSED                                                                                                                                                                                    [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_empty_input PASSED                                                                                                                                                                                            [ 75%]
tests/test_core_filter_messages.py::test_filter_messages_ignores_other_keys PASSED                                                                                                                                                                                     [ 76%]
tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[simple] PASSED                                                                                                                                                                             [ 76%]
tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[pairs] PASSED                                                                                                                                                                              [ 76%]
tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[simple] PASSED                                                                                                                                                                       [ 77%]
tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[pairs] PASSED                                                                                                                                                                        [ 77%]
tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[simple] PASSED                                                                                                                                                                         [ 77%]
tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[pairs] PASSED                                                                                                                                                                          [ 77%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space PASSED                                                                                                                                                                        [ 78%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space PASSED                                                                                                                                                                        [ 78%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space PASSED                                                                                                                                                                        [ 78%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user PASSED                                                                                                                                                                    [ 79%]
tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair PASSED                                                                                                                                                                    [ 79%]
tests/test_core_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit PASSED                                                                                                                                                              [ 79%]
tests/test_core_truncate_message_history.py::test_pairs_handles_missing_tool_response PASSED                                                                                                                                                                           [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_interspersed_messages_truncation PASSED                                                                                                                                                                        [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit PASSED                                                                                                                                                               [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits PASSED                                                                                                                                                                             [ 80%]
tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user PASSED                                                                                                                                                                        [ 81%]
tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair PASSED                                                                                                                                                                        [ 81%]
tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_fit PASSED                                                                                                                                                                                  [ 81%]
tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user PASSED                                                                                                                                                                             [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair PASSED                                                                                                                                                                       [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_empty_input_list PASSED                                                                                                                                                                                        [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_only_system_message PASSED                                                                                                                                                                                     [ 82%]
tests/test_core_truncate_message_history.py::test_pairs_invalid_messages_mixed_in PASSED                                                                                                                                                                               [ 83%]
tests/test_core_truncate_message_history.py::test_pairs_non_serializable_content PASSED                                                                                                                                                                                [ 83%]
tests/test_core_truncate_message_history.py::test_simple_truncation_fallback_simulation PASSED                                                                                                                                                                         [ 83%]
tests/test_core_update_null_content.py::test_update_null_content_list PASSED                                                                                                                                                                                           [ 84%]
tests/test_core_update_null_content.py::test_update_null_content_single_dict PASSED                                                                                                                                                                                    [ 84%]
tests/test_core_update_null_content.py::test_update_null_content_no_change_needed PASSED                                                                                                                                                                               [ 84%]
tests/test_core_update_null_content.py::test_update_null_content_empty_list_or_invalid_input PASSED                                                                                                                                                                    [ 85%]
tests/test_dummy.py::test_dummy PASSED                                                                                                                                                                                                                                 [ 85%]
tests/test_truncate_message_history.py::test_truncate_no_action_needed[simple] PASSED                                                                                                                                                                                  [ 85%]
tests/test_truncate_message_history.py::test_truncate_no_action_needed[pairs] PASSED                                                                                                                                                                                   [ 85%]
tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[simple] PASSED                                                                                                                                                                            [ 86%]
tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[pairs] PASSED                                                                                                                                                                             [ 86%]
tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[simple] PASSED                                                                                                                                                                              [ 86%]
tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[pairs] PASSED                                                                                                                                                                               [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space PASSED                                                                                                                                                                             [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space PASSED                                                                                                                                                                             [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space PASSED                                                                                                                                                                             [ 87%]
tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user PASSED                                                                                                                                                                         [ 88%]
tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair PASSED                                                                                                                                                                         [ 88%]
tests/test_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit PASSED                                                                                                                                                                   [ 88%]
tests/test_truncate_message_history.py::test_pairs_handles_missing_tool_response PASSED                                                                                                                                                                                [ 89%]
tests/test_truncate_message_history.py::test_pairs_interspersed_messages_truncation PASSED                                                                                                                                                                             [ 89%]
tests/test_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit PASSED                                                                                                                                                                    [ 89%]
tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits PASSED                                                                                                                                                                                  [ 90%]
tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user PASSED                                                                                                                                                                             [ 90%]
tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair PASSED                                                                                                                                                                             [ 90%]
tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_fit PASSED                                                                                                                                                                                       [ 90%]
tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user PASSED                                                                                                                                                                                  [ 91%]
tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair PASSED                                                                                                                                                                            [ 91%]
tests/test_truncate_message_history.py::test_pairs_empty_input_list PASSED                                                                                                                                                                                             [ 91%]
tests/test_truncate_message_history.py::test_pairs_only_system_message PASSED                                                                                                                                                                                          [ 92%]
tests/test_truncate_message_history.py::test_pairs_invalid_messages_mixed_in PASSED                                                                                                                                                                                    [ 92%]
tests/test_truncate_message_history.py::test_pairs_non_serializable_content SKIPPED (Need to verify how non-serializable data is handled)                                                                                                                              [ 92%]
tests/test_truncate_message_history.py::test_simple_truncation_fallback_simulation PASSED                                                                                                                                                                              [ 92%]
tests/unit/test_ansi_box.py::test_ansi_box_basic PASSED                                                                                                                                                                                                                [ 93%]
tests/unit/test_ansi_box.py::test_ansi_box_multiline PASSED                                                                                                                                                                                                            [ 93%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_init_does_not_raise PASSED                                                                                                                                                              [ 93%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_markdown_setting_priority PASSED                                                                                                                                                        [ 94%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_llm_profile_resolution_priority PASSED                                                                                                                                                  [ 94%]
tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_missing_llm_profile_raises PASSED                                                                                                                                                       [ 94%]
tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_enabled PASSED                                                                                                                                                                                   [ 95%]
tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_disabled PASSED                                                                                                                                                                                  [ 95%]
tests/unit/test_operation_box_utils.py::test_basic_box_output PASSED                                                                                                                                                                                                   [ 95%]
tests/unit/test_operation_box_utils.py::test_code_vs_semantic_box PASSED                                                                                                                                                                                               [ 95%]
tests/unit/test_operation_box_utils.py::test_spinner_escalation_box PASSED                                                                                                                                                                                             [ 96%]
tests/unit/test_output_utils.py::test_pretty_print_response_plain_text PASSED                                                                                                                                                                                          [ 96%]
tests/unit/test_output_utils.py::test_pretty_print_response_with_code_fence PASSED                                                                                                                                                                                     [ 96%]
tests/unit/test_redact.py::test_redact_sensitive_data_basic PASSED                                                                                                                                                                                                     [ 97%]
tests/unit/test_redact.py::test_redact_sensitive_data_string PASSED                                                                                                                                                                                                    [ 97%]
tests/unit/test_redact.py::test_redact_sensitive_data_custom_keys PASSED                                                                                                                                                                                               [ 97%]
tests/unit/test_slash_commands.py::test_help_and_compact_registered PASSED                                                                                                                                                                                             [ 97%]
tests/unit/test_slash_commands.py::test_model_command_list_and_set PASSED                                                                                                                                                                                              [ 98%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/approval-approval] PASSED                                                                                                                                                                           [ 98%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/history-history] PASSED                                                                                                                                                                             [ 98%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/clear-cleared] PASSED                                                                                                                                                                               [ 99%]
tests/unit/test_slash_commands.py::test_additional_slash_commands[/clearhistory-cleared] PASSED                                                                                                                                                                        [ 99%]
tests/unit/test_spinner.py::test_spinner_runs_and_stops PASSED                                                                                                                                                                                                         [ 99%]
tests/unit/test_spinner.py::test_spinner_long_wait PASSED                                                                                                                                                                                                              [100%]

================================================================================================================================== FAILURES ==================================================================================================================================
_____________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_dashboard_error_handling ______________________________________________________________________________________________________

self = <test_settings_dashboard.TestSettingsDashboardViews testMethod=test_settings_dashboard_error_handling>, mock_manager = <MagicMock name='settings_manager' id='265145550706800'>

    @patch('src.swarm.views.settings_views.settings_manager')
    def test_settings_dashboard_error_handling(self, mock_manager):
        """Test settings dashboard handles errors gracefully"""
        mock_manager.collect_all_settings.side_effect = Exception("Collection failed")
    
        response = self.client.get('/settings/')
    
>       self.assertEqual(response.status_code, 500)
E       AssertionError: 200 != 500

tests/views/test_settings_dashboard.py:227: AssertionError
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:57,522 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,522 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,523 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,524 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,524 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,524 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,524 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,524 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
============================================================================================================================== warnings summary ==============================================================================================================================
../../../home/chatgpt/.local/lib/python3.10/site-packages/_pytest/config/__init__.py:1441
  /home/chatgpt/.local/lib/python3.10/site-packages/_pytest/config/__init__.py:1441: PytestConfigWarning: Unknown config option: env
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

../../../home/chatgpt/.local/lib/python3.10/site-packages/starlette/formparsers.py:12
  /home/chatgpt/.local/lib/python3.10/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

../../../home/chatgpt/.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323
  /home/chatgpt/.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=================================================================================================================================== PASSES ===================================================================================================================================
___________________________________________________________________________________________________________________ test_models_empty_registry_returns_200 ___________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
Creating test database for alias 'default'...
Destroying old test database for alias 'default'...
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:57:55,435 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 20:57:55,436 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 20:57:55,436 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 20:57:55,436 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 20:57:55,436 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 20:57:55,436 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:57:55,436 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:57:55,440 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 20:57:55,441 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:57:55,441 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 20:57:55,441 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 20:57:55,445 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 20:57:55,445 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 20:57:55,445 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 20:57:55,445 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 20:57:55,446 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 20:57:55,446 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 20:57:55,446 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 20:57:55,447 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 20:57:55,448 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 20:57:55,449 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 20:57:55,450 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 20:57:55,450 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 20:57:55,450 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 20:57:55,450 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 20:57:55,450 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 20:57:55,451 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 20:57:55,451 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 20:57:55,451 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 20:57:55,451 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 20:57:55,460 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 20:57:55,460 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 20:57:55,460 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 20:57:55,460 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 20:57:55,460 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 20:57:55,460 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 20:57:55,461 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
# Last swarm update: 2025-08-24T20:57:55Z (UTC)
[DEBUG] 2025-08-24 20:57:55,466 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 20:57:55,466 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 20:57:55,466 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 20:57:55,467 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 20:57:55,467 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 20:57:55,467 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 20:57:55,467 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 20:57:55,467 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 20:57:55,467 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 20:57:55,468 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 20:57:55,469 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 20:57:55,469 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 20:57:55,469 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 20:57:55,469 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:55,434 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:57:55,434 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:57:55,434 - asyncio:54 - Using selector: EpollSelector
[INFO] 2025-08-24 20:57:55,435 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[DEBUG] 2025-08-24 20:57:55,472 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 20:57:55,472 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 20:57:55,473 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 20:57:55,473 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 20:57:55,474 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 20:57:55,474 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 20:57:55,474 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 20:57:55,474 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 20:57:55,474 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 20:57:55,474 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 20:57:55,475 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 20:57:55,476 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 20:57:55,476 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 20:57:55,476 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 20:57:55,476 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 20:57:55,476 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 20:57:55,476 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 20:57:55,480 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 20:57:55,480 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 20:57:55,480 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 20:57:55,480 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 20:57:55,481 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T20:57:55Z (UTC)
[DEBUG] 2025-08-24 20:57:55,481 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 20:57:55,481 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 20:57:55,481 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 20:57:55,482 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
__________________________________________________________________________________________________________ test_models_non_mapping_iterable_gracefully_handles_type __________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:55,488 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:57:55,488 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
________________________________________________________________________________________________________ TestAgentCreatorProViews.test_agent_creator_pro_page_context ________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:57:55,897 - swarm.utils.comfyui_client:25 - ComfyUI is disabled. Avatar generation will not be available.
_______________________________________________________________________________________________________________ TestSettingsManager.test_collect_all_settings ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:56,153 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:56,154 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,155 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:56,155 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,155 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:56,155 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
______________________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_api_get ______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,842 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:56,843 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
___________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_api_sensitive_data_filtering ____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:57,064 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,065 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,065 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,065 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,065 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,065 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,065 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,066 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_________________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_dashboard_context _________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,291 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,292 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,292 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,292 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,292 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,292 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
___________________________________________________________________________________________________________ TestSettingsDashboardViews.test_settings_dashboard_get ___________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:57,759 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,759 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,760 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_______________________________________________________________________________________________________ TestSettingsIntegration.test_full_settings_collection_workflow _______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:57,781 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,781 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,781 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,781 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,781 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,781 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,782 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,789 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,789 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,789 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,789 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,789 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,789 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:35 - Found config XDG: /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:83 - Loading config from /home/chatgpt/.config/swarm/swarm_config.json
[INFO] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:87 - Loaded config from /home/chatgpt/.config/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:57:57,790 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
___________________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_no_auth_returns_403 ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:58,054 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:57:58,055 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: AnonymousUser, Authenticated: False
[DEBUG] 2025-08-24 20:57:58,056 - print_debug:171 - User before perform_authentication: AnonymousUser, Auth: None
[DEBUG] 2025-08-24 20:57:58,057 - print_debug:174 - User after perform_authentication: AnonymousUser, Auth: None
[WARNING] 2025-08-24 20:57:58,060 - django.request:241 - Forbidden: /v1/chat/completions
________________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_invalid_token_returns_403 _________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:58,386 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:57:58,387 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: AnonymousUser, Authenticated: False
[DEBUG] 2025-08-24 20:57:58,388 - print_debug:171 - User before perform_authentication: AnonymousUser, Auth: None
[DEBUG] 2025-08-24 20:57:58,388 - print_debug:174 - User after perform_authentication: AnonymousUser, Auth: None
[WARNING] 2025-08-24 20:57:58,391 - django.request:241 - Forbidden: /v1/chat/completions
________________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_valid_token_allows_access _________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:58,748 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:57:58,749 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: AnonymousUser, Authenticated: False
[DEBUG] 2025-08-24 20:57:58,751 - print_debug:171 - User before perform_authentication: testuser, Auth: valid_api_key
[DEBUG] 2025-08-24 20:57:58,751 - print_debug:174 - User after perform_authentication: testuser, Auth: valid_api_key
[DEBUG] 2025-08-24 20:57:58,751 - swarm.auth:110 - [Perm][TokenOrSession] Access granted via static token (request.auth is set).
[DEBUG] 2025-08-24 20:57:58,751 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:57:58,751 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:57:58,751 - swarm.views.chat_views:219 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Processing POST request.
[DEBUG] 2025-08-24 20:57:58,751 - print_debug:220 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] User in post: testuser, Auth: valid_api_key
[DEBUG] 2025-08-24 20:57:58,751 - print_debug:230 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:57:58,752 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:57:58,753 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:57:58,753 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 20:57:58,753 - print_debug:233 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Request data validation successful.
[DEBUG] 2025-08-24 20:57:58,753 - print_debug:245 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 20:57:58,754 - print_debug:254 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Getting blueprint instance for 'echocraft' with params: None
[INFO] 2025-08-24 20:57:58,754 - swarm.views.chat_views:88 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Processing non-streaming request for model 'echocraft'.
[DEBUG] 2025-08-24 20:57:58,754 - swarm.views.chat_views:98 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Received final data chunk (messages list).
[INFO] 2025-08-24 20:57:58,754 - swarm.views.chat_views:118 - [ReqID: 14f19e98-1e38-4cfa-a806-423f255b4d5a] Non-streaming request completed in 0.00s.
_______________________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_valid_session_allows_access ________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:59,248 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:57:59,254 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:57:59,255 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:57:59,256 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:57:59,256 - swarm.auth:118 - [Perm][TokenOrSession] Access granted via authenticated session user: testuser
[DEBUG] 2025-08-24 20:57:59,256 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:57:59,256 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:57:59,256 - swarm.views.chat_views:219 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Processing POST request.
[DEBUG] 2025-08-24 20:57:59,256 - print_debug:220 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:57:59,256 - print_debug:230 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'session test'}]}
[DEBUG] 2025-08-24 20:57:59,257 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'session test'}
[DEBUG] 2025-08-24 20:57:59,257 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'session test'}
[DEBUG] 2025-08-24 20:57:59,257 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 20:57:59,257 - print_debug:233 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Request data validation successful.
[DEBUG] 2025-08-24 20:57:59,257 - print_debug:245 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 20:57:59,258 - print_debug:254 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Getting blueprint instance for 'echocraft' with params: None
[INFO] 2025-08-24 20:57:59,258 - swarm.views.chat_views:88 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Processing non-streaming request for model 'echocraft'.
[DEBUG] 2025-08-24 20:57:59,258 - swarm.views.chat_views:98 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Received final data chunk (messages list).
[INFO] 2025-08-24 20:57:59,258 - swarm.views.chat_views:118 - [ReqID: f32b7fea-60dd-4a02-90b7-417f5355b022] Non-streaming request completed in 0.00s.
______________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_echocraft_non_streaming_success_auth_disabled _______________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:57:59,655 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:57:59,657 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:57:59,658 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:57:59,659 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:57:59,659 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:57:59,659 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:57:59,659 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:57:59,659 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:57:59,659 - swarm.views.chat_views:219 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Processing POST request.
[DEBUG] 2025-08-24 20:57:59,659 - print_debug:220 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:57:59,659 - print_debug:230 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'Hello EchoCraft'}]}
[DEBUG] 2025-08-24 20:57:59,660 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Hello EchoCraft'}
[DEBUG] 2025-08-24 20:57:59,660 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Hello EchoCraft'}
[DEBUG] 2025-08-24 20:57:59,660 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 20:57:59,661 - print_debug:233 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Request data validation successful.
[DEBUG] 2025-08-24 20:57:59,661 - print_debug:245 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 20:57:59,661 - print_debug:254 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Getting blueprint instance for 'echocraft' with params: None
[INFO] 2025-08-24 20:57:59,662 - swarm.views.chat_views:88 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Processing non-streaming request for model 'echocraft'.
[DEBUG] 2025-08-24 20:57:59,662 - swarm.views.chat_views:98 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Received final data chunk (messages list).
[INFO] 2025-08-24 20:57:59,662 - swarm.views.chat_views:118 - [ReqID: c1a68e94-6ab6-41b6-9f94-cbebc2bc125d] Non-streaming request completed in 0.00s.
_______________________________________________________________________________________________ TestChatCompletionsAuthAsync.test_chatbot_non_streaming_success_auth_disabled ________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:00,013 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:00,016 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:00,017 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:00,018 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:00,018 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,018 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,018 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:00,018 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:00,018 - swarm.views.chat_views:219 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Processing POST request.
[DEBUG] 2025-08-24 20:58:00,018 - print_debug:220 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,019 - print_debug:230 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Validating request data: {'model': 'chatbot', 'messages': [{'role': 'user', 'content': 'Hi Chatbot'}]}
[DEBUG] 2025-08-24 20:58:00,019 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Hi Chatbot'}
[DEBUG] 2025-08-24 20:58:00,019 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Hi Chatbot'}
[DEBUG] 2025-08-24 20:58:00,019 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: chatbot
[DEBUG] 2025-08-24 20:58:00,020 - print_debug:233 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Request data validation successful.
[DEBUG] 2025-08-24 20:58:00,020 - print_debug:245 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Checking model access for user 'testuser' and model 'chatbot'
[DEBUG] 2025-08-24 20:58:00,021 - print_debug:254 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Getting blueprint instance for 'chatbot' with params: None
[INFO] 2025-08-24 20:58:00,021 - swarm.views.chat_views:88 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Processing non-streaming request for model 'chatbot'.
[DEBUG] 2025-08-24 20:58:00,021 - swarm.views.chat_views:98 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Received final data chunk (messages list).
[INFO] 2025-08-24 20:58:00,021 - swarm.views.chat_views:118 - [ReqID: 6712c2cf-f43e-4272-9788-b76d7936e00f] Non-streaming request completed in 0.00s.
____________________________________________________________________________________________________ TestChatCompletionsAPIFailingAsync.test_echocraft_streaming_success _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:00,378 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:00,381 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:00,382 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,383 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,383 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:00,383 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:00,383 - swarm.views.chat_views:219 - [ReqID: 0e2ef0e8-0178-4d6c-94e7-3131fe5f4e28] Processing POST request.
[DEBUG] 2025-08-24 20:58:00,383 - print_debug:220 - [ReqID: 0e2ef0e8-0178-4d6c-94e7-3131fe5f4e28] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,383 - print_debug:230 - [ReqID: 0e2ef0e8-0178-4d6c-94e7-3131fe5f4e28] Validating request data: {'model': 'echocraft', 'messages': [{'role': 'user', 'content': 'Stream me'}], 'stream': True}
[DEBUG] 2025-08-24 20:58:00,384 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Stream me'}
[DEBUG] 2025-08-24 20:58:00,384 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Stream me'}
[DEBUG] 2025-08-24 20:58:00,384 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: echocraft
[DEBUG] 2025-08-24 20:58:00,384 - print_debug:233 - [ReqID: 0e2ef0e8-0178-4d6c-94e7-3131fe5f4e28] Request data validation successful.
[DEBUG] 2025-08-24 20:58:00,385 - print_debug:245 - [ReqID: 0e2ef0e8-0178-4d6c-94e7-3131fe5f4e28] Checking model access for user 'testuser' and model 'echocraft'
[DEBUG] 2025-08-24 20:58:00,385 - print_debug:254 - [ReqID: 0e2ef0e8-0178-4d6c-94e7-3131fe5f4e28] Getting blueprint instance for 'echocraft' with params: None
_____________________________________________________________________________________________________ TestChatCompletionsAPIFailingAsync.test_chatbot_streaming_success ______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:00,748 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:00,750 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:00,752 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,752 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,752 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:00,752 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:00,753 - swarm.views.chat_views:219 - [ReqID: 07738ead-35aa-412b-b1b7-a400114e8e3a] Processing POST request.
[DEBUG] 2025-08-24 20:58:00,753 - print_debug:220 - [ReqID: 07738ead-35aa-412b-b1b7-a400114e8e3a] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:00,753 - print_debug:230 - [ReqID: 07738ead-35aa-412b-b1b7-a400114e8e3a] Validating request data: {'model': 'chatbot', 'messages': [{'role': 'user', 'content': 'Hi'}], 'stream': True}
[DEBUG] 2025-08-24 20:58:00,753 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Hi'}
[DEBUG] 2025-08-24 20:58:00,753 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Hi'}
[DEBUG] 2025-08-24 20:58:00,753 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: chatbot
[DEBUG] 2025-08-24 20:58:00,754 - print_debug:233 - [ReqID: 07738ead-35aa-412b-b1b7-a400114e8e3a] Request data validation successful.
[DEBUG] 2025-08-24 20:58:00,754 - print_debug:245 - [ReqID: 07738ead-35aa-412b-b1b7-a400114e8e3a] Checking model access for user 'testuser' and model 'chatbot'
[DEBUG] 2025-08-24 20:58:00,755 - print_debug:254 - [ReqID: 07738ead-35aa-412b-b1b7-a400114e8e3a] Getting blueprint instance for 'chatbot' with params: None
________________________________________________________________________________________ TestChatCompletionsAPIFailingAsync.test_blueprint_run_exception_streaming_returns_error_sse _________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:01,163 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:01,168 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:01,169 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,169 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,169 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:01,169 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:01,169 - swarm.views.chat_views:219 - [ReqID: 5867b396-6d59-4b6d-b69c-b0e9bebffe92] Processing POST request.
[DEBUG] 2025-08-24 20:58:01,169 - print_debug:220 - [ReqID: 5867b396-6d59-4b6d-b69c-b0e9bebffe92] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,170 - print_debug:230 - [ReqID: 5867b396-6d59-4b6d-b69c-b0e9bebffe92] Validating request data: {'model': 'error_bp', 'messages': [{'role': 'user', 'content': 'Cause error'}], 'stream': True}
[DEBUG] 2025-08-24 20:58:01,170 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'Cause error'}
[DEBUG] 2025-08-24 20:58:01,170 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'Cause error'}
[DEBUG] 2025-08-24 20:58:01,170 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: error_bp
[DEBUG] 2025-08-24 20:58:01,171 - print_debug:233 - [ReqID: 5867b396-6d59-4b6d-b69c-b0e9bebffe92] Request data validation successful.
[DEBUG] 2025-08-24 20:58:01,171 - print_debug:245 - [ReqID: 5867b396-6d59-4b6d-b69c-b0e9bebffe92] Checking model access for user 'testuser' and model 'error_bp'
[DEBUG] 2025-08-24 20:58:01,172 - print_debug:254 - [ReqID: 5867b396-6d59-4b6d-b69c-b0e9bebffe92] Getting blueprint instance for 'error_bp' with params: None
_____________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_missing_required_field_returns_400[model] ______________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:01,532 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:01,535 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:01,536 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:01,536 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:01,537 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,537 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,537 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:01,537 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:01,537 - swarm.views.chat_views:219 - [ReqID: af4bc404-1cd0-47f8-a0f9-c197ec2feaac] Processing POST request.
[DEBUG] 2025-08-24 20:58:01,537 - print_debug:220 - [ReqID: af4bc404-1cd0-47f8-a0f9-c197ec2feaac] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,537 - print_debug:230 - [ReqID: af4bc404-1cd0-47f8-a0f9-c197ec2feaac] Validating request data: {'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:58:01,538 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:01,538 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[ERROR] 2025-08-24 20:58:01,539 - print_debug:234 - [ReqID: af4bc404-1cd0-47f8-a0f9-c197ec2feaac] Request data validation FAILED: {'model': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 20:58:01,542 - django.request:241 - Bad Request: /v1/chat/completions
____________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_missing_required_field_returns_400[messages] ____________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:01,924 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:01,926 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:01,927 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:01,928 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:01,928 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,928 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,928 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:01,928 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:01,928 - swarm.views.chat_views:219 - [ReqID: 54912b54-2171-46ab-8281-e791df36d885] Processing POST request.
[DEBUG] 2025-08-24 20:58:01,928 - print_debug:220 - [ReqID: 54912b54-2171-46ab-8281-e791df36d885] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:01,929 - print_debug:230 - [ReqID: 54912b54-2171-46ab-8281-e791df36d885] Validating request data: {'model': 'test_model'}
[ERROR] 2025-08-24 20:58:01,929 - print_debug:234 - [ReqID: 54912b54-2171-46ab-8281-e791df36d885] Request data validation FAILED: {'messages': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 20:58:01,932 - django.request:241 - Bad Request: /v1/chat/completions
_________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data0-Ensure this field has at least 1 elements] _________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:02,287 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:02,289 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:02,291 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:02,291 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:02,291 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:02,291 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:02,291 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:02,291 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:02,291 - swarm.views.chat_views:219 - [ReqID: f88daba8-d6e6-4ac0-9149-01500a53f318] Processing POST request.
[DEBUG] 2025-08-24 20:58:02,291 - print_debug:220 - [ReqID: f88daba8-d6e6-4ac0-9149-01500a53f318] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:02,292 - print_debug:230 - [ReqID: f88daba8-d6e6-4ac0-9149-01500a53f318] Validating request data: {'model': 'test', 'messages': []}
[ERROR] 2025-08-24 20:58:02,293 - print_debug:234 - [ReqID: f88daba8-d6e6-4ac0-9149-01500a53f318] Request data validation FAILED: {'messages': {'non_field_errors': [ErrorDetail(string='Ensure this field has at least 1 elements.', code='min_length')]}}
[WARNING] 2025-08-24 20:58:02,296 - django.request:241 - Bad Request: /v1/chat/completions
_________________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data1-Expected a list of items] __________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:02,660 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:02,662 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:02,663 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:02,664 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:02,664 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:02,664 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:02,664 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:02,664 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:02,664 - swarm.views.chat_views:219 - [ReqID: 9b757a90-65be-442f-b0c0-b02888958097] Processing POST request.
[DEBUG] 2025-08-24 20:58:02,664 - print_debug:220 - [ReqID: 9b757a90-65be-442f-b0c0-b02888958097] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:02,664 - print_debug:230 - [ReqID: 9b757a90-65be-442f-b0c0-b02888958097] Validating request data: {'model': 'test', 'messages': 'not a list'}
[ERROR] 2025-08-24 20:58:02,665 - print_debug:234 - [ReqID: 9b757a90-65be-442f-b0c0-b02888958097] Request data validation FAILED: {'messages': {'non_field_errors': [ErrorDetail(string='Expected a list of items but got type "str".', code='not_a_list')]}}
[WARNING] 2025-08-24 20:58:02,668 - django.request:241 - Bad Request: /v1/chat/completions
__________________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data2-This field is required.] __________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:03,036 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:03,039 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:03,040 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:03,041 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:03,042 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,042 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,043 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:03,043 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:03,043 - swarm.views.chat_views:219 - [ReqID: c6f10d71-fdd3-4346-8765-21b8a48397a3] Processing POST request.
[DEBUG] 2025-08-24 20:58:03,043 - print_debug:220 - [ReqID: c6f10d71-fdd3-4346-8765-21b8a48397a3] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,043 - print_debug:230 - [ReqID: c6f10d71-fdd3-4346-8765-21b8a48397a3] Validating request data: {'model': 'test'}
[ERROR] 2025-08-24 20:58:03,044 - print_debug:234 - [ReqID: c6f10d71-fdd3-4346-8765-21b8a48397a3] Request data validation FAILED: {'messages': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 20:58:03,059 - django.request:241 - Bad Request: /v1/chat/completions
__________________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data3-This field is required.] __________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:03,440 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:03,442 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:03,443 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:03,443 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:03,444 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,444 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,444 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:03,444 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:03,444 - swarm.views.chat_views:219 - [ReqID: eded7a77-2643-4d04-b30d-e3416caf47a8] Processing POST request.
[DEBUG] 2025-08-24 20:58:03,445 - print_debug:220 - [ReqID: eded7a77-2643-4d04-b30d-e3416caf47a8] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,445 - print_debug:230 - [ReqID: eded7a77-2643-4d04-b30d-e3416caf47a8] Validating request data: {'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:58:03,446 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:03,446 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[ERROR] 2025-08-24 20:58:03,446 - print_debug:234 - [ReqID: eded7a77-2643-4d04-b30d-e3416caf47a8] Request data validation FAILED: {'model': [ErrorDetail(string='This field is required.', code='required')]}
[WARNING] 2025-08-24 20:58:03,450 - django.request:241 - Bad Request: /v1/chat/completions
______________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data4-invalid" is not a valid choice] _______________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:03,798 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:03,800 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:03,801 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:03,802 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:03,802 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,802 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,802 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:03,802 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:03,802 - swarm.views.chat_views:219 - [ReqID: f2b8d86c-fdde-41da-ac33-eae2835f8f54] Processing POST request.
[DEBUG] 2025-08-24 20:58:03,802 - print_debug:220 - [ReqID: f2b8d86c-fdde-41da-ac33-eae2835f8f54] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:03,802 - print_debug:230 - [ReqID: f2b8d86c-fdde-41da-ac33-eae2835f8f54] Validating request data: {'model': 'test', 'messages': [{'role': 'invalid', 'content': 'test'}]}
[ERROR] 2025-08-24 20:58:03,803 - print_debug:234 - [ReqID: f2b8d86c-fdde-41da-ac33-eae2835f8f54] Request data validation FAILED: {'messages': [{'role': [ErrorDetail(string='"invalid" is not a valid choice.', code='invalid_choice')]}]}
[WARNING] 2025-08-24 20:58:03,806 - django.request:241 - Bad Request: /v1/chat/completions
_____________________________________________________________________ TestChatCompletionsValidationAsync.test_invalid_field_type_or_content_returns_400[invalid_data5-Content must be a string or null.] _____________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:04,156 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:04,158 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:04,159 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:04,159 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:04,159 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,160 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,160 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:04,160 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:04,160 - swarm.views.chat_views:219 - [ReqID: 10f299ad-39b4-4723-be6c-fb36fcb0c2f3] Processing POST request.
[DEBUG] 2025-08-24 20:58:04,160 - print_debug:220 - [ReqID: 10f299ad-39b4-4723-be6c-fb36fcb0c2f3] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,160 - print_debug:230 - [ReqID: 10f299ad-39b4-4723-be6c-fb36fcb0c2f3] Validating request data: {'model': 'test', 'messages': [{'role': 'user', 'content': 123}]}
[DEBUG] 2025-08-24 20:58:04,161 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': '123'}
[DEBUG] 2025-08-24 20:58:04,161 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': '123'}
[ERROR] 2025-08-24 20:58:04,161 - print_debug:234 - [ReqID: 10f299ad-39b4-4723-be6c-fb36fcb0c2f3] Request data validation FAILED: {'messages': [{'content': [ErrorDetail(string='Content must be a string or null.', code='invalid')]}]}
[WARNING] 2025-08-24 20:58:04,164 - django.request:241 - Bad Request: /v1/chat/completions
_____________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_malformed_json_returns_400 _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:04,517 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:04,524 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:04,526 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:04,526 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:04,526 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,527 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,527 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:04,527 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:04,527 - swarm.views.chat_views:219 - [ReqID: 53e08f8a-e4d4-47c4-84d3-3d2830b2b9f1] Processing POST request.
[DEBUG] 2025-08-24 20:58:04,527 - print_debug:220 - [ReqID: 53e08f8a-e4d4-47c4-84d3-3d2830b2b9f1] User in post: testuser, Auth: None
[ERROR] 2025-08-24 20:58:04,527 - swarm.views.chat_views:224 - [ReqID: 53e08f8a-e4d4-47c4-84d3-3d2830b2b9f1] Invalid request body format: JSON parse error - Expecting ',' delimiter: line 1 column 66 (char 65)
[WARNING] 2025-08-24 20:58:04,531 - django.request:241 - Bad Request: /v1/chat/completions
________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_nonexistent_model_permission_denied _________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:04,890 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:04,893 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:04,894 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:04,894 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:04,894 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,895 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,895 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:04,895 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:04,895 - swarm.views.chat_views:219 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] Processing POST request.
[DEBUG] 2025-08-24 20:58:04,895 - print_debug:220 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:04,895 - print_debug:230 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] Validating request data: {'model': 'nonexistent_model', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:58:04,895 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:04,896 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:04,896 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: nonexistent_model
[DEBUG] 2025-08-24 20:58:04,896 - print_debug:233 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] Request data validation successful.
[DEBUG] 2025-08-24 20:58:04,896 - print_debug:245 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] Checking model access for user 'testuser' and model 'nonexistent_model'
[DEBUG] 2025-08-24 20:58:04,897 - print_debug:254 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] Getting blueprint instance for 'nonexistent_model' with params: None
[WARNING] 2025-08-24 20:58:04,897 - swarm.views.chat_views:267 - [ReqID: b8208c52-b67f-43dd-bf79-dc07cb2a231e] User 'testuser' denied access to model 'nonexistent_model'.
[WARNING] 2025-08-24 20:58:04,900 - django.request:241 - Forbidden: /v1/chat/completions
____________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_nonexistent_model_not_found _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:05,241 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:05,244 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:05,245 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:05,245 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:05,245 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,245 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,246 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:05,246 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:05,246 - swarm.views.chat_views:219 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] Processing POST request.
[DEBUG] 2025-08-24 20:58:05,246 - print_debug:220 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,246 - print_debug:230 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] Validating request data: {'model': 'not_found_model', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:58:05,246 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:05,247 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:05,247 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: not_found_model
[DEBUG] 2025-08-24 20:58:05,247 - print_debug:233 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] Request data validation successful.
[DEBUG] 2025-08-24 20:58:05,247 - print_debug:245 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] Checking model access for user 'testuser' and model 'not_found_model'
[DEBUG] 2025-08-24 20:58:05,248 - print_debug:254 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] Getting blueprint instance for 'not_found_model' with params: None
[ERROR] 2025-08-24 20:58:05,248 - swarm.views.chat_views:262 - [ReqID: 8e6cf964-1ad8-4da2-8bdb-354ae4df7695] Blueprint 'not_found_model' not found or failed to initialize (get_blueprint_instance returned None).
[WARNING] 2025-08-24 20:58:05,251 - django.request:241 - Not Found: /v1/chat/completions
__________________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_blueprint_init_error_returns_500 __________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:05,599 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:05,602 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:05,603 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:05,603 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:05,603 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,603 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,603 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:05,603 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:05,603 - swarm.views.chat_views:219 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] Processing POST request.
[DEBUG] 2025-08-24 20:58:05,604 - print_debug:220 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,604 - print_debug:230 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] Validating request data: {'model': 'config_error_bp', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:58:05,604 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:05,604 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:05,604 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: config_error_bp
[DEBUG] 2025-08-24 20:58:05,605 - print_debug:233 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] Request data validation successful.
[DEBUG] 2025-08-24 20:58:05,605 - print_debug:245 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] Checking model access for user 'testuser' and model 'config_error_bp'
[DEBUG] 2025-08-24 20:58:05,606 - print_debug:254 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] Getting blueprint instance for 'config_error_bp' with params: None
[ERROR] 2025-08-24 20:58:05,606 - swarm.views.chat_views:258 - [ReqID: 0f444c88-c8d5-4bc0-a5c7-4f7981e73566] Error getting blueprint instance for 'config_error_bp': Failed to initialize blueprint
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/views/chat_views.py", line 256, in post
    blueprint_instance = await get_blueprint_instance(model_name, params=blueprint_params)
  File "/usr/lib/python3.10/unittest/mock.py", line 2234, in _execute_mock_call
    raise effect
ValueError: Failed to initialize blueprint
[ERROR] 2025-08-24 20:58:05,610 - django.request:241 - Internal Server Error: /v1/chat/completions
_________________________________________________________________________________________ TestChatCompletionsValidationAsync.test_blueprint_run_exception_non_streaming_returns_500 __________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:05,966 - swarm.middleware:37 - [AsyncAuthMiddleware] Attempting async user load...
[DEBUG] 2025-08-24 20:58:05,968 - swarm.middleware:40 - [AsyncAuthMiddleware] User loaded via SimpleLazyObject: testuser, Authenticated: True
[DEBUG] 2025-08-24 20:58:05,970 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:05,970 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[DEBUG] 2025-08-24 20:58:05,970 - print_debug:171 - User before perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,970 - print_debug:174 - User after perform_authentication: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,970 - print_debug:188 - Permissions check passed.
[DEBUG] 2025-08-24 20:58:05,970 - print_debug:190 - Throttles check passed.
[INFO] 2025-08-24 20:58:05,970 - swarm.views.chat_views:219 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Processing POST request.
[DEBUG] 2025-08-24 20:58:05,970 - print_debug:220 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] User in post: testuser, Auth: None
[DEBUG] 2025-08-24 20:58:05,971 - print_debug:230 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Validating request data: {'model': 'runtime_error_bp', 'messages': [{'role': 'user', 'content': 'test'}]}
[DEBUG] 2025-08-24 20:58:05,971 - print_debug:20 - MessageSerializer.validate received data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:05,971 - print_debug:43 - MessageSerializer.validate PASSED for data: {'role': 'user', 'content': 'test'}
[DEBUG] 2025-08-24 20:58:05,971 - swarm.serializers:55 - Top-level validate checking model type. Got: <class 'str'>, value: runtime_error_bp
[DEBUG] 2025-08-24 20:58:05,972 - print_debug:233 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Request data validation successful.
[DEBUG] 2025-08-24 20:58:05,972 - print_debug:245 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Checking model access for user 'testuser' and model 'runtime_error_bp'
[DEBUG] 2025-08-24 20:58:05,973 - print_debug:254 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Getting blueprint instance for 'runtime_error_bp' with params: None
[INFO] 2025-08-24 20:58:05,973 - swarm.views.chat_views:88 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Processing non-streaming request for model 'runtime_error_bp'.
[ERROR] 2025-08-24 20:58:05,973 - swarm.views.chat_views:121 - [ReqID: d0d27d1f-64d6-4136-bcd2-ed6026520844] Unexpected error during non-streaming blueprint execution: Blueprint execution failed
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/views/chat_views.py", line 93, in _handle_non_streaming
    async for chunk in async_generator:
  File "/mnt/models/open-swarm-mcp/tests/api/test_chat_completions_validation_async.py", line 152, in failing_run
    raise RuntimeError("Blueprint execution failed")
RuntimeError: Blueprint execution failed
[ERROR] 2025-08-24 20:58:05,976 - django.request:241 - Internal Server Error: /v1/chat/completions
_________________________________________________________________________________________________________ test_models_and_blueprints_endpoints_include_dynamic_team __________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
# Last swarm update: 2025-08-24T20:58:06Z (UTC)
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:06,068 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:06,069 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
[INFO] 2025-08-24 20:58:06,069 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[INFO] 2025-08-24 20:58:06,069 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 20:58:06,070 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 20:58:06,070 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 20:58:06,070 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 20:58:06,070 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 20:58:06,070 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,070 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,074 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 20:58:06,074 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,074 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 20:58:06,074 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 20:58:06,079 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 20:58:06,080 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 20:58:06,081 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 20:58:06,082 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 20:58:06,083 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 20:58:06,083 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 20:58:06,083 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 20:58:06,083 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 20:58:06,092 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 20:58:06,093 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
[DEBUG] 2025-08-24 20:58:06,098 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 20:58:06,098 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 20:58:06,098 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 20:58:06,098 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 20:58:06,098 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 20:58:06,098 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 20:58:06,099 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 20:58:06,099 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 20:58:06,099 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 20:58:06,099 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 20:58:06,099 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 20:58:06,100 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
[DEBUG] 2025-08-24 20:58:06,104 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 20:58:06,104 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 20:58:06,104 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 20:58:06,104 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 20:58:06,105 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 20:58:06,106 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 20:58:06,107 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 20:58:06,107 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 20:58:06,107 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 20:58:06,107 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 20:58:06,107 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 20:58:06,107 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 20:58:06,111 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 20:58:06,111 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 20:58:06,111 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 20:58:06,111 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 20:58:06,111 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T20:58:06Z (UTC)
[DEBUG] 2025-08-24 20:58:06,111 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 20:58:06,112 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 20:58:06,112 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 20:58:06,112 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo', 'demo-api-team']
[DEBUG] 2025-08-24 20:58:06,113 - swarm.auth:40 - [Auth][StaticToken] Attempting static token authentication.
[ERROR] 2025-08-24 20:58:06,113 - swarm.auth:46 - [Auth][StaticToken] SWARM_API_KEY is not set in Django settings. Cannot use static token auth.
______________________________________________________________________________________________________________ test_reset_clears_dynamic_registry_and_discovery ______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
# Last swarm update: 2025-08-24T20:58:06Z (UTC)
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:06,312 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[INFO] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,312 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,316 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 20:58:06,318 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,319 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 20:58:06,319 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 20:58:06,323 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 20:58:06,324 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 20:58:06,324 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 20:58:06,324 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 20:58:06,324 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 20:58:06,324 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 20:58:06,324 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 20:58:06,325 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 20:58:06,326 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 20:58:06,327 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 20:58:06,336 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 20:58:06,336 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 20:58:06,337 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 20:58:06,338 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 20:58:06,338 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 20:58:06,338 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 20:58:06,338 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 20:58:06,338 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
[DEBUG] 2025-08-24 20:58:06,343 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 20:58:06,343 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 20:58:06,343 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 20:58:06,343 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 20:58:06,343 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 20:58:06,344 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 20:58:06,344 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 20:58:06,344 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 20:58:06,345 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 20:58:06,346 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 20:58:06,346 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 20:58:06,346 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 20:58:06,346 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 20:58:06,350 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 20:58:06,351 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 20:58:06,351 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 20:58:06,351 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 20:58:06,351 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 20:58:06,351 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 20:58:06,352 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 20:58:06,353 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 20:58:06,353 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 20:58:06,353 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 20:58:06,353 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 20:58:06,357 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 20:58:06,357 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 20:58:06,357 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 20:58:06,357 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 20:58:06,357 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T20:58:06Z (UTC)
[DEBUG] 2025-08-24 20:58:06,358 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 20:58:06,358 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 20:58:06,358 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 20:58:06,358 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
_____________________________________________________________________________________________________________ test_dynamic_team_registry_and_discovery_roundtrip _____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
# Last swarm update: 2025-08-24T20:58:06Z (UTC)
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:06,447 - swarm.views.utils:99 - Discovering blueprint classes (sync)...
[INFO] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:61 - Starting blueprint discovery in directory: /mnt/models/open-swarm-mcp/src/swarm/blueprints
[DEBUG] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chucks_angels' in directory: chucks_angels
[DEBUG] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chucks_angels.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chucks_angels
[DEBUG] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chucks_angels.blueprint_chucks_angels
[DEBUG] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChucksAngelsBlueprint' in module 'swarm.blueprints.chucks_angels.blueprint_chucks_angels'
[DEBUG] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whiskeytango_foxtrot' in directory: whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,447 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whiskeytango_foxtrot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,451 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[WARNING] 2025-08-24 20:58:06,452 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot
[DEBUG] 2025-08-24 20:58:06,452 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'nebula_shellz' in directory: nebula_shellz
[DEBUG] 2025-08-24 20:58:06,452 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_nebula_shellz.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/nebula_shellz
[DEBUG] 2025-08-24 20:58:06,456 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.nebula_shellz.blueprint_nebula_shellz
[DEBUG] 2025-08-24 20:58:06,456 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'NebuchaShellzzarBlueprint' in module 'swarm.blueprints.nebula_shellz.blueprint_nebula_shellz'
[DEBUG] 2025-08-24 20:58:06,456 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'family_ties' in directory: family_ties
[DEBUG] 2025-08-24 20:58:06,456 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_family_ties.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/family_ties
[DEBUG] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.family_ties.blueprint_family_ties
[WARNING] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.family_ties.blueprint_family_ties
[DEBUG] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'common' in directory: common
[WARNING] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:90 - Skipping directory 'common': No suitable main Python file ('common.py' or 'blueprint_common.py') found.
[DEBUG] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'whinge_surf' in directory: whinge_surf
[DEBUG] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_whinge_surf.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/whinge_surf
[DEBUG] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.whinge_surf.blueprint_whinge_surf
[DEBUG] 2025-08-24 20:58:06,457 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'WhingeSurfBlueprint' in module 'swarm.blueprints.whinge_surf.blueprint_whinge_surf'
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'WhingeSurfBlueprint'.
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dynamic_team' in directory: dynamic_team
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_dynamic_team.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/dynamic_team
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.dynamic_team.blueprint_dynamic_team
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DynamicTeamBlueprint' in module 'swarm.blueprints.dynamic_team.blueprint_dynamic_team'
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'rue_code' in directory: rue_code
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_rue_code.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/rue_code
[DEBUG] 2025-08-24 20:58:06,458 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.rue_code.blueprint_rue_code
[DEBUG] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'RueCodeBlueprint' in module 'swarm.blueprints.rue_code.blueprint_rue_code'
[DEBUG] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'messenger' in directory: messenger
[WARNING] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:90 - Skipping directory 'messenger': No suitable main Python file ('messenger.py' or 'blueprint_messenger.py') found.
[DEBUG] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'unapologetic_poets' in directory: unapologetic_poets
[WARNING] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:90 - Skipping directory 'unapologetic_poets': No suitable main Python file ('unapologetic_poets.py' or 'blueprint_unapologetic_poets.py') found.
[DEBUG] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'omniplex' in directory: omniplex
[DEBUG] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_omniplex.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/omniplex
[DEBUG] 2025-08-24 20:58:06,459 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.omniplex.blueprint_omniplex
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'OmniplexBlueprint' in module 'swarm.blueprints.omniplex.blueprint_omniplex'
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gawd' in directory: gawd
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_gawd.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/gawd
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.gawd.blueprint_gawd
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GAWDBlueprint' in module 'swarm.blueprints.gawd.blueprint_gawd'
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GAWDBlueprint'.
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'codey' in directory: codey
[DEBUG] 2025-08-24 20:58:06,460 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_codey.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/codey
[DEBUG] 2025-08-24 20:58:06,462 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.codey.blueprint_codey
[DEBUG] 2025-08-24 20:58:06,462 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'CodeyBlueprint' in module 'swarm.blueprints.codey.blueprint_codey'
[DEBUG] 2025-08-24 20:58:06,462 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'chatbot' in directory: chatbot
[DEBUG] 2025-08-24 20:58:06,463 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_chatbot.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/chatbot
[DEBUG] 2025-08-24 20:58:06,471 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.chatbot.blueprint_chatbot
[DEBUG] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ChatbotBlueprint' in module 'swarm.blueprints.chatbot.blueprint_chatbot'
[DEBUG] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'zeus' in directory: zeus
[DEBUG] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_zeus.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/zeus
[DEBUG] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.zeus.blueprint_zeus
[DEBUG] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'ZeusBlueprint' in module 'swarm.blueprints.zeus.blueprint_zeus'
[DEBUG] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'ZeusBlueprint'.
[WARNING] 2025-08-24 20:58:06,472 - swarm.core.blueprint_discovery:133 - Multiple BlueprintBase subclasses found in blueprint_zeus.py. Using the first one found: 'zeus'. Previously found: 'ZeusCoordinatorBlueprint'.
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'poets' in directory: poets
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_poets.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/poets
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.poets.blueprint_poets
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'PoetsBlueprint' in module 'swarm.blueprints.poets.blueprint_poets'
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'PoetsBlueprint'.
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'suggestion' in directory: suggestion
[DEBUG] 2025-08-24 20:58:06,473 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_suggestion.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/suggestion
[DEBUG] 2025-08-24 20:58:06,478 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.suggestion.blueprint_suggestion
[DEBUG] 2025-08-24 20:58:06,478 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'SuggestionBlueprint' in module 'swarm.blueprints.suggestion.blueprint_suggestion'
[DEBUG] 2025-08-24 20:58:06,479 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'dilbot' in directory: dilbot
[WARNING] 2025-08-24 20:58:06,479 - swarm.core.blueprint_discovery:90 - Skipping directory 'dilbot': No suitable main Python file ('dilbot.py' or 'blueprint_dilbot.py') found.
[DEBUG] 2025-08-24 20:58:06,479 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mission_improbable' in directory: mission_improbable
[DEBUG] 2025-08-24 20:58:06,479 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mission_improbable.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mission_improbable
[DEBUG] 2025-08-24 20:58:06,479 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mission_improbable.blueprint_mission_improbable
[DEBUG] 2025-08-24 20:58:06,479 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MissionImprobableBlueprint' in module 'swarm.blueprints.mission_improbable.blueprint_mission_improbable'
[DEBUG] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'flock' in directory: flock
[DEBUG] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_flock.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/flock
[DEBUG] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.flock.blueprint_flock
[WARNING] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.flock.blueprint_flock
[DEBUG] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'stewie' in directory: stewie
[WARNING] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:90 - Skipping directory 'stewie': No suitable main Python file ('stewie.py' or 'blueprint_stewie.py') found.
[DEBUG] 2025-08-24 20:58:06,480 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'geese' in directory: geese
[DEBUG] 2025-08-24 20:58:06,481 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_geese.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/geese
[DEBUG] 2025-08-24 20:58:06,481 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.geese.blueprint_geese
[DEBUG] 2025-08-24 20:58:06,481 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'GeeseBlueprint' in module 'swarm.blueprints.geese.blueprint_geese'
[DEBUG] 2025-08-24 20:58:06,481 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'GeeseBlueprint'.
[DEBUG] 2025-08-24 20:58:06,481 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'django_chat' in directory: django_chat
[DEBUG] 2025-08-24 20:58:06,481 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_django_chat.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/django_chat
[DEBUG] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.django_chat.blueprint_django_chat
[DEBUG] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'DjangoChatBlueprint' in module 'swarm.blueprints.django_chat.blueprint_django_chat'
[WARNING] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:143 - Blueprint class 'DjangoChatBlueprint' has a 'metadata' attribute that is not a dict. Type: <class 'property'>. Skipping metadata extraction for this field.
[DEBUG] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'DjangoChatBlueprint'.
[DEBUG] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'digitalbutlers' in directory: digitalbutlers
[DEBUG] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_digitalbutlers.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/digitalbutlers
[DEBUG] 2025-08-24 20:58:06,485 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[WARNING] 2025-08-24 20:58:06,486 - swarm.core.blueprint_discovery:172 - No BlueprintBase subclass found directly defined in module: swarm.blueprints.digitalbutlers.blueprint_digitalbutlers
[DEBUG] 2025-08-24 20:58:06,486 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'echocraft' in directory: echocraft
[DEBUG] 2025-08-24 20:58:06,486 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_echocraft.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/echocraft
[DEBUG] 2025-08-24 20:58:06,486 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.echocraft.blueprint_echocraft
[DEBUG] 2025-08-24 20:58:06,486 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'EchoCraftBlueprint' in module 'swarm.blueprints.echocraft.blueprint_echocraft'
[DEBUG] 2025-08-24 20:58:06,486 - swarm.core.blueprint_discovery:153 - Using class docstring for description of 'EchoCraftBlueprint'.
[DEBUG] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'hello_world' in directory: hello_world
[WARNING] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:90 - Skipping directory 'hello_world': No suitable main Python file ('hello_world.py' or 'blueprint_hello_world.py') found.
[DEBUG] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'llm_test_judge' in directory: llm_test_judge
[WARNING] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:90 - Skipping directory 'llm_test_judge': No suitable main Python file ('llm_test_judge.py' or 'blueprint_llm_test_judge.py') found.
[DEBUG] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'jeeves' in directory: jeeves
[DEBUG] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_jeeves.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/jeeves
[DEBUG] 2025-08-24 20:58:06,487 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.jeeves.blueprint_jeeves
[DEBUG] 2025-08-24 20:58:06,488 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'JeevesBlueprint' in module 'swarm.blueprints.jeeves.blueprint_jeeves'
[DEBUG] 2025-08-24 20:58:06,488 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'gaggle' in directory: gaggle
[WARNING] 2025-08-24 20:58:06,488 - swarm.core.blueprint_discovery:90 - Skipping directory 'gaggle': No suitable main Python file ('gaggle.py' or 'blueprint_gaggle.py') found.
[DEBUG] 2025-08-24 20:58:06,488 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'monkai_magic' in directory: monkai_magic
[DEBUG] 2025-08-24 20:58:06,488 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_monkai_magic.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/monkai_magic
[DEBUG] 2025-08-24 20:58:06,492 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.monkai_magic.blueprint_monkai_magic
[DEBUG] 2025-08-24 20:58:06,492 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MonkaiMagicBlueprint' in module 'swarm.blueprints.monkai_magic.blueprint_monkai_magic'
[DEBUG] 2025-08-24 20:58:06,492 - swarm.core.blueprint_discovery:75 - Processing potential blueprint 'mcp_demo' in directory: mcp_demo
[DEBUG] 2025-08-24 20:58:06,492 - swarm.core.blueprint_discovery:94 - Found blueprint file: blueprint_mcp_demo.py in /mnt/models/open-swarm-mcp/src/swarm/blueprints/mcp_demo
[INFO] 2025-08-24 20:58:06,493 - swarm.blueprints.mcp_demo.blueprint_mcp_demo:47 - Last swarm update: 2025-08-24T20:58:06Z (UTC)
[DEBUG] 2025-08-24 20:58:06,493 - swarm.core.blueprint_discovery:123 - Successfully loaded module: swarm.blueprints.mcp_demo.blueprint_mcp_demo
[DEBUG] 2025-08-24 20:58:06,493 - swarm.core.blueprint_discovery:138 - Found Blueprint class 'MCPDemoBlueprint' in module 'swarm.blueprints.mcp_demo.blueprint_mcp_demo'
[INFO] 2025-08-24 20:58:06,493 - swarm.core.blueprint_discovery:182 - Blueprint discovery complete. Found 19 blueprints: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo']
[INFO] 2025-08-24 20:58:06,493 - swarm.views.utils:114 - Found blueprint classes: ['chucks_angels', 'nebula_shellz', 'whinge_surf', 'dynamic_team', 'rue_code', 'omniplex', 'gawd', 'codey', 'chatbot', 'zeus', 'poets', 'suggestion', 'mission_improbable', 'geese', 'django_chat', 'echocraft', 'jeeves', 'monkai_magic', 'mcp_demo', 'demo-team']
____________________________________________________________________________________________________________________________ test_zeus_run_method ____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:06,650 - swarm.blueprints.zeus.blueprint_zeus:79 - ZeusCoordinatorBlueprint run method called.
________________________________________________________________________________________________________________________ test_echocraft_blueprint_run ________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:06,663 - swarm.blueprints.echocraft.blueprint_echocraft:247 - EchoCraftBlueprint run called with 1 messages.
[DEBUG] 2025-08-24 20:58:06,664 - swarm.blueprints.echocraft.blueprint_echocraft:257 - Found last user message: Hello
[INFO] 2025-08-24 20:58:06,664 - swarm.blueprints.echocraft.blueprint_echocraft:261 - EchoCraftBlueprint yielding: Echo: Hello
[DEBUG] 2025-08-24 20:58:06,664 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_echo_run
[DEBUG] 2025-08-24 20:58:06,664 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {}
[DEBUG] 2025-08-24 20:58:06,664 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: default
[DEBUG] 2025-08-24 20:58:06,664 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[INFO] 2025-08-24 20:58:06,664 - swarm.blueprints.echocraft.blueprint_echocraft:286 - EchoCraftBlueprint run finished.
__________________________________________________________________________________________________________________ test_echocraft_blueprint_no_user_message __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:06,676 - swarm.blueprints.echocraft.blueprint_echocraft:247 - EchoCraftBlueprint run called with 1 messages.
[INFO] 2025-08-24 20:58:06,676 - swarm.blueprints.echocraft.blueprint_echocraft:261 - EchoCraftBlueprint yielding: Echo: No user message found.
[DEBUG] 2025-08-24 20:58:06,676 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_echo_nouser
[DEBUG] 2025-08-24 20:58:06,676 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {}
[DEBUG] 2025-08-24 20:58:06,676 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: default
[DEBUG] 2025-08-24 20:58:06,676 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[INFO] 2025-08-24 20:58:06,676 - swarm.blueprints.echocraft.blueprint_echocraft:286 - EchoCraftBlueprint run finished.
_________________________________________________________________________________________________________________ test_echocraft_blueprint_multiple_messages _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:06,684 - swarm.blueprints.echocraft.blueprint_echocraft:247 - EchoCraftBlueprint run called with 3 messages.
[DEBUG] 2025-08-24 20:58:06,684 - swarm.blueprints.echocraft.blueprint_echocraft:257 - Found last user message: Second
[INFO] 2025-08-24 20:58:06,684 - swarm.blueprints.echocraft.blueprint_echocraft:261 - EchoCraftBlueprint yielding: Echo: Second
[DEBUG] 2025-08-24 20:58:06,685 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_echo_multi
[DEBUG] 2025-08-24 20:58:06,685 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {}
[DEBUG] 2025-08-24 20:58:06,685 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: default
[DEBUG] 2025-08-24 20:58:06,685 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[INFO] 2025-08-24 20:58:06,685 - swarm.blueprints.echocraft.blueprint_echocraft:286 - EchoCraftBlueprint run finished.
_________________________________________________________________________________________________________________________ test_stewie_agent_creation _________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------------------------------------------------------------------
[STEWIE DEBUG] Loaded config from: /mnt/models/open-swarm-mcp/swarm_config.json
{'blueprints': {'defaults': {'default_markdown_cli': True,
                             'max_llm_calls': 10}},
 'llm': {},
 'mcpServers': {},
 'profiles': {'default': {'llm': 'gpt-4', 'temperature': 0.7}}}
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:06,948 - swarm.blueprints.stewie.blueprint_family_ties:156 - Creating Stewie agent team...
[DEBUG] 2025-08-24 20:58:06,948 - swarm.blueprints.stewie.blueprint_family_ties:161 - Using LLM profile 'default' for Stewie agent.
[DEBUG] 2025-08-24 20:58:06,949 - swarm.blueprints.stewie.blueprint_family_ties:121 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:06,949 - swarm.blueprints.stewie.blueprint_family_ties:125 - [STEWIE DEBUG] llm config keys: ['default']
[DEBUG] 2025-08-24 20:58:07,001 - swarm.blueprints.stewie.blueprint_family_ties:147 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for 'default'.
[WARNING] 2025-08-24 20:58:07,001 - swarm.blueprints.stewie.blueprint_family_ties:173 - Required MCP server 'server-wp-mcp' not found or failed to start.
[DEBUG] 2025-08-24 20:58:07,004 - swarm.blueprints.stewie.blueprint_family_ties:211 - Agents created: Stewie (main), PeterGrifton, BrianGrifton (helpers as tools).
_________________________________________________________________________________________________________________________ test_story_generation_flow _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:07,038 - swarm:54 - GeeseBlueprint run called with prompt: Tell a story
-------------------------------------------------------------------------------------------------------------------------- Captured stderr teardown --------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 20:58:07,039 - asyncio:1758 - Task was destroyed but it is pending!
task: <Task pending name='Task-79' coro=<<async_generator_athrow without __name__>()>>
--------------------------------------------------------------------------------------------------------------------------- Captured log teardown ----------------------------------------------------------------------------------------------------------------------------
ERROR    asyncio:base_events.py:1758 Task was destroyed but it is pending!
task: <Task pending name='Task-79' coro=<<async_generator_athrow without __name__>()>>
_________________________________________________________________________________________________________________________ test_jeeves_agent_creation _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:07,060 - swarm.blueprints.jeeves.blueprint_jeeves:274 - Creating Jeeves agent team...
[DEBUG] 2025-08-24 20:58:07,060 - swarm.blueprints.jeeves.blueprint_jeeves:278 - Using LLM profile 'default' for Jeeves agents.
[DEBUG] 2025-08-24 20:58:07,060 - swarm.blueprints.jeeves.blueprint_jeeves:188 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:07,060 - swarm.blueprints.jeeves.blueprint_jeeves:206 - Creating new AsyncOpenAI client for profile 'default' with config: {}
[DEBUG] 2025-08-24 20:58:07,112 - swarm.blueprints.jeeves.blueprint_jeeves:213 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for profile 'default'.
[DEBUG] 2025-08-24 20:58:07,116 - swarm.blueprints.jeeves.blueprint_jeeves:320 - Jeeves team created: Jeeves (Coordinator), Mycroft (Search), Gutenberg (Home).
_________________________________________________________________________________________________________________________ test_jeeves_cli_execution __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
CLI Output for Jeeves test:
[Jeeves CLI] SWARM_TEST_MODE active.
[SPINNER] Polishing the silver
  Jeeves Spinner | Jeeves Spinner 
 Searching for: 'Turn on the lights'          
 Jeeves Search                                
 Searching for: 'Turn on the lights'          
 Generating.                                  
 Generating..                                 
 Generating...                                
 Running...                                   
 Results: 2                                   
 Processed                                    
                                            
  [Generating... Taking longer than expected] 

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Generating.          
 Progress: Spinner 1/5 [Generating.]        

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Generating..         
 Progress: Spinner 2/5 [Generating..]       

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Generating...        
 Progress: Spinner 3/5 [Generating...]      

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights' 
 Jeeves Spinner State: Running...           
 Progress: Spinner 4/5 [Running...]         

  Jeeves Spinner | Jeeves Spinner 
 Spinner progress for: 'Turn on the lights'                        
 Jeeves Spinner State: Generating... Taking longer than expected   
 Progress: Spinner 5/5 [Generating... Taking longer than expected] 

  Jeeves Results | Jeeves Results 
 Jeeves agent response for: 'Turn on the lights' 
 Jeeves agent response for: 'Turn on the lights' 
 Found 2 results.                                
 Processed                                       
 Progress: Processed [Done]                      

Jeeves: Test mode response for: Turn on the lights


________________________________________________________________________________________________________________________ test_mcpdemo_agent_creation _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:08,726 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
[WARNING] 2025-08-24 20:58:08,774 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
[WARNING] 2025-08-24 20:58:08,822 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
[WARNING] 2025-08-24 20:58:08,871 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
__________________________________________________________________________________________________________________________ test_mcpdemo_bad_config ___________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:08,926 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
____________________________________________________________________________________________________________________ test_mcpdemo_filesystem_interaction _____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:08,980 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
______________________________________________________________________________________________________________________ test_mcpdemo_memory_interaction _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:09,032 - src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:343 - Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.blueprints.mcp_demo.blueprint_mcp_demo:blueprint_mcp_demo.py:343 Sage agent created, but missing required MCP server(s): filesystem, memory. Functionality will be limited.
________________________________________________________________________________________________________________________ test_mission_agent_creation _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,049 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:253 - Creating Mission Improbable agent team...
[DEBUG] 2025-08-24 20:58:09,049 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:170 - Loaded config for agent 'JimFlimsy' from SQLite.
[DEBUG] 2025-08-24 20:58:09,049 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:198 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,049 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:231 - Creating new AsyncOpenAI client for 'default': {}
[DEBUG] 2025-08-24 20:58:09,098 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:238 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for 'default'.
[WARNING] 2025-08-24 20:58:09,098 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:173 - No config found for agent 'CinnamonToast' in SQLite. Using defaults.
[WARNING] 2025-08-24 20:58:09,098 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:180 - Using hardcoded default config for agent 'CinnamonToast'.
[DEBUG] 2025-08-24 20:58:09,099 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:196 - Using cached Model instance for profile 'default'.
[WARNING] 2025-08-24 20:58:09,099 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:173 - No config found for agent 'RollinFumble' in SQLite. Using defaults.
[WARNING] 2025-08-24 20:58:09,099 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:180 - Using hardcoded default config for agent 'RollinFumble'.
[DEBUG] 2025-08-24 20:58:09,099 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:196 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,101 - swarm.blueprints.mission_improbable.blueprint_mission_improbable:285 - Mission Improbable agents created. Starting with JimFlimsy.
___________________________________________________________________________________________________________________ test_omniplex_agent_creation_all_types ___________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:09,116 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,117 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 20:58:09,117 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 20:58:09,117 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 20:58:09,117 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 20:58:09,117 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 20:58:09,117 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 20:58:09,117 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 20:58:09,118 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: ['uvx_server'], Other: ['other_server']
[INFO] 2025-08-24 20:58:09,118 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 20:58:09,119 - swarm.blueprints.omniplex.blueprint_omniplex:120 - Creating Rogue for uvx servers: ['uvx_server']
[INFO] 2025-08-24 20:58:09,120 - swarm.blueprints.omniplex.blueprint_omniplex:126 - Creating Sylar for other servers: ['other_server']
[INFO] 2025-08-24 20:58:09,121 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo', 'Rogue', 'Sylar']
___________________________________________________________________________________________________________________ test_omniplex_agent_creation_only_npx ____________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:09,125 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,126 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 20:58:09,126 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 20:58:09,126 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 20:58:09,126 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 20:58:09,126 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 20:58:09,126 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 20:58:09,126 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 20:58:09,128 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: [], Other: []
[INFO] 2025-08-24 20:58:09,128 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 20:58:09,129 - swarm.blueprints.omniplex.blueprint_omniplex:123 - No started uvx servers for Rogue.
[INFO] 2025-08-24 20:58:09,129 - swarm.blueprints.omniplex.blueprint_omniplex:129 - No other started servers for Sylar.
[INFO] 2025-08-24 20:58:09,129 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo']
_____________________________________________________________________________________________________________________ test_omniplex_delegation_to_amazo ______________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:09,133 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,134 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 20:58:09,134 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 20:58:09,134 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 20:58:09,134 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 20:58:09,134 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 20:58:09,134 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 20:58:09,134 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 20:58:09,134 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: ['uvx_server'], Other: ['other_server']
[INFO] 2025-08-24 20:58:09,134 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 20:58:09,135 - swarm.blueprints.omniplex.blueprint_omniplex:120 - Creating Rogue for uvx servers: ['uvx_server']
[INFO] 2025-08-24 20:58:09,136 - swarm.blueprints.omniplex.blueprint_omniplex:126 - Creating Sylar for other servers: ['other_server']
[INFO] 2025-08-24 20:58:09,137 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo', 'Rogue', 'Sylar']
________________________________________________________________________________________________________________________ test_omniplex_cli_execution _________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:09,141 - swarm.blueprints.omniplex.blueprint_omniplex:55 - OmniplexBlueprint 'omniplex_test': self._config is None after super().__init__(). mcp_server_configs will be empty. This is expected if _load_configuration is mocked in tests.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,143 - swarm.blueprints.omniplex.blueprint_omniplex:136 - OmniplexBlueprint run method called.
[DEBUG] 2025-08-24 20:58:09,143 - swarm.blueprints.omniplex.blueprint_omniplex:62 - Dynamically creating agents for OmniplexBlueprint...
[DEBUG] 2025-08-24 20:58:09,143 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: omniplex_test
[DEBUG] 2025-08-24 20:58:09,143 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'openai', 'model': 'gpt-mock-omniplex'}}, 'mcpServers': {'npx_server': {'command': 'npx some-tool', 'type': 'npx'}, 'uvx_server': {'command': 'uvx another-tool', 'type': 'uvx'}, 'other_server': {'command': 'python script.py', 'type': 'other'}}, 'settings': {'default_llm_profile': 'default'}, 'blueprints': {'omniplex_test': {}}}
[DEBUG] 2025-08-24 20:58:09,143 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: omniplex_test
[DEBUG] 2025-08-24 20:58:09,143 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {}
[DEBUG] 2025-08-24 20:58:09,143 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
[DEBUG] 2025-08-24 20:58:09,143 - swarm.blueprints.omniplex.blueprint_omniplex:68 - Using LLM profile 'default' for Omniplex agents.
[DEBUG] 2025-08-24 20:58:09,143 - swarm.blueprints.omniplex.blueprint_omniplex:110 - Categorized MCPs - NPX: ['npx_server'], UVX: ['uvx_server'], Other: ['other_server']
[INFO] 2025-08-24 20:58:09,143 - swarm.blueprints.omniplex.blueprint_omniplex:114 - Creating Amazo for npx servers: ['npx_server']
[INFO] 2025-08-24 20:58:09,144 - swarm.blueprints.omniplex.blueprint_omniplex:120 - Creating Rogue for uvx servers: ['uvx_server']
[INFO] 2025-08-24 20:58:09,146 - swarm.blueprints.omniplex.blueprint_omniplex:126 - Creating Sylar for other servers: ['other_server']
[INFO] 2025-08-24 20:58:09,147 - swarm.blueprints.omniplex.blueprint_omniplex:132 - Omniplex Coordinator created with tools for: ['Amazo', 'Rogue', 'Sylar']
________________________________________________________________________________________________________________________ test_poets_db_initialization ________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,149 - swarm:82 - Initializing SQLite database at: /tmp/pytest-of-chatgpt/pytest-12/test_poets_db_initialization0/test_swarm_instructions.db for PoetsBlueprint 'poets-society'
[DEBUG] 2025-08-24 20:58:09,162 - swarm:117 - Table 'agent_instructions' ensured in /tmp/pytest-of-chatgpt/pytest-12/test_poets_db_initialization0/test_swarm_instructions.db
[INFO] 2025-08-24 20:58:09,168 - swarm:158 - Default poet instructions inserted/verified in /tmp/pytest-of-chatgpt/pytest-12/test_poets_db_initialization0/test_swarm_instructions.db.
[INFO] 2025-08-24 20:58:09,168 - swarm:94 - PoetsBlueprint 'poets-society' configured. Starting poet: Gritty Buk
_________________________________________________________________________________________________________________________ test_poets_agent_creation __________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,172 - swarm:82 - Initializing SQLite database at: /tmp/pytest-of-chatgpt/pytest-12/test_poets_agent_creation0/test_swarm_instructions.db for PoetsBlueprint 'poets-society'
[DEBUG] 2025-08-24 20:58:09,178 - swarm:117 - Table 'agent_instructions' ensured in /tmp/pytest-of-chatgpt/pytest-12/test_poets_agent_creation0/test_swarm_instructions.db
[INFO] 2025-08-24 20:58:09,182 - swarm:158 - Default poet instructions inserted/verified in /tmp/pytest-of-chatgpt/pytest-12/test_poets_agent_creation0/test_swarm_instructions.db.
[INFO] 2025-08-24 20:58:09,182 - swarm:94 - PoetsBlueprint 'poets-society' configured. Starting poet: Gritty Buk
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,184 - swarm:242 - Creating Poets agent team. Received mcp_servers: [<MagicMock id='265145533546208'>, <MagicMock id='265145548636656'>, <MagicMock id='265145534815568'>]
[DEBUG] 2025-08-24 20:58:09,184 - swarm:173 - Loaded config for agent 'Harlem Lang' from SQLite.
[DEBUG] 2025-08-24 20:58:09,184 - swarm:197 - Creating new Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,184 - swarm:218 - Creating new AsyncOpenAI client for 'default': {base_url: http://localhost:1234}
[DEBUG] 2025-08-24 20:58:09,232 - swarm:224 - Instantiating OpenAIChatCompletionsModel(model='gpt-mock') for 'default'.
[DEBUG] 2025-08-24 20:58:09,232 - swarm:173 - Loaded config for agent 'Verse Neru' from SQLite.
[DEBUG] 2025-08-24 20:58:09,232 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,232 - swarm:173 - Loaded config for agent 'Echo Plath' from SQLite.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:173 - Loaded config for agent 'Haiku Bash' from SQLite.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:173 - Loaded config for agent 'Gritty Buk' from SQLite.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:173 - Loaded config for agent 'Bard Whit' from SQLite.
[DEBUG] 2025-08-24 20:58:09,233 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,234 - swarm:173 - Loaded config for agent 'Raven Poe' from SQLite.
[DEBUG] 2025-08-24 20:58:09,234 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,234 - swarm:173 - Loaded config for agent 'Frosted Woods' from SQLite.
[DEBUG] 2025-08-24 20:58:09,234 - swarm:194 - Using cached Model instance for profile 'default'.
[DEBUG] 2025-08-24 20:58:09,234 - swarm:173 - Loaded config for agent 'Mystic Blake' from SQLite.
[DEBUG] 2025-08-24 20:58:09,234 - swarm:194 - Using cached Model instance for profile 'default'.
______________________________________________________________________________________________________________________________ test_rue_run_box ______________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,259 - swarm.config:80 - Using XDG default configuration path: /home/chatgpt/.config/swarm/config.yaml
[WARNING] 2025-08-24 20:58:09,259 - swarm.config:98 - Default configuration file not found at /home/chatgpt/.config/swarm/config.yaml. Proceeding without base configuration.
[DEBUG] 2025-08-24 20:58:09,259 - swarm.config:102 - Applied base defaults. Keys: []
[DEBUG] 2025-08-24 20:58:09,259 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 20:58:09,259 - swarm.config:142 - Applied final env var substitution.
[INFO] 2025-08-24 20:58:09,259 - swarm.blueprints.rue_code.blueprint_rue_code:217 - RueCodeBlueprint run method called.
[INFO] 2025-08-24 20:58:09,675 - swarm.blueprints.rue_code.blueprint_rue_code:271 - RueCodeBlueprint run finished.
_____________________________________________________________________________________________________________________________ test_rue_run_empty _____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:09,679 - swarm.config:80 - Using XDG default configuration path: /home/chatgpt/.config/swarm/config.yaml
[WARNING] 2025-08-24 20:58:09,679 - swarm.config:98 - Default configuration file not found at /home/chatgpt/.config/swarm/config.yaml. Proceeding without base configuration.
[DEBUG] 2025-08-24 20:58:09,679 - swarm.config:102 - Applied base defaults. Keys: []
[DEBUG] 2025-08-24 20:58:09,679 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 20:58:09,679 - swarm.config:142 - Applied final env var substitution.
[INFO] 2025-08-24 20:58:09,679 - swarm.blueprints.rue_code.blueprint_rue_code:217 - RueCodeBlueprint run method called.
_________________________________________________________________________________________________________________________ test_run_and_check_status __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,689 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
____________________________________________________________________________________________________________________________ test_kill_subprocess ____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,695 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
_________________________________________________________________________________________________________________________ test_tail_and_show_output __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,699 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
__________________________________________________________________________________________________________________________ test_list_and_prune_jobs __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,704 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
____________________________________________________________________________________________________________________ test_resource_usage_and_analyze_self ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,709 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
______________________________________________________________________________________________________________________________ test_self_update ______________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,712 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
___________________________________________________________________________________________________________________________ test_analyze_self_runs ___________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,715 - swarm.services.job:97 - DefaultJobService initialized. Loaded 0 jobs from disk.
__________________________________________________________________________________________________________________________ test_wtf_agent_creation ___________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 20:58:09,718 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:77 - WTFBlueprint __init__: Instance lacks _load_configuration method even after super call. MRO or BlueprintUXImproved.__init__ is likely problematic. Initializing _config manually.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,723 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:92 - Ensuring database schema exists at: /tmp/pytest-of-chatgpt/pytest-12/test_wtf_agent_creation0/test_wtf_services.db
[INFO] 2025-08-24 20:58:09,750 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:99 - Initializing 'services' table in SQLite database.
[INFO] 2025-08-24 20:58:09,763 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:114 - 'services' table created.
[DEBUG] 2025-08-24 20:58:09,763 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:229 - Creating WhiskeyTangoFoxtrot agent team...
[DEBUG] 2025-08-24 20:58:09,763 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:239 - Using LLM profile 'default' for WTF agents. (From BP config: None, from settings: None)
[WARNING] 2025-08-24 20:58:09,767 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['filesystem'] is missing started MCP(s): filesystem
[WARNING] 2025-08-24 20:58:09,767 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['sqlite'] is missing started MCP(s): sqlite
[WARNING] 2025-08-24 20:58:09,767 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['brave-search', 'mcp-npx-fetch'] is missing started MCP(s): mcp-npx-fetch, brave-search
[WARNING] 2025-08-24 20:58:09,768 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['mcp-doc-forge'] is missing started MCP(s): mcp-doc-forge
[WARNING] 2025-08-24 20:58:09,770 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:270 - Agent needing ['sqlite'] is missing started MCP(s): sqlite
[DEBUG] 2025-08-24 20:58:09,774 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:294 - WhiskeyTangoFoxtrot agents created. Starting with Valory.
_________________________________________________________________________________________________________________________ test_wtf_db_initialization _________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------
[ERROR] 2025-08-24 20:58:09,778 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:77 - WTFBlueprint __init__: Instance lacks _load_configuration method even after super call. MRO or BlueprintUXImproved.__init__ is likely problematic. Initializing _config manually.
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:09,778 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:92 - Ensuring database schema exists at: /tmp/pytest-of-chatgpt/pytest-12/test_wtf_db_initialization0/test_wtf_services.db
[INFO] 2025-08-24 20:58:09,779 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:99 - Initializing 'services' table in SQLite database.
[INFO] 2025-08-24 20:58:09,792 - swarm.blueprints.whiskeytango_foxtrot.blueprint_whiskeytango_foxtrot:114 - 'services' table created.
____________________________________________________________________________________________________________________________ test_zeus_run_empty _____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:12,877 - swarm.blueprints.zeus.blueprint_zeus:79 - ZeusCoordinatorBlueprint run method called.
____________________________________________________________________________________________________________ test_swarm_cli_install_executable_creates_executable ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
CLI Output (Test Mode):
Installing blueprint 'test_blueprint' as executable...
  Source: /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_data_for_swarm/blueprints/test_blueprint
  Entry Point: main.py
  Output Executable: /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_bin_test/test_blueprint
Test-mode shim installed at: /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_bin_test/test_blueprint

CLI Output (Prod Mode):
Installing blueprint 'test_blueprint' as executable...
  Source: /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_data_for_swarm/blueprints/test_blueprint
  Entry Point: main.py
  Output Executable: /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_bin_test/test_blueprint
Running PyInstaller: pyinstaller --onefile --name test_blueprint --distpath /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_bin_test --workpath /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_cache_for_swarm/build/test_blueprint --specpath /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_cache_for_swarm/specs /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_data_for_swarm/blueprints/test_blueprint/main.py
PyInstaller output:
PyInstaller finished successfully. Executable at /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_bin_test/test_blueprint
Successfully installed 'test_blueprint' to /tmp/pytest-of-chatgpt/pytest-12/test_swarm_cli_install_executa0/user_bin_test/test_blueprint

______________________________________________________________________________________________________________________ test_execute_list_user_installed ______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:13,198 - swarm.extensions.cli.commands.list_blueprints:83 - Discovering user-installed blueprints from: PosixPath('/tmp/pytest-of-chatgpt/pytest-12/test_execute_list_user_install0/mock_user_blueprints')
________________________________________________________________________________________________________________________ test_execute_list_available _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_TEST: Output for test_execute_list_available:
Listing available blueprints (from package/development source)...
DEBUG_MOCK: mock_is_dir called for /mnt/models/open-swarm-mcp/src/swarm/blueprints
DEBUG_MOCK: mock_is_dir returning False for dev path candidate: /mnt/models/open-swarm-mcp/src/swarm/blueprints
INFO: No available (package/development) blueprint source directory could be determined.
No available blueprints found in package or development source.

---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:13,205 - swarm.extensions.cli.commands.list_blueprints:44 - 'swarm' package spec not found. Cannot determine installed package location.
[DEBUG] 2025-08-24 20:58:13,205 - swarm.extensions.cli.commands.list_blueprints:50 - Falling back to development source tree for blueprints.
[DEBUG] 2025-08-24 20:58:13,205 - swarm.extensions.cli.commands.list_blueprints:61 - Checking development blueprints path: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints')
[DEBUG] 2025-08-24 20:58:13,205 - swarm.extensions.cli.commands.list_blueprints:66 - Development blueprints path /mnt/models/open-swarm-mcp/src/swarm/blueprints not found or not a directory.
[INFO] 2025-08-24 20:58:13,205 - swarm.extensions.cli.commands.list_blueprints:72 - No available (package/development) blueprint source directory could be determined.
_________________________________________________________________________________________________________________ test_execute_no_user_installed_blueprints __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_TEST: Output for test_execute_no_user_installed_blueprints:
Listing user-installed blueprints (source in /tmp/pytest-of-chatgpt/pytest-12/test_execute_no_user_installed0/mock_user_blueprints)...
No user-installed blueprints found in /tmp/pytest-of-chatgpt/pytest-12/test_execute_no_user_installed0/mock_user_blueprints.
Use 'swarm-cli list --available' to see blueprints you can install, then 'swarm-cli install <name_or_path>'.

---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:13,212 - swarm.extensions.cli.commands.list_blueprints:83 - Discovering user-installed blueprints from: PosixPath('/tmp/pytest-of-chatgpt/pytest-12/test_execute_no_user_installed0/mock_user_blueprints')
____________________________________________________________________________________________________________________ test_execute_no_available_blueprints ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_TEST: Output for test_execute_no_available_blueprints:
Listing available blueprints (from package/development source)...
No available blueprints found in package or development source.

---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:13,217 - swarm.extensions.cli.commands.list_blueprints:44 - 'swarm' package spec not found. Cannot determine installed package location.
[DEBUG] 2025-08-24 20:58:13,217 - swarm.extensions.cli.commands.list_blueprints:50 - Falling back to development source tree for blueprints.
[DEBUG] 2025-08-24 20:58:13,217 - swarm.extensions.cli.commands.list_blueprints:61 - Checking development blueprints path: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints')
[INFO] 2025-08-24 20:58:13,218 - swarm.extensions.cli.commands.list_blueprints:75 - Discovering available blueprints from: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints') (from development source tree (/mnt/models/open-swarm-mcp/src/swarm/blueprints))
______________________________________________________________________________________________________________ test_execute_discovery_exception_user_installed _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:13,222 - swarm.extensions.cli.commands.list_blueprints:83 - Discovering user-installed blueprints from: PosixPath('/tmp/pytest-of-chatgpt/pytest-12/test_execute_discovery_excepti0/mock_user_blueprints')
[ERROR] 2025-08-24 20:58:13,222 - swarm.extensions.cli.commands.list_blueprints:153 - Error listing user-installed blueprints.
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 135, in execute
    user_blueprints = list_user_installed_blueprints()
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 88, in list_user_installed_blueprints
    return discover_blueprints(str(user_bp_dir))
  File "/usr/lib/python3.10/unittest/mock.py", line 1114, in __call__
    return self._mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1118, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1173, in _execute_mock_call
    raise effect
Exception: User Discovery Failed!
_________________________________________________________________________________________________________________ test_execute_discovery_exception_available _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:13,228 - swarm.extensions.cli.commands.list_blueprints:44 - 'swarm' package spec not found. Cannot determine installed package location.
[DEBUG] 2025-08-24 20:58:13,228 - swarm.extensions.cli.commands.list_blueprints:50 - Falling back to development source tree for blueprints.
[DEBUG] 2025-08-24 20:58:13,228 - swarm.extensions.cli.commands.list_blueprints:61 - Checking development blueprints path: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints')
[INFO] 2025-08-24 20:58:13,228 - swarm.extensions.cli.commands.list_blueprints:75 - Discovering available blueprints from: PosixPath('/mnt/models/open-swarm-mcp/src/swarm/blueprints') (from development source tree (/mnt/models/open-swarm-mcp/src/swarm/blueprints))
[ERROR] 2025-08-24 20:58:13,228 - swarm.extensions.cli.commands.list_blueprints:131 - Error listing available blueprints.
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 121, in execute
    available_blueprints = list_available_blueprints()
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/cli/commands/list_blueprints.py", line 76, in list_available_blueprints
    return discover_blueprints(str(blueprints_source_dir))
  File "/usr/lib/python3.10/unittest/mock.py", line 1114, in __call__
    return self._mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1118, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
  File "/usr/lib/python3.10/unittest/mock.py", line 1173, in _execute_mock_call
    raise effect
Exception: Available Discovery Failed!
___________________________________________________________________________________________________________________ test_blueprint_default_model_override ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,287 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmpb5_9tq20.json
[INFO] 2025-08-24 20:58:14,288 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmpb5_9tq20.json
[DEBUG] 2025-08-24 20:58:14,288 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:58:14,288 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_________________________________________________________________________________________________________________________ test_fallback_logs_warning _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,290 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmpgivy6kfp.json
[INFO] 2025-08-24 20:58:14,291 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmpgivy6kfp.json
[DEBUG] 2025-08-24 20:58:14,291 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:58:14,291 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_______________________________________________________________________________________________________________________ test_default_config_generation _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,293 - swarm.extensions.config.config_loader:79 - Config 'swarm_config.json' not found.
[INFO] 2025-08-24 20:58:14,293 - swarm.extensions.config.config_loader:181 - Creating default configuration file at /tmp/tmp9vptblat/swarm/swarm_config.json
[INFO] 2025-08-24 20:58:14,293 - swarm.extensions.config.config_loader:109 - Saving config to /tmp/tmp9vptblat/swarm/swarm_config.json
[DEBUG] 2025-08-24 20:58:14,294 - swarm.extensions.config.config_loader:114 - Save OK.
[DEBUG] 2025-08-24 20:58:14,294 - swarm.extensions.config.config_loader:184 - Default configuration file created successfully.
[WARNING] 2025-08-24 20:58:14,294 - swarm.extensions.config.config_loader:186 - [hint] Set your API key: export OPENAI_API_KEY=sk-... or save to secrets file: echo 'OPENAI_API_KEY=sk-...' >> ~/.config/swarm/.env
_________________________________________________________________________________________________________________________ test_xdg_config_discovery __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,296 - swarm.extensions.config.config_loader:35 - Found config XDG: /tmp/tmp0fqwscoz/swarm/swarm_config.json
________________________________________________________________________________________________________________________ test_config_fallback_to_cwd _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,299 - swarm.extensions.config.config_loader:76 - Found config cwd: /tmp/tmpod72jpjy/swarm_config.json
___________________________________________________________________________________________________________________ test_load_full_configuration_defaults ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,301 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmpb84wb01r.json
[DEBUG] 2025-08-24 20:58:14,301 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmpb84wb01r.json
[DEBUG] 2025-08-24 20:58:14,301 - swarm.config:102 - Applied base defaults. Keys: ['foo']
[DEBUG] 2025-08-24 20:58:14,301 - swarm.config:107 - Merged base 'llm'.
[DEBUG] 2025-08-24 20:58:14,302 - swarm.config:110 - Merged base 'mcpServers'.
[DEBUG] 2025-08-24 20:58:14,302 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 20:58:14,302 - swarm.config:142 - Applied final env var substitution.
________________________________________________________________________________________________________________ test_load_full_configuration_profile_merging ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,303 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmpuwld8t9s.json
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmpuwld8t9s.json
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:102 - Applied base defaults. Keys: ['foo', 'default_profile']
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:107 - Merged base 'llm'.
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:110 - Merged base 'mcpServers'.
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:116 - Merged BP 'FakeBlueprint' settings. Keys: ['baz']
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:123 - Using profile: 'special'
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:127 - Merged profile 'special'. Keys: ['profile_key']
[DEBUG] 2025-08-24 20:58:14,304 - swarm.config:142 - Applied final env var substitution.
_______________________________________________________________________________________________________________ test_load_full_configuration_env_substitution ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmp44lq7c36.json
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmp44lq7c36.json
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:102 - Applied base defaults. Keys: ['foo']
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:107 - Merged base 'llm'.
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:110 - Merged base 'mcpServers'.
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 20:58:14,306 - swarm.config:142 - Applied final env var substitution.
_________________________________________________________________________________________________________________ test_load_full_configuration_missing_file __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,311 - swarm.config:74 - Using CLI overridden configuration path: /tmp/does_not_exist.json
___________________________________________________________________________________________________________________ test_load_full_configuration_bad_json ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,313 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmp2o4xdlgd.json
_________________________________________________________________________________________________________________ test_load_full_configuration_empty_config __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,315 - swarm.config:77 - Using test/specific default configuration path: /tmp/tmpyr5iwrn2.json
[DEBUG] 2025-08-24 20:58:14,315 - swarm.config:87 - Successfully loaded base configuration from: /tmp/tmpyr5iwrn2.json
[DEBUG] 2025-08-24 20:58:14,315 - swarm.config:102 - Applied base defaults. Keys: []
[DEBUG] 2025-08-24 20:58:14,315 - swarm.config:123 - Using profile: 'default'
[DEBUG] 2025-08-24 20:58:14,315 - swarm.config:142 - Applied final env var substitution.
___________________________________________________________________________________________________________________________ test_load_environment ____________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,317 - swarm.config:30 - Checking for .env file at: /tmp/pytest-of-chatgpt/pytest-12/test_load_environment0/.env
[DEBUG] 2025-08-24 20:58:14,318 - swarm.config:35 - .env file Loaded/Overridden at: /tmp/pytest-of-chatgpt/pytest-12/test_load_environment0/.env
_______________________________________________________________________________________________________________________ test_fallback_to_default_model _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,321 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmp1ak4oinh.json
[INFO] 2025-08-24 20:58:14,321 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmp1ak4oinh.json
[DEBUG] 2025-08-24 20:58:14,321 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:58:14,321 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_______________________________________________________________________________________________________________________ test_mcp_server_config_parsing _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,323 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmpneo7hrjw.json
[INFO] 2025-08-24 20:58:14,324 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmpneo7hrjw.json
[DEBUG] 2025-08-24 20:58:14,324 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:58:14,324 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
_________________________________________________________________________________________________________________ test_mcp_server_add_remove_and_edge_cases __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:14,327 - swarm.extensions.config.config_loader:83 - Loading config from /tmp/tmp41o5pyf9.json
[INFO] 2025-08-24 20:58:14,327 - swarm.extensions.config.config_loader:87 - Loaded config from /tmp/tmp41o5pyf9.json
[DEBUG] 2025-08-24 20:58:14,327 - swarm.extensions.config.config_loader:120 - Validating config structure...
[DEBUG] 2025-08-24 20:58:14,327 - swarm.extensions.config.config_loader:130 - Config basic structure OK.
__________________________________________________________________________________________________________________________ test_swarm_api_basic_run __________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Using managed blueprint: /fake/home/.swarm/blueprints/echocraft/blueprint_echocraft.py
Blueprints to be configured:
 - /fake/home/.swarm/blueprints/echocraft/blueprint_echocraft.py
Launching Django server on port 0.0.0.0:8000
_______________________________________________________________________________________________________________ test_swarm_api_custom_port_and_config_creation _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Using blueprint file: /path/to/my_bp.py
Blueprints to be configured:
 - /path/to/my_bp.py
Default config file created at: /tmp/my_swarm.json
Launching Django server on port 0.0.0.0:9999
_________________________________________________________________________________________________________________________ test_swarm_api_daemon_mode _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Using blueprint file: /bp/direct.py
Blueprints to be configured:
 - /bp/direct.py
Launching Django server on port 0.0.0.0:8000
Running in daemon mode. Process ID: 12345
_____________________________________________________________________________________________________________________ test_swarm_api_blueprint_not_found _____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Warning: Blueprint not found: nonexistent_bp - skipping.
Error: No valid blueprints found.
_________________________________________________________________________________________________________________________________ test_init __________________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
BlueprintBase init test passed
______________________________________________________________________________________________________________________________ test_valid_input ______________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] 2025-08-24 20:58:31,133 - swarm.extensions.cli.selection:37 - User selected blueprint: 'blueprint1'
______________________________________________________________________________________________________________________ test_filter_mixed_valid_invalid _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:31,141 - src.swarm.utils.message_utils:29 - Skipping non-dictionary item in messages list: <class 'str'>
[WARNING] 2025-08-24 20:58:31,141 - src.swarm.utils.message_utils:29 - Skipping non-dictionary item in messages list: <class 'NoneType'>
[WARNING] 2025-08-24 20:58:31,141 - src.swarm.utils.message_utils:26 - Message dictionary missing 'role' key: {'not_a_role': 'value'}
[WARNING] 2025-08-24 20:58:31,141 - src.swarm.utils.message_utils:29 - Skipping non-dictionary item in messages list: <class 'int'>
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:29 Skipping non-dictionary item in messages list: <class 'str'>
WARNING  src.swarm.utils.message_utils:message_utils.py:29 Skipping non-dictionary item in messages list: <class 'NoneType'>
WARNING  src.swarm.utils.message_utils:message_utils.py:26 Message dictionary missing 'role' key: {'not_a_role': 'value'}
WARNING  src.swarm.utils.message_utils:message_utils.py:29 Skipping non-dictionary item in messages list: <class 'int'>
__________________________________________________________________________________________________________________ test_filter_messages_with_non_dict_items __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:31,146 - src.swarm.utils.message_utils:43 - Skipping non-dictionary item in messages list: <class 'str'>
[WARNING] 2025-08-24 20:58:31,146 - src.swarm.utils.message_utils:43 - Skipping non-dictionary item in messages list: <class 'NoneType'>
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:43 Skipping non-dictionary item in messages list: <class 'str'>
WARNING  src.swarm.utils.message_utils:message_utils.py:43 Skipping non-dictionary item in messages list: <class 'NoneType'>
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[simple] ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,152 - 
--- Running Truncation Test [NoAction] (Mode: simple, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,152 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 20:58:31,152 - src.swarm.utils.context_utils:233 - Simple truncation result: 2 messages (1 sys), ~11 tokens.
[INFO] 2025-08-24 20:58:31,152 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,152 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 2 messages (1 sys), ~11 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[pairs] ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,154 - 
--- Running Truncation Test [NoAction] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,154 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 20:58:31,154 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,154 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,154 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[simple] ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,156 - 
--- Running Truncation Test [MsgCountBasic] (Mode: simple, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 20:58:31,156 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,156 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~17 tokens.
[INFO] 2025-08-24 20:58:31,156 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,157 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[pairs] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,159 - 
--- Running Truncation Test [MsgCountBasic] (Mode: pairs, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 2 msgs, 995 tokens.
[DEBUG] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
[DEBUG] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:81 -   [Loop Stop] Msg limit reached.
[INFO] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
[INFO] 2025-08-24 20:58:31,159 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,159 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 2 msgs, 995 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:81   [Loop Stop] Msg limit reached.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[simple] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,161 - 
--- Running Truncation Test [TokenCountBasic] (Mode: simple, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,161 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 20:58:31,161 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~31 tokens.
[INFO] 2025-08-24 20:58:31,162 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,162 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~31 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[pairs] __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,164 - 
--- Running Truncation Test [TokenCountBasic] (Mode: pairs, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,164 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 20:58:31,164 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,164 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,164 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,166 - 
--- Running Truncation Test [PairsBasicAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,166 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,166 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,166 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,166 - --- Test Passed [PairsBasicAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_tight_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,168 - 
--- Running Truncation Test [PairsBasicTight] (Mode: pairs, MaxTk: 75, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,168 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 53 tokens.
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
[DEBUG] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
[INFO] 2025-08-24 20:58:31,169 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,169 - --- Test Passed [PairsBasicTight] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 53 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_pairs_preserves_multi_step_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,171 - 
--- Running Truncation Test [PairsMultiAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 20) ---
[INFO] 2025-08-24 20:58:31,172 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 20:58:31,172 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,172 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 9
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,172 - --- Test Passed [PairsMultiAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 9
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_early_user _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,174 - 
--- Running Truncation Test [PairsMultiCutUser] (Mode: pairs, MaxTk: 170, MaxMsg: 20) ---
[INFO] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 148 tokens.
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,174 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
[INFO] 2025-08-24 20:58:31,175 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,175 - --- Test Passed [PairsMultiCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 148 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_first_pair _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,177 - 
--- Running Truncation Test [PairsMultiCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 20) ---
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
[INFO] 2025-08-24 20:58:31,178 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,178 - --- Test Passed [PairsMultiCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
___________________________________________________________________________________________________________ test_pairs_drops_lone_tool_due_to_separation_or_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,180 - 
--- Running Truncation Test [PairsDropLoneToolLimit] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,180 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,180 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 3)+A(idx 1)
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 20:58:31,181 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - --- Test Passed [PairsDropLoneToolLimit] ---
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531412160. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531400256. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531413760. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531415936. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531904576. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531899840. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531899200. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531409216. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531357184. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531903488. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531902464. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531903360. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531359360. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531899136. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - Stable mock cost NF id=265145531906688. Recalc.
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,181 - 
--- Running Truncation Test [PairsDropLoneToolSep] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 18
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 18
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 17)+A(idx 15)
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 16
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 20:58:31,182 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,182 - --- Test Passed [PairsDropLoneToolSep] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 3)+A(idx 1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 18
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 18
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 17)+A(idx 15)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 16
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
__________________________________________________________________________________________________________________ test_pairs_handles_missing_tool_response __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,184 - 
--- Running Truncation Test [PairsMissingToolResp] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,184 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,184 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 58 tokens.
[DEBUG] 2025-08-24 20:58:31,184 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,184 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,184 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,184 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
[INFO] 2025-08-24 20:58:31,185 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,185 - --- Test Passed [PairsMissingToolResp] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 58 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_interspersed_messages_truncation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,187 - 
--- Running Truncation Test [PairsInterspersed] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
[INFO] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 6
[INFO] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 6
[DEBUG] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,187 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
[INFO] 2025-08-24 20:58:31,188 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,188 - --- Test Passed [PairsInterspersed] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 6
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 6
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
____________________________________________________________________________________________________________ test_pairs_system_message_priority_and_exceeds_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,190 - 
--- Running Truncation Test [PairsSysExceeds] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,190 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 20:58:31,190 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 0 tokens.
[DEBUG] 2025-08-24 20:58:31,190 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
[INFO] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,191 - --- Test Passed [PairsSysExceeds] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,191 - 
--- Running Truncation Test [PairsSysFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,191 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,191 - --- Test Passed [PairsSysFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 0 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
___________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_fits ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,193 - 
--- Running Truncation Test [PairsMultiCallFits] (Mode: pairs, MaxTk: 400, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,193 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,193 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,193 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,194 - --- Test Passed [PairsMultiCallFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_user _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,195 - 
--- Running Truncation Test [PairsMultiCallCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:164 -     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
[DEBUG] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,196 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
[INFO] 2025-08-24 20:58:31,197 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,197 - --- Test Passed [PairsMultiCallCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:164     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_pair _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,199 - 
--- Running Truncation Test [PairsMultiCallCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,199 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
[INFO] 2025-08-24 20:58:31,200 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,200 - --- Test Passed [PairsMultiCallCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
_____________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_fit ______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,202 - 
--- Running Truncation Test [PairsB2BFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,202 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 20:58:31,202 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,202 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,202 - --- Test Passed [PairsB2BFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
___________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_user ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,204 - 
--- Running Truncation Test [PairsB2BCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 4)+A(idx 3)
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 3 already kept.
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
[DEBUG] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,205 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
[INFO] 2025-08-24 20:58:31,206 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,206 - --- Test Passed [PairsB2BCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 4)+A(idx 3)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 3 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_first_pair ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,208 - 
--- Running Truncation Test [PairsB2BCutFirstPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 4.
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 3
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,208 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
[INFO] 2025-08-24 20:58:31,209 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,209 - --- Test Passed [PairsB2BCutFirstPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 4.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________________ test_pairs_empty_input_list _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,212 - 
--- Running Truncation Test [RobustEmpty] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[DEBUG] 2025-08-24 20:58:31,212 - src.swarm.utils.context_utils:239 - Truncate called with empty/invalid list.
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,212 - --- Test Passed [RobustEmpty] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
DEBUG    src.swarm.utils.context_utils:context_utils.py:239 Truncate called with empty/invalid list.
_______________________________________________________________________________________________________________________ test_pairs_only_system_message _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,214 - 
--- Running Truncation Test [RobustSysOnly] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,214 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
[INFO] 2025-08-24 20:58:31,214 - src.swarm.utils.context_utils:71 - No valid non-system msgs.
[INFO] 2025-08-24 20:58:31,214 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,214 - --- Test Passed [RobustSysOnly] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,214 - 
--- Running Truncation Test [RobustSysOnlyExceeds] (Mode: pairs, MaxTk: 10, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,214 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
[WARNING] 2025-08-24 20:58:31,214 - src.swarm.utils.context_utils:70 - System msgs exceed limits.
[WARNING] 2025-08-24 20:58:31,214 - src.swarm.utils.context_utils:270 - Truncation empty list, likely due to system message exceeding limits.
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,214 - --- Test Passed [RobustSysOnlyExceeds] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:71 No valid non-system msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
WARNING  src.swarm.utils.context_utils:context_utils.py:70 System msgs exceed limits.
WARNING  src.swarm.utils.context_utils:context_utils.py:270 Truncation empty list, likely due to system message exceeding limits.
____________________________________________________________________________________________________________________ test_pairs_invalid_messages_mixed_in ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,217 - 
--- Running Truncation Test [RobustInvalidSimple] (Mode: simple, MaxTk: 1000, MaxMsg: 4) ---
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
[WARNING] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:214 - Simple Mode: Filtered 2 invalid msgs.
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~99 tokens.
[WARNING] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,217 - --- Test Passed [RobustInvalidSimple] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,217 - 
--- Running Truncation Test [RobustInvalidPairs] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
[WARNING] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:63 - Filtered 2 invalid msgs.
[INFO] 2025-08-24 20:58:31,217 - src.swarm.utils.context_utils:75 - History fits.
[WARNING] 2025-08-24 20:58:31,218 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,218 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,218 - --- Test Passed [RobustInvalidPairs] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:214 Simple Mode: Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~99 tokens.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:63 Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
____________________________________________________________________________________________________________________ test_pairs_non_serializable_content _____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,220 - 
--- Running Truncation Test [RobustNonSerializable] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,220 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
[WARNING] 2025-08-24 20:58:31,220 - src.swarm.utils.context_utils:35 - Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 20, 57, 54, 901013)}
[INFO] 2025-08-24 20:58:31,220 - src.swarm.utils.context_utils:63 - Filtered 1 invalid msgs.
[INFO] 2025-08-24 20:58:31,220 - src.swarm.utils.context_utils:75 - History fits.
[WARNING] 2025-08-24 20:58:31,220 - src.swarm.utils.context_utils:35 - Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 20, 57, 54, 901013)}
[INFO] 2025-08-24 20:58:31,220 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,220 - --- Test Passed [RobustNonSerializable] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
WARNING  src.swarm.utils.context_utils:context_utils.py:35 Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 20, 57, 54, 901013)}
INFO     src.swarm.utils.context_utils:context_utils.py:63 Filtered 1 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
WARNING  src.swarm.utils.context_utils:context_utils.py:35 Skipping msg failing validity check for role 'user': {'role': 'user', 'content': datetime.datetime(2025, 8, 24, 20, 57, 54, 901013)}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
_________________________________________________________________________________________________________________ test_simple_truncation_fallback_simulation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,222 - 
--- Running Truncation Test [RobustFallback] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,222 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[ERROR] 2025-08-24 20:58:31,223 - src.swarm.utils.context_utils:250 - !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_core_truncate_message_history.py", line 185, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
[WARNING] 2025-08-24 20:58:31,223 - src.swarm.utils.context_utils:252 - Attempting fallback to simple truncation.
[INFO] 2025-08-24 20:58:31,223 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~66 tokens.
[INFO] 2025-08-24 20:58:31,223 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,223 - --- Test Passed [RobustFallback] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
ERROR    src.swarm.utils.context_utils:context_utils.py:250 !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_core_truncate_message_history.py", line 185, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
WARNING  src.swarm.utils.context_utils:context_utils.py:252 Attempting fallback to simple truncation.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~66 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
_______________________________________________________________________________________________________________________ test_update_null_content_list ________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:31,225 - src.swarm.utils.message_utils:86 - Skipping non-dictionary item during null content update: <class 'NoneType'>
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:86 Skipping non-dictionary item during null content update: <class 'NoneType'>
____________________________________________________________________________________________________________ test_update_null_content_empty_list_or_invalid_input ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[WARNING] 2025-08-24 20:58:31,230 - src.swarm.utils.message_utils:91 - update_null_content received unexpected type: <class 'NoneType'>. Returning unchanged.
[WARNING] 2025-08-24 20:58:31,230 - src.swarm.utils.message_utils:91 - update_null_content received unexpected type: <class 'str'>. Returning unchanged.
[WARNING] 2025-08-24 20:58:31,230 - src.swarm.utils.message_utils:91 - update_null_content received unexpected type: <class 'int'>. Returning unchanged.
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
WARNING  src.swarm.utils.message_utils:message_utils.py:91 update_null_content received unexpected type: <class 'NoneType'>. Returning unchanged.
WARNING  src.swarm.utils.message_utils:message_utils.py:91 update_null_content received unexpected type: <class 'str'>. Returning unchanged.
WARNING  src.swarm.utils.message_utils:message_utils.py:91 update_null_content received unexpected type: <class 'int'>. Returning unchanged.
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[simple] ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,235 - 
--- Running Truncation Test [NoAction] (Mode: simple, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,235 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 20:58:31,235 - src.swarm.utils.context_utils:233 - Simple truncation result: 2 messages (1 sys), ~11 tokens.
[INFO] 2025-08-24 20:58:31,235 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,235 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 2 messages (1 sys), ~11 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
___________________________________________________________________________________________________________________ test_truncate_no_action_needed[pairs] ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,237 - 
--- Running Truncation Test [NoAction] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,237 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
[INFO] 2025-08-24 20:58:31,237 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,237 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,237 - --- Test Passed [NoAction] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 2
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[simple] ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,240 - 
--- Running Truncation Test [MsgCountBasic] (Mode: simple, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 20:58:31,240 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,240 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~17 tokens.
[INFO] 2025-08-24 20:58:31,240 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,240 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_truncate_by_message_count_basic[pairs] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,242 - 
--- Running Truncation Test [MsgCountBasic] (Mode: pairs, MaxTk: 1000, MaxMsg: 3) ---
[INFO] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 2 msgs, 995 tokens.
[DEBUG] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
[DEBUG] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:81 -   [Loop Stop] Msg limit reached.
[INFO] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
[INFO] 2025-08-24 20:58:31,242 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,242 - --- Test Passed [MsgCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 3, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 2 msgs, 995 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=6. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=6. Kept: Msgs=1, Tokens=6
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:81   [Loop Stop] Msg limit reached.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~17 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[simple] _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,245 - 
--- Running Truncation Test [TokenCountBasic] (Mode: simple, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,245 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 20:58:31,245 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~31 tokens.
[INFO] 2025-08-24 20:58:31,245 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,245 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~31 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
_________________________________________________________________________________________________________________ test_truncate_by_token_count_basic[pairs] __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,247 - 
--- Running Truncation Test [TokenCountBasic] (Mode: pairs, MaxTk: 40, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,247 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
[INFO] 2025-08-24 20:58:31,247 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,247 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,247 - --- Test Passed [TokenCountBasic] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 40, Max Messages: 10, Input Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,249 - 
--- Running Truncation Test [PairsBasicAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,249 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,249 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,249 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,250 - --- Test Passed [PairsBasicAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_preserves_basic_pair_tight_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,252 - 
--- Running Truncation Test [PairsBasicTight] (Mode: pairs, MaxTk: 75, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 53 tokens.
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
[DEBUG] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,252 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,253 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
[INFO] 2025-08-24 20:58:31,253 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,253 - --- Test Passed [PairsBasicTight] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 75, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 53 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=53) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=53
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 3 msgs (1 sys, 2 non-sys), ~75 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
________________________________________________________________________________________________________________ test_pairs_preserves_multi_step_ample_space _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,255 - 
--- Running Truncation Test [PairsMultiAmple] (Mode: pairs, MaxTk: 1000, MaxMsg: 20) ---
[INFO] 2025-08-24 20:58:31,255 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 20:58:31,255 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,255 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 9
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,255 - --- Test Passed [PairsMultiAmple] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 9
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_early_user _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,257 - 
--- Running Truncation Test [PairsMultiCutUser] (Mode: pairs, MaxTk: 170, MaxMsg: 20) ---
[INFO] 2025-08-24 20:58:31,257 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 20:58:31,257 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 148 tokens.
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
[DEBUG] 2025-08-24 20:58:31,258 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
[DEBUG] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
[INFO] 2025-08-24 20:58:31,259 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,259 - --- Test Passed [PairsMultiCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 170, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 148 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=148) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=4, Tokens=96
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=24. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=57, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=116 + PairTokens=57 <= TargetTokens=148) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=5 + PairMsgs=2 <= TargetMsgs=19) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=5, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 7 msgs (1 sys, 6 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
______________________________________________________________________________________________________________ test_pairs_preserves_multi_step_cuts_first_pair _______________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,261 - 
--- Running Truncation Test [PairsMultiCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 20) ---
[INFO] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
[INFO] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 19 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 7
[INFO] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 7
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t2)
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
[INFO] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 6)+A(idx 5)
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 5 already kept.
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
[DEBUG] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,261 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,262 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
[INFO] 2025-08-24 20:58:31,262 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,262 - --- Test Passed [PairsMultiCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 20, Input Msgs: 9
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 19 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=7, Role=assistant, Tokens=10. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 7
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 7
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=tool, Tokens=27. Kept: Msgs=1, Tokens=10
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 5. Pair cost=64, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=10 + PairTokens=64 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=19) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 6)+A(idx 5)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 5 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=user, Tokens=22. Kept: Msgs=3, Tokens=74
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 4 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~96 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
___________________________________________________________________________________________________________ test_pairs_drops_lone_tool_due_to_separation_or_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,264 - 
--- Running Truncation Test [PairsDropLoneToolLimit] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 3)+A(idx 1)
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 20:58:31,264 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,264 - --- Test Passed [PairsDropLoneToolLimit] ---
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,264 - Stable mock cost NF id=265145533583552. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533582720. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533583424. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533591168. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145531626944. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145531628160. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533299712. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533582848. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533584320. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533586112. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533583104. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533583488. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145533581568. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145531627200. Recalc.
[WARNING] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - Stable mock cost NF id=265145531625792. Recalc.
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,265 - 
--- Running Truncation Test [PairsDropLoneToolSep] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 18
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 18
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 17)+A(idx 15)
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
[DEBUG] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 16
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
[INFO] 2025-08-24 20:58:31,265 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,266 - --- Test Passed [PairsDropLoneToolSep] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 3)+A(idx 1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 20
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=18, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 18
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 18
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=17, Role=tool, Tokens=24. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 15. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=20 + PairTokens=57 <= TargetTokens=78) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 17)+A(idx 15)
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=16, Role=user, Tokens=22. Kept: Msgs=3, Tokens=77
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 16
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 16 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~99 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
__________________________________________________________________________________________________________________ test_pairs_handles_missing_tool_response __________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,268 - 
--- Running Truncation Test [PairsMissingToolResp] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 58 tokens.
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 3
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 3
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 2
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
[DEBUG] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
[INFO] 2025-08-24 20:58:31,268 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,269 - --- Test Passed [PairsMissingToolResp] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 58 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=20. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 3
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=1, Tokens=20
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 2
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=42 + PairTokens=33 <= TargetTokens=58) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=42
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~76 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________ test_pairs_interspersed_messages_truncation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,271 - 
--- Running Truncation Test [PairsInterspersed] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
[INFO] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 6
[INFO] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 6
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_t1)
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
[DEBUG] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 2
[INFO] 2025-08-24 20:58:31,271 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,272 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
[INFO] 2025-08-24 20:58:31,272 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,272 - --- Test Passed [PairsInterspersed] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 8
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=6, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 6
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 6
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=user, Tokens=20. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=20. Kept: Msgs=2, Tokens=39
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=24. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_t1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=57, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=57 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=user, Tokens=22. Kept: Msgs=3, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 2
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 2 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~81 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
____________________________________________________________________________________________________________ test_pairs_system_message_priority_and_exceeds_limit ____________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,274 - 
--- Running Truncation Test [PairsSysExceeds] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 0 tokens.
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:153 -       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:156 -       Did not find all expected tools for this assistant call.
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
[INFO] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,274 - --- Test Passed [PairsSysExceeds] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,274 - 
--- Running Truncation Test [PairsSysFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,274 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
[INFO] 2025-08-24 20:58:31,275 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,275 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,275 - --- Test Passed [PairsSysFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 0 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=33. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 0 tools for 1 calls. Pair Cost=33, Pair Len=1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:156       Did not find all expected tools for this assistant call.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=0 + PairTokens=33 <= TargetTokens=0) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=0 + PairMsgs=1 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 1 msgs (1 sys, 0 non-sys), ~100 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 3
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
___________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_fits ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,277 - 
--- Running Truncation Test [PairsMultiCallFits] (Mode: pairs, MaxTk: 400, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,277 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,277 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,277 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,277 - --- Test Passed [PairsMultiCallFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 400, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_user _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,279 - 
--- Running Truncation Test [PairsMultiCallCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:164 -     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
[DEBUG] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
[INFO] 2025-08-24 20:58:31,280 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,280 - --- Test Passed [PairsMultiCallCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:164     -> Action: KEEPING Pair A(idx 1)+Tools([2, 3])
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=4, Tokens=128
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 5 msgs (1 sys, 4 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
________________________________________________________________________________________________________________ test_pairs_multi_call_in_one_turn_cuts_pair _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,282 - 
--- Running Truncation Test [PairsMultiCallCutPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
[INFO] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 4
[INFO] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 4
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc2)
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 3.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_mc1)
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:114 -       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:153 -       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
[DEBUG] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,283 - src.swarm.utils.context_utils:195 -     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
[INFO] 2025-08-24 20:58:31,284 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
[INFO] 2025-08-24 20:58:31,284 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 2
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,284 - --- Test Passed [PairsMultiCallCutPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 6
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=assistant, Tokens=25. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 4
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 4
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=22. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_mc1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:114       Found assistant pair at 1, but it has multiple tool calls (2). Deferring to Case 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=59. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 2 tools for 2 calls. Pair Cost=103, Pair Len=3.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=25 + PairTokens=103 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=3 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=224. Kept: Msgs=1, Tokens=25
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:195     -> Action: SKIPPING message 0 (Tokens fit: False, Msgs fit: True). Stopping.
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 2 msgs (1 sys, 1 non-sys), ~47 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 2
_____________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_fit ______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,286 - 
--- Running Truncation Test [PairsB2BFits] (Mode: pairs, MaxTk: 200, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,286 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 20:58:31,286 - src.swarm.utils.context_utils:75 - History fits.
[INFO] 2025-08-24 20:58:31,286 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 7
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,286 - --- Test Passed [PairsB2BFits] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 200, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 7
___________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_user ___________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,288 - 
--- Running Truncation Test [PairsB2BCutUser] (Mode: pairs, MaxTk: 150, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 128 tokens.
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
[DEBUG] 2025-08-24 20:58:31,288 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[INFO] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:125 -       Action: KEEPING Pair T(idx 4)+A(idx 3)
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:80 -   [Loop Skip] Idx 3 already kept.
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
[DEBUG] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
[INFO] 2025-08-24 20:58:31,289 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 6
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,289 - --- Test Passed [PairsB2BCutUser] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 150, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 128 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=128) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
INFO     src.swarm.utils.context_utils:context_utils.py:125       Action: KEEPING Pair T(idx 4)+A(idx 3)
DEBUG    src.swarm.utils.context_utils:context_utils.py:80   [Loop Skip] Idx 3 already kept.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=3, Tokens=82
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=82 + PairTokens=55 <= TargetTokens=128) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=3 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 1 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=4, Tokens=116
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 6 msgs (1 sys, 5 non-sys), ~150 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 6
________________________________________________________________________________________________________________ test_pairs_back_to_back_tools_cut_first_pair ________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,291 - 
--- Running Truncation Test [PairsB2BCutFirstPair] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,291 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
[INFO] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:76 - Sophisticated truncation. Target: 9 msgs, 78 tokens.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 5
[INFO] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 5
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_2)
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 4.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 3
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[INFO] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:179 -     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:99 -     -> Case 1: Tool Msg (ID: call_b2b_1)
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:119 -       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:122 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:123 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:131 -         Pair doesn't fit budget.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:135 -     -> Case 1 Result: Pair found but deferred or didn't fit.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 2.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:140 -     -> Case 2: Assistant w/ Tools at index 1
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:153 -       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
[DEBUG] 2025-08-24 20:58:31,292 - src.swarm.utils.context_utils:160 -       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
[DEBUG] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:161 -       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
[DEBUG] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:175 -       Pair doesn't fit or not all tools found.
[DEBUG] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:183 -       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
[DEBUG] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:200 -   [Loop Default Decrement] No action/break for index 1.
[DEBUG] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:88 -   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
[DEBUG] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:187 -     -> Case 3: Regular Message at index 0
[INFO] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:191 -     -> Action: KEEPING SINGLE message 0
[INFO] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:206 - Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
[INFO] 2025-08-24 20:58:31,293 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,293 - --- Test Passed [PairsB2BCutFirstPair] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 7
INFO     src.swarm.utils.context_utils:context_utils.py:76 Sophisticated truncation. Target: 9 msgs, 78 tokens.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=5, Role=assistant, Tokens=19. Kept: Msgs=0, Tokens=0
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 5
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 5
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=4, Role=tool, Tokens=23. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_2)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 3. Pair cost=63, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 4.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=3, Role=assistant, Tokens=40. Kept: Msgs=1, Tokens=19
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 3
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=63, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=19 + PairTokens=63 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=1 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
INFO     src.swarm.utils.context_utils:context_utils.py:179     -> Action: KEEPING SINGLE Assistant 3 (pair failed/incomplete).
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=2, Role=tool, Tokens=21. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:99     -> Case 1: Tool Msg (ID: call_b2b_1)
DEBUG    src.swarm.utils.context_utils:context_utils.py:119       Found single-call assistant pair at 1. Pair cost=55, Pair msgs=2
DEBUG    src.swarm.utils.context_utils:context_utils.py:122       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:123       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:131         Pair doesn't fit budget.
DEBUG    src.swarm.utils.context_utils:context_utils.py:135     -> Case 1 Result: Pair found but deferred or didn't fit.
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=1, Role=assistant, Tokens=34. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:140     -> Case 2: Assistant w/ Tools at index 1
DEBUG    src.swarm.utils.context_utils:context_utils.py:153       Found 1 tools for 1 calls. Pair Cost=55, Pair Len=2.
DEBUG    src.swarm.utils.context_utils:context_utils.py:160       Budget Check: (CurrentTokens=59 + PairTokens=55 <= TargetTokens=78) -> False
DEBUG    src.swarm.utils.context_utils:context_utils.py:161       Budget Check: (CurrentMsgs=2 + PairMsgs=2 <= TargetMsgs=9) -> True
DEBUG    src.swarm.utils.context_utils:context_utils.py:175       Pair doesn't fit or not all tools found.
DEBUG    src.swarm.utils.context_utils:context_utils.py:183       Cannot keep single assistant 1 either (Tokens fit: False, Msgs fit: True).
DEBUG    src.swarm.utils.context_utils:context_utils.py:200   [Loop Default Decrement] No action/break for index 1.
DEBUG    src.swarm.utils.context_utils:context_utils.py:88   [Loop Eval] Idx=0, Role=user, Tokens=12. Kept: Msgs=2, Tokens=59
DEBUG    src.swarm.utils.context_utils:context_utils.py:187     -> Case 3: Regular Message at index 0
INFO     src.swarm.utils.context_utils:context_utils.py:191     -> Action: KEEPING SINGLE message 0
INFO     src.swarm.utils.context_utils:context_utils.py:206 Sophisticated truncation result: 4 msgs (1 sys, 3 non-sys), ~93 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
________________________________________________________________________________________________________________________ test_pairs_empty_input_list _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,295 - 
--- Running Truncation Test [RobustEmpty] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[DEBUG] 2025-08-24 20:58:31,295 - src.swarm.utils.context_utils:239 - Truncate called with empty/invalid list.
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,295 - --- Test Passed [RobustEmpty] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
DEBUG    src.swarm.utils.context_utils:context_utils.py:239 Truncate called with empty/invalid list.
_______________________________________________________________________________________________________________________ test_pairs_only_system_message _______________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,297 - 
--- Running Truncation Test [RobustSysOnly] (Mode: pairs, MaxTk: 100, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,297 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
[INFO] 2025-08-24 20:58:31,297 - src.swarm.utils.context_utils:71 - No valid non-system msgs.
[INFO] 2025-08-24 20:58:31,297 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 1
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,297 - --- Test Passed [RobustSysOnly] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,297 - 
--- Running Truncation Test [RobustSysOnlyExceeds] (Mode: pairs, MaxTk: 10, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,297 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
[WARNING] 2025-08-24 20:58:31,297 - src.swarm.utils.context_utils:70 - System msgs exceed limits.
[WARNING] 2025-08-24 20:58:31,297 - src.swarm.utils.context_utils:270 - Truncation empty list, likely due to system message exceeding limits.
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,297 - --- Test Passed [RobustSysOnlyExceeds] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 100, Max Messages: 10, Input Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:71 No valid non-system msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 1
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 10, Max Messages: 10, Input Msgs: 1
WARNING  src.swarm.utils.context_utils:context_utils.py:70 System msgs exceed limits.
WARNING  src.swarm.utils.context_utils:context_utils.py:270 Truncation empty list, likely due to system message exceeding limits.
____________________________________________________________________________________________________________________ test_pairs_invalid_messages_mixed_in ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,300 - 
--- Running Truncation Test [RobustInvalidSimple] (Mode: simple, MaxTk: 1000, MaxMsg: 4) ---
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
[WARNING] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:214 - Simple Mode: Filtered 2 invalid msgs.
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:233 - Simple truncation result: 4 messages (1 sys), ~99 tokens.
[WARNING] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 4
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,300 - --- Test Passed [RobustInvalidSimple] ---
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,300 - 
--- Running Truncation Test [RobustInvalidPairs] (Mode: pairs, MaxTk: 1000, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
[WARNING] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:63 - Filtered 2 invalid msgs.
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:75 - History fits.
[WARNING] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:24 - Skipping msg missing role: {'content': 'No role here'}
[INFO] 2025-08-24 20:58:31,300 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 5
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,301 - --- Test Passed [RobustInvalidPairs] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Simple (Recent Only), Max Tokens: 1000, Max Messages: 4, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:214 Simple Mode: Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 4 messages (1 sys), ~99 tokens.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 4
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 1000, Max Messages: 10, Input Msgs: 7
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:63 Filtered 2 invalid msgs.
INFO     src.swarm.utils.context_utils:context_utils.py:75 History fits.
WARNING  src.swarm.utils.context_utils:context_utils.py:24 Skipping msg missing role: {'content': 'No role here'}
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 5
_________________________________________________________________________________________________________________ test_simple_truncation_fallback_simulation _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,304 - 
--- Running Truncation Test [RobustFallback] (Mode: pairs, MaxTk: 80, MaxMsg: 10) ---
[INFO] 2025-08-24 20:58:31,304 - src.swarm.utils.context_utils:242 - --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
[ERROR] 2025-08-24 20:58:31,304 - src.swarm.utils.context_utils:250 - !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_truncate_message_history.py", line 197, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
[WARNING] 2025-08-24 20:58:31,304 - src.swarm.utils.context_utils:252 - Attempting fallback to simple truncation.
[INFO] 2025-08-24 20:58:31,304 - src.swarm.utils.context_utils:233 - Simple truncation result: 3 messages (1 sys), ~66 tokens.
[INFO] 2025-08-24 20:58:31,304 - src.swarm.utils.context_utils:275 - --- Finished Truncation --- Result Msgs: 3
[INFO] TEST_TRUNC_CORE - 2025-08-24 20:58:31,304 - --- Test Passed [RobustFallback] ---
----------------------------------------------------------------------------------------------------------------------------- Captured log call ------------------------------------------------------------------------------------------------------------------------------
INFO     src.swarm.utils.context_utils:context_utils.py:242 --- Starting Truncation --- Mode: Sophisticated (Pair-Preserving), Max Tokens: 80, Max Messages: 10, Input Msgs: 5
ERROR    src.swarm.utils.context_utils:context_utils.py:250 !!! Critical error during primary truncation (Sophisticated (Pair-Preserving)): Simulated error in sophisticated truncation
Traceback (most recent call last):
  File "/mnt/models/open-swarm-mcp/src/swarm/utils/context_utils.py", line 245, in truncate_message_history
    if truncation_mode == "pairs": result = _truncate_sophisticated(messages, model, max_tokens, max_messages)
  File "/mnt/models/open-swarm-mcp/tests/test_truncate_message_history.py", line 197, in broken_sophisticated
    def broken_sophisticated(*args, **kwargs): raise ValueError("Simulated error in sophisticated truncation")
ValueError: Simulated error in sophisticated truncation
WARNING  src.swarm.utils.context_utils:context_utils.py:252 Attempting fallback to simple truncation.
INFO     src.swarm.utils.context_utils:context_utils.py:233 Simple truncation result: 3 messages (1 sys), ~66 tokens.
INFO     src.swarm.utils.context_utils:context_utils.py:275 --- Finished Truncation --- Result Msgs: 3
__________________________________________________________________________________________________________ TestBlueprintBaseConfigLoading.test_init_does_not_raise ___________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:31,311 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: test_init
[DEBUG] 2025-08-24 20:58:31,311 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'mock'}}, 'settings': {'default_markdown_output': True, 'default_llm_profile': 'default'}, 'blueprints': {}}
[DEBUG] 2025-08-24 20:58:31,312 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
____________________________________________________________________________________________________ TestBlueprintBaseConfigLoading.test_llm_profile_resolution_priority _____________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'foo': {'provider': 'mock'}}, 'settings': {'default_llm': 'foo'}, 'blueprints': {'bp': {'llm_profile': 'foo'}}}
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:443 - [DEBUG _resolve_llm_profile] Using programmatic override: foo
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: foo
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp2
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'bar': {'provider': 'mock'}}, 'settings': {'default_llm': 'bar'}, 'blueprints': {'bp2': {'llm_profile': 'bar'}}}
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:451 - [DEBUG _resolve_llm_profile] Checking per-blueprint config for: bp2
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:453 - [DEBUG _resolve_llm_profile] bp_cfg: {'llm_profile': 'bar'}
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:455 - [DEBUG _resolve_llm_profile] Using per-blueprint llm_profile: bar
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: bar
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp3
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'baz': {'provider': 'mock'}}, 'settings': {'default_llm': 'baz'}, 'blueprints': {}}
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: baz
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp4
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'env_model': {'provider': 'mock'}}, 'settings': {}, 'blueprints': {}}
[DEBUG] 2025-08-24 20:58:31,317 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: env_model
[DEBUG] 2025-08-24 20:58:31,318 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp5
[DEBUG] 2025-08-24 20:58:31,318 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {'default': {'provider': 'mock'}}, 'settings': {}, 'blueprints': {}}
[DEBUG] 2025-08-24 20:58:31,318 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
_______________________________________________________________________________________________________ TestBlueprintBaseConfigLoading.test_missing_llm_profile_raises _______________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
[DEBUG] 2025-08-24 20:58:31,320 - swarm.core.blueprint_base:439 - [DEBUG _resolve_llm_profile] blueprint_id/name: bp
[DEBUG] 2025-08-24 20:58:31,321 - swarm.core.blueprint_base:440 - [DEBUG _resolve_llm_profile] self._config: {'llm': {}, 'settings': {}, 'blueprints': {}}
[DEBUG] 2025-08-24 20:58:31,321 - swarm.core.blueprint_base:489 - [DEBUG _resolve_llm_profile] Final resolved profile: default
___________________________________________________________________________________________________________________ test_pretty_print_response_plain_text ____________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_PPRINT: Entered pretty_print_response. RICH_AVAILABLE=True, use_markdown=False
DEBUG_PPRINT: _console type: <class 'test_output_utils.test_pretty_print_response_plain_text.<locals>.DummyConsole'>
DEBUG_PPRINT: Processing message 1/1: Assistant
DEBUG_PPRINT: Content for message 1: 'Hello world'
DEBUG_PPRINT: Regex match for message 1: None
DEBUG_PPRINT: Message 1 - Plain text printing.
_________________________________________________________________________________________________________________ test_pretty_print_response_with_code_fence _________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stderr call ----------------------------------------------------------------------------------------------------------------------------
DEBUG_PPRINT: Entered pretty_print_response. RICH_AVAILABLE=True, use_markdown=False
DEBUG_PPRINT: _console type: <class 'test_output_utils.test_pretty_print_response_with_code_fence.<locals>.DummyConsole'>
DEBUG_PPRINT: Processing message 1/1: Assistant
DEBUG_PPRINT: Content for message 1: '```python\nprint("hello")\n```'
DEBUG_PPRINT: Regex match for message 1: <re.Match object; span=(0, 28), match='```python\nprint("hello")\n```'>
DEBUG_PPRINT: Message 1 - Code block matched!
DEBUG_PPRINT: Message 1 - Printing prefix only.
DEBUG_PPRINT: Message 1 - Printing Syntax object: lang='python', code=''print("hello")''
________________________________________________________________________________________________________________________ test_spinner_runs_and_stops _________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Running.Running..Running...Running... Taking longer than expected                                                                                
___________________________________________________________________________________________________________________________ test_spinner_long_wait ___________________________________________________________________________________________________________________________
---------------------------------------------------------------------------------------------------------------------------- Captured stdout call ----------------------------------------------------------------------------------------------------------------------------
Generating.Generating..Generating... Taking longer than expected                                                                                
-------------------------------------------------------------------------------------------------------------------------- Captured stderr teardown --------------------------------------------------------------------------------------------------------------------------
Destroying test database for alias 'default'...
========================================================================================================================== short test summary info ===========================================================================================================================
PASSED tests/api/test_models_negative.py::test_models_empty_registry_returns_200
PASSED tests/api/test_models_negative.py::test_models_non_mapping_iterable_gracefully_handles_type
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_code_comprehensive
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_missing_yield
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_blueprint_semantics_valid
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_problematic_code
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_performance_safe_code
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_dangerous_code
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_hardcoded_secrets
PASSED tests/views/test_agent_creator_pro.py::TestAdvancedCodeValidator::test_validate_security_safe_code
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_basic
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_generate_agent_code_with_complex_expertise
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_sanitize_class_name
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_analytical
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_conversational
PASSED tests/views/test_agent_creator_pro.py::TestProAgentGenerator::test_template_selection_creative
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_context
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProViews::test_agent_creator_pro_page_get
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProIntegration::test_full_agent_creation_workflow
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_empty_expertise
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_generator_handles_missing_fields
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_empty_code
PASSED tests/views/test_agent_creator_pro.py::TestAgentCreatorProErrorHandling::test_validator_handles_invalid_syntax
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_all_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_auth_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_database_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_django_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_error
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_llm_settings_success
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_logging_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_performance_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_swarm_core_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_collect_ui_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManager::test_settings_manager_initialization
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_filtering
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_environment_variables_get
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_get
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_api_sensitive_data_filtering
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_context
PASSED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_get
PASSED tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_empty_config_file
PASSED tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_missing_django_settings
PASSED tests/views/test_settings_dashboard.py::TestSettingsManagerEdgeCases::test_no_environment_variables
PASSED tests/views/test_settings_dashboard.py::TestSettingsIntegration::test_full_settings_collection_workflow
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_no_auth_returns_403
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_invalid_token_returns_403
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_token_allows_access
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_valid_session_allows_access
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_echocraft_non_streaming_success_auth_disabled
PASSED tests/api/test_chat_completions_auth_async.py::TestChatCompletionsAuthAsync::test_chatbot_non_streaming_success_auth_disabled
PASSED tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_echocraft_streaming_success
PASSED tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_chatbot_streaming_success
PASSED tests/api/test_chat_completions_failing_async.py::TestChatCompletionsAPIFailingAsync::test_blueprint_run_exception_streaming_returns_error_sse
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[model]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_missing_required_field_returns_400[messages]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data0-Ensure this field has at least 1 elements]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data1-Expected a list of items]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data2-This field is required.]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data3-This field is required.]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data4-invalid" is not a valid choice]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_invalid_field_type_or_content_returns_400[invalid_data5-Content must be a string or null.]
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_malformed_json_returns_400
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_permission_denied
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_nonexistent_model_not_found
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_init_error_returns_500
PASSED tests/api/test_chat_completions_validation_async.py::TestChatCompletionsValidationAsync::test_blueprint_run_exception_non_streaming_returns_500
PASSED tests/api/test_endpoints_list_blueprints_models.py::test_models_and_blueprints_endpoints_include_dynamic_team
PASSED tests/api/test_teams_export_import.py::test_export_json_and_csv_and_import_roundtrip
PASSED tests/integration/test_dynamic_teams_reset.py::test_reset_clears_dynamic_registry_and_discovery
PASSED tests/integration/test_dynamic_teams_smoke.py::test_dynamic_team_registry_and_discovery_roundtrip
PASSED tests/blueprints/test_divine_code.py::test_zeus_agent_creation
PASSED tests/blueprints/test_divine_code.py::test_zeus_run_method
PASSED tests/blueprints/test_divine_code.py::test_zeus_delegation_to_odin
PASSED tests/blueprints/test_divine_code.py::test_zeus_basic
PASSED tests/blueprints/test_divine_code.py::test_zeus_full_flow_example
PASSED tests/blueprints/test_echocraft.py::test_echocraft_blueprint_run
PASSED tests/blueprints/test_echocraft.py::test_echocraft_blueprint_no_user_message
PASSED tests/blueprints/test_echocraft.py::test_echocraft_blueprint_multiple_messages
PASSED tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_success
PASSED tests/blueprints/test_echocraft_cli.py::test_run_echocraft_cli_unexpected_response_format
PASSED tests/blueprints/test_family_ties.py::test_stewie_agent_creation
PASSED tests/blueprints/test_geese.py::test_operation_box_styles
PASSED tests/blueprints/test_geese.py::test_display_splash_screen_variants
PASSED tests/blueprints/test_geese.py::test_spinner_messages
PASSED tests/blueprints/test_geese.py::test_story_generation_flow
PASSED tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_basic
PASSED tests/blueprints/test_geese_spinner_and_box.py::test_display_operation_box_default_emoji
PASSED tests/blueprints/test_jeeves.py::test_jeeves_agent_creation
PASSED tests/blueprints/test_jeeves.py::test_jeeves_delegation_to_mycroft
PASSED tests/blueprints/test_jeeves.py::test_jeeves_cli_execution
PASSED tests/blueprints/test_jeeves_progressive_tool.py::test_display_operation_box_progress
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[0-Polishing the silver]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[1-Generating.]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[2-Generating..]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[3-Generating...]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[4-Running...]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_frames[5-Polishing the silver]
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_jeeves_spinner_long_wait
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_basic
PASSED tests/blueprints/test_jeeves_spinner_and_box.py::test_display_operation_box_long_wait
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_agent_creation
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_bad_config
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_filesystem_interaction
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_memory_interaction
PASSED tests/blueprints/test_mcp_demo.py::test_mcpdemo_cli_execution
PASSED tests/blueprints/test_mission_improbable.py::test_mission_db_initialization
PASSED tests/blueprints/test_mission_improbable.py::test_mission_agent_creation
PASSED tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_all_types
PASSED tests/blueprints/test_omniplex.py::test_omniplex_agent_creation_only_npx
PASSED tests/blueprints/test_omniplex.py::test_omniplex_delegation_to_amazo
PASSED tests/blueprints/test_omniplex.py::test_omniplex_cli_execution
PASSED tests/blueprints/test_poets.py::test_poets_db_initialization
PASSED tests/blueprints/test_poets.py::test_poets_agent_creation
PASSED tests/blueprints/test_rue_code_cost.py::test_gpt4_cost
PASSED tests/blueprints/test_rue_code_cost.py::test_invalid_model
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_spinner_states
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_operation_box_output
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_box
PASSED tests/blueprints/test_rue_code_spinner_and_box.py::test_rue_run_empty
PASSED tests/blueprints/test_whinge_surf.py::test_run_and_check_status
PASSED tests/blueprints/test_whinge_surf.py::test_kill_subprocess
PASSED tests/blueprints/test_whinge_surf.py::test_tail_and_show_output
PASSED tests/blueprints/test_whinge_surf.py::test_list_and_prune_jobs
PASSED tests/blueprints/test_whinge_surf.py::test_resource_usage_and_analyze_self
PASSED tests/blueprints/test_whinge_surf.py::test_self_update
PASSED tests/blueprints/test_whinge_surf_analysis.py::test_analyze_self_runs
PASSED tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_agent_creation
PASSED tests/blueprints/test_whiskeytangofoxtrot.py::test_wtf_db_initialization
PASSED tests/blueprints/test_zeus.py::test_metadata_lists_cli_as_divine_ass
PASSED tests/blueprints/test_zeus_cli.py::test_zeus_cli_banner
PASSED tests/blueprints/test_zeus_cli.py::test_zeus_cli_multiple_inputs
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_spinner_states
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_operation_box_output
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_assist_box
PASSED tests/blueprints/test_zeus_spinner_and_box.py::test_zeus_run_empty
PASSED tests/cli/test_cli_config.py::test_create_llm_config
PASSED tests/cli/test_cli_config.py::test_read_llm_config
PASSED tests/cli/test_cli_config.py::test_update_llm_config
PASSED tests/cli/test_cli_config.py::test_partial_update_llm_config
PASSED tests/cli/test_cli_config.py::test_delete_llm_config
PASSED tests/cli/test_cli_config.py::test_invalid_config_handling
PASSED tests/cli/test_cli_config.py::test_config_list_all
PASSED tests/cli/test_config_secrets_and_env_expansion.py::test_env_var_expansion_in_config_loader
PASSED tests/cli/test_launchers.py::test_swarm_cli_entrypoint
PASSED tests/cli/test_launchers.py::test_swarm_cli_install_executable_creates_executable
PASSED tests/cli/test_launchers.py::test_swarm_install_executable_failure
PASSED tests/cli/test_launchers.py::test_swarm_launch_runs_executable
PASSED tests/cli/test_launchers.py::test_swarm_launch_failure_not_found
PASSED tests/cli/test_list_blueprints.py::test_execute_list_user_installed
PASSED tests/cli/test_list_blueprints.py::test_execute_list_available
PASSED tests/cli/test_list_blueprints.py::test_execute_no_user_installed_blueprints
PASSED tests/cli/test_list_blueprints.py::test_execute_no_available_blueprints
PASSED tests/cli/test_list_blueprints.py::test_execute_discovery_exception_user_installed
PASSED tests/cli/test_list_blueprints.py::test_execute_discovery_exception_available
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args0]
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_config_no_key[args1]
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_no_key_with_config
PASSED tests/cli/test_swarm_cli_startup_hints.py::test_startup_hints_suppressed_when_env_flag_unset
PASSED tests/core/test_blueprint_model_override.py::test_blueprint_default_model_override
PASSED tests/core/test_blueprint_model_override.py::test_fallback_logs_warning
PASSED tests/core/test_config_default_generation.py::test_default_config_generation
PASSED tests/core/test_config_discovery.py::test_xdg_config_discovery
PASSED tests/core/test_config_discovery.py::test_config_fallback_to_cwd
PASSED tests/core/test_config_loader.py::test_load_full_configuration_defaults
PASSED tests/core/test_config_loader.py::test_load_full_configuration_profile_merging
PASSED tests/core/test_config_loader.py::test_load_full_configuration_env_substitution
PASSED tests/core/test_config_loader.py::test_load_full_configuration_missing_file
PASSED tests/core/test_config_loader.py::test_load_full_configuration_bad_json
PASSED tests/core/test_config_loader.py::test_load_full_configuration_empty_config
PASSED tests/core/test_config_loader.py::test_load_environment
PASSED tests/core/test_fallback_to_default_model.py::test_fallback_to_default_model
PASSED tests/core/test_mcp_server_config.py::test_mcp_server_config_parsing
PASSED tests/core/test_mcp_server_config.py::test_mcp_server_add_remove_and_edge_cases
PASSED tests/core/test_redact_sensitive_data.py::test_redacts_api_keys_and_tokens
PASSED tests/core/test_redact_sensitive_data.py::test_does_not_redact_non_sensitive_strings
PASSED tests/core/test_redact_sensitive_data.py::test_partial_redaction_behavior
PASSED tests/core/test_redact_sensitive_data.py::test_handles_empty_and_non_dict_inputs
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_basic_run
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_custom_port_and_config_creation
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_daemon_mode
PASSED tests/extensions/launchers/test_swarm_api_launcher.py::test_swarm_api_blueprint_not_found
PASSED tests/integration/test_cli_codey.py::test_codey_cli_ux
PASSED tests/integration/test_cli_codey_packaged.py::test_packaged_codey_cli_install_and_launch
PASSED tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/codey---help]
PASSED tests/integration/test_cli_commands.py::test_cli_help[/mnt/models/open-swarm-mcp/.venv/bin/swarm-cli---help]
PASSED tests/integration/test_cli_commands.py::test_cli_minimal_prompt[/mnt/models/open-swarm-mcp/.venv/bin/codey-Say hello from codey!]
PASSED tests/integration/test_cli_commands.py::test_swarm_cli_interactive_shell
PASSED tests/integration/test_cli_jeeves.py::test_jeeves_cli_ux
PASSED tests/integration/test_cli_rue_code.py::test_rue_cli_token_cost
PASSED tests/integration/test_cli_rue_code.py::test_rue_cli_ux
PASSED tests/integration/test_cli_whinge.py::test_whinge_cli_background_job
PASSED tests/integration/test_cli_zeus.py::test_zeus_cli_integration
PASSED tests/manual/test_blueprintbase_init.py::test_init
PASSED tests/test_cli_mode_selection.py::test_valid_input
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_duplicate_system_messages
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_no_system_messages
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_only_system_messages
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_empty_list
PASSED tests/test_core_filter_duplicate_system_messages.py::test_filter_mixed_valid_invalid
PASSED tests/test_core_filter_messages.py::test_filter_messages_empty_and_none_content
PASSED tests/test_core_filter_messages.py::test_filter_messages_all_valid
PASSED tests/test_core_filter_messages.py::test_filter_messages_with_non_dict_items
PASSED tests/test_core_filter_messages.py::test_filter_messages_empty_input
PASSED tests/test_core_filter_messages.py::test_filter_messages_ignores_other_keys
PASSED tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[simple]
PASSED tests/test_core_truncate_message_history.py::test_truncate_no_action_needed[pairs]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[simple]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_message_count_basic[pairs]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[simple]
PASSED tests/test_core_truncate_message_history.py::test_truncate_by_token_count_basic[pairs]
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user
PASSED tests/test_core_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair
PASSED tests/test_core_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit
PASSED tests/test_core_truncate_message_history.py::test_pairs_handles_missing_tool_response
PASSED tests/test_core_truncate_message_history.py::test_pairs_interspersed_messages_truncation
PASSED tests/test_core_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit
PASSED tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits
PASSED tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user
PASSED tests/test_core_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair
PASSED tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_fit
PASSED tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user
PASSED tests/test_core_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair
PASSED tests/test_core_truncate_message_history.py::test_pairs_empty_input_list
PASSED tests/test_core_truncate_message_history.py::test_pairs_only_system_message
PASSED tests/test_core_truncate_message_history.py::test_pairs_invalid_messages_mixed_in
PASSED tests/test_core_truncate_message_history.py::test_pairs_non_serializable_content
PASSED tests/test_core_truncate_message_history.py::test_simple_truncation_fallback_simulation
PASSED tests/test_core_update_null_content.py::test_update_null_content_list
PASSED tests/test_core_update_null_content.py::test_update_null_content_single_dict
PASSED tests/test_core_update_null_content.py::test_update_null_content_no_change_needed
PASSED tests/test_core_update_null_content.py::test_update_null_content_empty_list_or_invalid_input
PASSED tests/test_dummy.py::test_dummy
PASSED tests/test_truncate_message_history.py::test_truncate_no_action_needed[simple]
PASSED tests/test_truncate_message_history.py::test_truncate_no_action_needed[pairs]
PASSED tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[simple]
PASSED tests/test_truncate_message_history.py::test_truncate_by_message_count_basic[pairs]
PASSED tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[simple]
PASSED tests/test_truncate_message_history.py::test_truncate_by_token_count_basic[pairs]
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_ample_space
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_basic_pair_tight_space
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_ample_space
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_early_user
PASSED tests/test_truncate_message_history.py::test_pairs_preserves_multi_step_cuts_first_pair
PASSED tests/test_truncate_message_history.py::test_pairs_drops_lone_tool_due_to_separation_or_limit
PASSED tests/test_truncate_message_history.py::test_pairs_handles_missing_tool_response
PASSED tests/test_truncate_message_history.py::test_pairs_interspersed_messages_truncation
PASSED tests/test_truncate_message_history.py::test_pairs_system_message_priority_and_exceeds_limit
PASSED tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_fits
PASSED tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_user
PASSED tests/test_truncate_message_history.py::test_pairs_multi_call_in_one_turn_cuts_pair
PASSED tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_fit
PASSED tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_user
PASSED tests/test_truncate_message_history.py::test_pairs_back_to_back_tools_cut_first_pair
PASSED tests/test_truncate_message_history.py::test_pairs_empty_input_list
PASSED tests/test_truncate_message_history.py::test_pairs_only_system_message
PASSED tests/test_truncate_message_history.py::test_pairs_invalid_messages_mixed_in
PASSED tests/test_truncate_message_history.py::test_simple_truncation_fallback_simulation
PASSED tests/unit/test_ansi_box.py::test_ansi_box_basic
PASSED tests/unit/test_ansi_box.py::test_ansi_box_multiline
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_init_does_not_raise
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_markdown_setting_priority
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_llm_profile_resolution_priority
PASSED tests/unit/test_blueprint_base_config.py::TestBlueprintBaseConfigLoading::test_missing_llm_profile_raises
PASSED tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_enabled
PASSED tests/unit/test_hook_chain_deterministic.py::test_deterministic_order_disabled
PASSED tests/unit/test_operation_box_utils.py::test_basic_box_output
PASSED tests/unit/test_operation_box_utils.py::test_code_vs_semantic_box
PASSED tests/unit/test_operation_box_utils.py::test_spinner_escalation_box
PASSED tests/unit/test_output_utils.py::test_pretty_print_response_plain_text
PASSED tests/unit/test_output_utils.py::test_pretty_print_response_with_code_fence
PASSED tests/unit/test_redact.py::test_redact_sensitive_data_basic
PASSED tests/unit/test_redact.py::test_redact_sensitive_data_string
PASSED tests/unit/test_redact.py::test_redact_sensitive_data_custom_keys
PASSED tests/unit/test_slash_commands.py::test_help_and_compact_registered
PASSED tests/unit/test_slash_commands.py::test_model_command_list_and_set
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/approval-approval]
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/history-history]
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/clear-cleared]
PASSED tests/unit/test_slash_commands.py::test_additional_slash_commands[/clearhistory-cleared]
PASSED tests/unit/test_spinner.py::test_spinner_runs_and_stops
PASSED tests/unit/test_spinner.py::test_spinner_long_wait
SKIPPED [1] tests/test_blueprint_loading.py:2: Skipping blueprint loading tests due to complexity of verifying dynamic INSTALLED_APPS modification during test setup
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:29: SQLite interaction testing needs refinement.
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:56: SQLite interaction testing needs refinement.
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:62: Blueprint interaction tests not yet implemented.
SKIPPED [1] tests/blueprints/test_dilbot_universe.py:69: Blueprint action tests not yet implemented
SKIPPED [1] tests/blueprints/test_divine_code.py:89: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_family_ties.py:34: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_family_ties.py:42: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_geese.py:56: Test needs review for SDK Agent tool handling
SKIPPED [1] tests/blueprints/test_geese.py:68: Test needs review for SDK Agent tool handling
SKIPPED [1] tests/blueprints/test_geese.py:72: Spinner tests need refactoring for GeeseSpinner class methods
SKIPPED [1] tests/blueprints/test_geese.py:76: Spinner tests need refactoring for GeeseSpinner class methods
SKIPPED [1] tests/blueprints/test_geese.py:80: Tool structure needs review with SDK Agent
SKIPPED [1] tests/blueprints/test_geese.py:113: Main entry test needs review for async structure and Geese CLI specifics
SKIPPED [1] tests/blueprints/test_geese.py:117: Relies on removed module-level functions; needs agent-based testing.
SKIPPED [1] tests/blueprints/test_geese.py:121: Relies on removed module-level functions; needs agent-based testing.
SKIPPED [1] tests/blueprints/test_geese.py:125: Relies on removed module-level functions; needs agent-based testing.
SKIPPED [1] tests/blueprints/test_geese_agent_mcp_assignment.py:14: Test needs update for refactored GeeseBlueprint agent creation.
SKIPPED [1] tests/blueprints/test_geese_agent_mcp_assignment.py:39: Test needs update for refactored GeeseBlueprint agent creation.
SKIPPED [1] tests/blueprints/test_geese_spinner_and_box.py:41: GeeseSpinner internal API changed; test needs update or removal.
SKIPPED [1] tests/blueprints/test_geese_spinner_and_box.py:73: Test needs update for refactored GeeseBlueprint agent creation.
SKIPPED [1] tests/blueprints/test_gotchaman.py:22: Implementation for GotchamanBlueprint not found in codebase; skipping test.
SKIPPED [1] tests/blueprints/test_gotchaman.py:26: Tool function tests not yet implemented
SKIPPED [1] tests/blueprints/test_gotchaman.py:46: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_gotchaman.py:53: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_jeeves.py:38: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_mcp_demo.py:109: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mcp_demo.py:114: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mcp_demo.py:119: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mcp_demo.py:124: Legacy CLI tests require specific old setup/mocking
SKIPPED [1] tests/blueprints/test_mission_improbable.py:74: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_mission_improbable.py:81: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:21: Blueprint tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:36: Tool function tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:57: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_monkai_magic.py:64: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_nebula_shellz.py:9: CLI tests require more setup/mocking
SKIPPED [1] tests/blueprints/test_nebula_shellz.py:15: CLI tests require more setup/mocking
SKIPPED [1] tests/blueprints/test_nebula_shellz.py:20: CLI tests require more setup/mocking
SKIPPED [1] tests/blueprints/test_poets.py:99: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_poets.py:103: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/blueprints/test_suggestion.py:34: Only run if DEFAULT_LLM is set to 'test'
SKIPPED [1] tests/blueprints/test_suggestion.py:45: Only run if DEFAULT_LLM is set to 'test'
SKIPPED [1] tests/blueprints/test_suggestion.py:52: Only run if DEFAULT_LLM is set to 'test'
SKIPPED [1] tests/blueprints/test_whiskeytangofoxtrot.py:98: Blueprint interaction tests not yet implemented
SKIPPED [1] tests/blueprints/test_whiskeytangofoxtrot.py:101: Blueprint CLI tests not yet implemented
SKIPPED [1] tests/integration/test_cli_geese.py:11: GeeseBlueprint functionality changed; CLI test needs review for story output vs search UX.
SKIPPED [1] tests/system/test_codey_binary.py:10: Binary ./dist/codey_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/codey/codey_cli.py --name codey_cli
SKIPPED [1] tests/system/test_rue_code_binary.py:10: Binary ./dist/rue_code_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/rue_code/rue_code_cli.py --name rue_code_cli
SKIPPED [1] tests/system/test_whinge_binary.py:10: Binary ./dist/whinge not found. Build with: pyinstaller --onefile src/swarm/blueprints/whinge_surf/whinge_surf_cli.py --name whinge
SKIPPED [1] tests/system/test_zeus_binary.py:10: Binary ./dist/zeus_cli not found. Build with: pyinstaller --onefile src/swarm/blueprints/zeus/zeus_cli.py --name zeus_cli
SKIPPED [1] tests/test_truncate_message_history.py:191: Need to verify how non-serializable data is handled
XFAIL tests/api/test_models_negative.py::test_models_exception_returns_500 - reason: View currently returns 200 on exception; adjust view to 500 to strengthen contract.
XFAIL tests/api/test_models_negative.py::test_models_unauthorized_when_permission_enforced - reason: Endpoint appears open (AllowAny); unauthorized path not applicable.
XFAIL tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[OPENAI_API_KEY-sk-test-123] - reason: swarm-cli config add not implemented or unavailable. stderr:
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/launchers/swarm_cli.py", line 12, in <module>
    from swarm.extensions.cli.main import main
ModuleNotFoundError: No module named 'swarm'

stdout:

XFAIL tests/cli/test_config_secrets_and_env_expansion.py::test_cli_config_add_persists_secrets_to_env_file[CUSTOM_SECRET-s3cr3t!] - reason: swarm-cli config add not implemented or unavailable. stderr:
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/mnt/models/open-swarm-mcp/src/swarm/extensions/launchers/swarm_cli.py", line 12, in <module>
    from swarm.extensions.cli.main import main
ModuleNotFoundError: No module named 'swarm'

stdout:

FAILED tests/views/test_settings_dashboard.py::TestSettingsDashboardViews::test_settings_dashboard_error_handling - AssertionError: 200 != 500
===================================================================================================== 1 failed, 284 passed, 52 skipped, 4 xfailed, 3 warnings in 41.09s ======================================================================================================
